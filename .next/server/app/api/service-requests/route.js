"use strict";(()=>{var e={};e.id=119,e.ids=[119],e.modules={20399:e=>{e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},84770:e=>{e.exports=require("crypto")},92048:e=>{e.exports=require("fs")},98216:e=>{e.exports=require("net")},19801:e=>{e.exports=require("os")},55315:e=>{e.exports=require("path")},96119:e=>{e.exports=require("perf_hooks")},76162:e=>{e.exports=require("stream")},82452:e=>{e.exports=require("tls")},62309:(e,r,t)=>{t.r(r),t.d(r,{originalPathname:()=>q,patchFetch:()=>I,requestAsyncStorage:()=>h,routeModule:()=>R,serverHooks:()=>v,staticGenerationAsyncStorage:()=>N});var s={};t.r(s),t.d(s,{GET:()=>_,POST:()=>f});var i=t(49303),a=t(88716),n=t(60670),d=t(87070),o=t(97395),l=t(10306),c=t(57745),u=t(81445);let p={MAX_RIDER_HOURLY_RATE:12.5,MAX_BOOKING_HOURS:2,MIN_RIDER_HOURLY_RATE:5,MIN_BOOKING_HOURS:1},m=e=>e>=p.MIN_BOOKING_HOURS&&e<=p.MAX_BOOKING_HOURS;async function f(e){try{let{riderId:r,startDate:t,startTime:s,duration:i,description:a,merchantAddress:n,userId:c}=await e.json();if(!c)return d.NextResponse.json({error:"User ID required"},{status:400});if(!r||!t||!s||!i||!n||!a||a.trim().length<2)return d.NextResponse.json({error:"Missing required fields: riderId, startDate, startTime, duration, merchantAddress, description (min 2 characters)"},{status:400});if(!m(i))return d.NextResponse.json({error:`Invalid booking hours: must be between ${p.MIN_BOOKING_HOURS} and ${p.MAX_BOOKING_HOURS} hours`},{status:400});let u=new Date(t+"T00:00:00");console.log("\uD83D\uDCC5 Creating service request with date:",{originalStartDate:t,parsedRequestDate:u,riderId:r,merchantId:c});let[f]=await o.db.insert(l.serviceRequests).values({merchantId:c,riderId:r,requestedDate:u,startTime:s,durationHours:i.toString(),description:a||"",merchantAddress:n,status:"pending"}).returning();return console.log("âœ… Service request created:",f),d.NextResponse.json({success:!0,request:f,message:"Service request created successfully"})}catch(e){return console.error("Error creating service request:",e),d.NextResponse.json({error:"Internal server error"},{status:500})}}async function _(e){try{let r;let{searchParams:t}=new URL(e.url),s=t.get("type"),i=t.get("userId");if(!s||!i)return d.NextResponse.json({error:"Missing type or userId parameter"},{status:400});if("merchant"===s)r=await o.db.select({id:l.serviceRequests.id,riderId:l.serviceRequests.riderId,requestedDate:l.serviceRequests.requestedDate,startTime:l.serviceRequests.startTime,durationHours:l.serviceRequests.durationHours,description:l.serviceRequests.description,merchantAddress:l.serviceRequests.merchantAddress,status:l.serviceRequests.status,riderResponse:l.serviceRequests.riderResponse,createdAt:l.serviceRequests.createdAt,updatedAt:l.serviceRequests.updatedAt}).from(l.serviceRequests).where((0,c.eq)(l.serviceRequests.merchantId,i)).orderBy((0,u.C)(l.serviceRequests.createdAt));else{if("rider"!==s)return d.NextResponse.json({error:"Invalid type parameter"},{status:400});r=await o.db.select({id:l.serviceRequests.id,merchantId:l.serviceRequests.merchantId,requestedDate:l.serviceRequests.requestedDate,startTime:l.serviceRequests.startTime,durationHours:l.serviceRequests.durationHours,description:l.serviceRequests.description,merchantAddress:l.serviceRequests.merchantAddress,status:l.serviceRequests.status,riderResponse:l.serviceRequests.riderResponse,createdAt:l.serviceRequests.createdAt,updatedAt:l.serviceRequests.updatedAt}).from(l.serviceRequests).where((0,c.eq)(l.serviceRequests.riderId,i)).orderBy((0,u.C)(l.serviceRequests.createdAt))}return d.NextResponse.json({success:!0,requests:r})}catch(e){return console.error("Error fetching service requests:",e),d.NextResponse.json({error:"Internal server error"},{status:500})}}p.MIN_RIDER_HOURLY_RATE,p.MAX_RIDER_HOURLY_RATE,p.MIN_BOOKING_HOURS,p.MAX_BOOKING_HOURS;let R=new i.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/service-requests/route",pathname:"/api/service-requests",filename:"route",bundlePath:"app/api/service-requests/route"},resolvedPagePath:"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/api/service-requests/route.ts",nextConfigOutput:"",userland:s}),{requestAsyncStorage:h,staticGenerationAsyncStorage:N,serverHooks:v}=R,q="/api/service-requests/route";function I(){return(0,n.patchFetch)({serverHooks:v,staticGenerationAsyncStorage:N})}},97395:(e,r,t)=>{t.d(r,{RQ:()=>a.prenotazioni,V6:()=>a.riderTaxDetails,VT:()=>a.recensioni,db:()=>o,eH:()=>a.profiles,fG:()=>a.ridersDetails,nN:()=>a.disponibilitaRiders,uc:()=>a.esercenti,wW:()=>a.esercenteTaxDetails}),t(60805);var s=t(55043),i=t(48937),a=t(10306);let n=process.env.DATABASE_URL,d=(0,i.Z)(n,{prepare:!1}),o=(0,s.t)(d,{schema:a})},10306:(e,r,t)=>{t.r(r),t.d(r,{dayOfWeekEnum:()=>_,disponibilitaRiders:()=>y,disponibilitaRidersRelations:()=>V,esercenteTaxDetails:()=>T,esercenteTaxDetailsRelations:()=>S,esercenti:()=>q,esercentiRelations:()=>D,merchantFavorites:()=>j,merchantFavoritesRelations:()=>U,occasionalPerformanceReceipts:()=>b,occasionalPerformanceReceiptsRelations:()=>K,paymentStatusEnum:()=>h,prenotazioni:()=>A,prenotazioniRelations:()=>E,profiles:()=>v,profilesRelations:()=>O,recensioni:()=>L,recensioniRelations:()=>z,riderTaxDetails:()=>x,riderTaxDetailsRelations:()=>B,ridersDetails:()=>I,ridersDetailsRelations:()=>w,serviceRequestStatusEnum:()=>N,serviceRequests:()=>g,serviceRequestsRelations:()=>H,statusEnum:()=>R,vehicleTypeEnum:()=>f});var s=t(55396),i=t(889),a=t(80967),n=t(72140),d=t(1575),o=t(41401),l=t(43050),c=t(12941),u=t(98748),p=t(77796),m=t(706);let f=(0,s.ys)("VehicleType",["bici","e_bike","scooter","auto"]),_=(0,s.ys)("DayOfWeek",["Lun","Mar","Mer","Gio","Ven","Sab","Dom"]),R=(0,s.ys)("Status",["in_attesa","confermata","in_corso","completata","annullata"]),h=(0,s.ys)("PaymentStatus",["in_attesa","pagato","rimborsato"]),N=(0,s.ys)("ServiceRequestStatus",["pending","accepted","rejected","expired"]),v=(0,i.af)("profiles",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),fullName:(0,n.fL)("full_name"),avatarUrl:(0,n.fL)("avatar_url"),role:(0,n.fL)("role").notNull(),createdAt:(0,d.AB)("created_at").defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at").defaultNow().notNull()}),q=(0,i.af)("esercenti",{id:(0,a.Vj)("id").primaryKey(),businessName:(0,o.L7)("business_name",{length:255}).notNull(),address:(0,o.L7)("address",{length:255}),city:(0,o.L7)("city",{length:100}),phoneNumber:(0,o.L7)("phone_number",{length:20}),description:(0,n.fL)("description"),profilePictureUrl:(0,o.L7)("profile_picture_url",{length:255})}),I=(0,i.af)("riders_details",{profileId:(0,a.Vj)("profile_id").primaryKey(),vehicleType:f("vehicle_type"),profilePictureUrl:(0,o.L7)("profile_picture_url",{length:255}),bio:(0,n.fL)("bio"),hourlyRate:(0,l.gH)("hourly_rate",{precision:10,scale:2}).notNull(),activeLocation:(0,o.L7)("active_location",{length:100}).notNull().default("Non specificata"),experienceYears:(0,c._L)("experience_years"),specializations:(0,n.fL)("specializations").array(),completedJobs:(0,c._L)("completed_jobs").default(0),rating:(0,l.gH)("rating",{precision:3,scale:2}),responseTime:(0,o.L7)("response_time",{length:20}),isVerified:(0,u.O7)("is_verified").default(!1),isPremium:(0,u.O7)("is_premium").default(!1),stripeAccountId:(0,n.fL)("stripe_account_id"),stripeOnboardingComplete:(0,u.O7)("stripe_onboarding_complete").default(!1),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),y=(0,i.af)("disponibilita_riders",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),riderId:(0,a.Vj)("rider_id").notNull(),dayOfWeek:_("day_of_week").notNull(),startTime:(0,p.XV)("start_time").notNull(),endTime:(0,p.XV)("end_time").notNull()}),A=(0,i.af)("prenotazioni",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),esercenteId:(0,a.Vj)("esercente_id").notNull(),riderId:(0,a.Vj)("rider_id").notNull(),startTime:(0,d.AB)("start_time",{withTimezone:!0}).notNull(),endTime:(0,d.AB)("end_time",{withTimezone:!0}).notNull(),serviceDurationHours:(0,l.gH)("service_duration_hours",{precision:5,scale:2}).notNull(),grossAmount:(0,l.gH)("gross_amount",{precision:10,scale:2}).notNull(),taxWithholdingAmount:(0,l.gH)("tax_withholding_amount",{precision:10,scale:2}),netAmount:(0,l.gH)("net_amount",{precision:10,scale:2}).notNull(),status:R("status").notNull(),paymentStatus:h("payment_status").notNull(),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),g=(0,i.af)("service_requests",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),merchantId:(0,a.Vj)("merchant_id").notNull(),riderId:(0,a.Vj)("rider_id").notNull(),requestedDate:(0,d.AB)("requested_date",{mode:"date"}).notNull(),startTime:(0,p.XV)("start_time").notNull(),durationHours:(0,l.gH)("duration_hours",{precision:5,scale:2}).notNull(),description:(0,n.fL)("description"),merchantAddress:(0,n.fL)("merchant_address").notNull(),status:N("status").notNull().default("pending"),riderResponse:(0,n.fL)("rider_response"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull(),updatedAt:(0,d.AB)("updated_at",{withTimezone:!0}).defaultNow().notNull()}),L=(0,i.af)("recensioni",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),prenotazioneId:(0,a.Vj)("prenotazione_id").notNull().unique(),esercenteId:(0,a.Vj)("esercente_id").notNull(),riderId:(0,a.Vj)("rider_id").notNull(),rating:(0,c._L)("rating").notNull(),comment:(0,n.fL)("comment"),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),x=(0,i.af)("rider_tax_details",{riderId:(0,a.Vj)("rider_id").primaryKey(),firstName:(0,o.L7)("first_name",{length:100}),lastName:(0,o.L7)("last_name",{length:100}),fiscalCode:(0,o.L7)("fiscal_code",{length:50}),birthPlace:(0,o.L7)("birth_place",{length:100}),birthDate:(0,d.AB)("birth_date",{mode:"date"}),residenceAddress:(0,o.L7)("residence_address",{length:255}),residenceCity:(0,o.L7)("residence_city",{length:100})}),T=(0,i.af)("esercente_tax_details",{esercenteId:(0,a.Vj)("esercente_id").primaryKey(),companyName:(0,o.L7)("company_name",{length:255}),vatNumber:(0,o.L7)("vat_number",{length:50}),address:(0,o.L7)("address",{length:255}),city:(0,o.L7)("city",{length:100})}),b=(0,i.af)("occasional_performance_receipts",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),prenotazioneId:(0,a.Vj)("prenotazione_id").notNull().unique(),receiptNumber:(0,c._L)("receipt_number").notNull(),receiptDate:(0,d.AB)("receipt_date",{mode:"date"}).notNull()}),j=(0,i.af)("merchant_favorites",{id:(0,a.Vj)("id").primaryKey().defaultRandom(),merchantId:(0,a.Vj)("merchant_id").notNull(),riderId:(0,a.Vj)("rider_id").notNull(),createdAt:(0,d.AB)("created_at",{withTimezone:!0}).defaultNow().notNull()}),O=(0,m.lE)(v,({one:e,many:r})=>({esercente:e(q,{fields:[v.id],references:[q.id]}),riderDetail:e(I,{fields:[v.id],references:[I.profileId]}),disponibilita:r(y),prenotazioni:r(A),recensioni:r(L)})),D=(0,m.lE)(q,({one:e,many:r})=>({profile:e(v,{fields:[q.id],references:[v.id]}),taxDetails:e(T,{fields:[q.id],references:[T.esercenteId]}),prenotazioni:r(A),recensioni:r(L)})),w=(0,m.lE)(I,({one:e})=>({profile:e(v,{fields:[I.profileId],references:[v.id]})})),V=(0,m.lE)(y,({one:e})=>({profile:e(v,{fields:[y.riderId],references:[v.id]})})),E=(0,m.lE)(A,({one:e})=>({esercente:e(q,{fields:[A.esercenteId],references:[q.id]}),riderProfile:e(v,{fields:[A.riderId],references:[v.id]}),recensione:e(L,{fields:[A.id],references:[L.prenotazioneId]}),receipt:e(b,{fields:[A.id],references:[b.prenotazioneId]})})),H=(0,m.lE)(g,({one:e})=>({merchant:e(v,{fields:[g.merchantId],references:[v.id]}),rider:e(v,{fields:[g.riderId],references:[v.id]})})),z=(0,m.lE)(L,({one:e})=>({prenotazione:e(A,{fields:[L.prenotazioneId],references:[A.id]}),esercente:e(q,{fields:[L.esercenteId],references:[q.id]}),riderProfile:e(v,{fields:[L.riderId],references:[v.id]})})),B=(0,m.lE)(x,({one:e})=>({profile:e(v,{fields:[x.riderId],references:[v.id]})})),S=(0,m.lE)(T,({one:e})=>({esercente:e(q,{fields:[T.esercenteId],references:[q.id]})})),K=(0,m.lE)(b,({one:e})=>({prenotazione:e(A,{fields:[b.prenotazioneId],references:[A.id]})})),U=(0,m.lE)(j,({one:e})=>({merchant:e(v,{fields:[j.merchantId],references:[v.id]}),rider:e(v,{fields:[j.riderId],references:[v.id]})}))}};var r=require("../../../webpack-runtime.js");r.C(e);var t=e=>r(r.s=e),s=r.X(0,[276,972,548],()=>t(62309));module.exports=s})();