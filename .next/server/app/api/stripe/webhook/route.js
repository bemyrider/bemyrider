(()=>{var e={};e.id=2757,e.ids=[2757],e.modules={47495:e=>{function t(e){var t=Error("Cannot find module '"+e+"'");throw t.code="MODULE_NOT_FOUND",t}t.keys=()=>[],t.resolve=t,t.id=47495,e.exports=t},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},30517:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},61282:e=>{"use strict";e.exports=require("child_process")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},21764:e=>{"use strict";e.exports=require("util")},71568:e=>{"use strict";e.exports=require("zlib")},58359:()=>{},93739:()=>{},29243:(e,t,r)=>{"use strict";r.r(t),r.d(t,{originalPathname:()=>h,patchFetch:()=>x,requestAsyncStorage:()=>l,routeModule:()=>d,serverHooks:()=>b,staticGenerationAsyncStorage:()=>g});var o={};r.r(o),r.d(o,{POST:()=>p});var s=r(49303),i=r(88716),a=r(60670),n=r(87070),u=r(69206);let c=(0,r(40785).createClient)("https://uolpvxgcobjefivqnscj.supabase.co",process.env.SUPABASE_SERVICE_ROLE_KEY);async function p(e){let t;let r=e.headers.get("stripe-signature"),o=await e.text();try{t=await u.Ag.webhooks.constructEventAsync(o,r,process.env.STRIPE_WEBHOOK_SECRET)}catch(e){return console.error("Webhook signature verification failed.",e),n.NextResponse.json({error:"Invalid signature"},{status:400})}if("account.updated"===t.type){let e=t.data.object,r=e.id;if(console.log("\uD83D\uDD04 Webhook ricevuto per account:",r),console.log("\uD83D\uDCCA Account status:",{details_submitted:e.details_submitted,charges_enabled:e.charges_enabled,payouts_enabled:e.payouts_enabled}),e.details_submitted&&e.charges_enabled){console.log("✅ Onboarding completato per account:",r);let{error:e}=await c.from("riders_details").update({stripe_onboarding_complete:!0,updated_at:new Date().toISOString()}).eq("stripe_account_id",r);if(e)return console.error(`❌ ERRORE nell'aggiornamento database per account ${r}:`,e),n.NextResponse.json({received:!0,error:e.message});console.log("✅ Database aggiornato con successo per account:",r)}else console.log("⏳ Onboarding non ancora completo per account:",r)}else console.log("\uD83D\uDCE8 Webhook ricevuto per evento non gestito:",t.type);return n.NextResponse.json({received:!0})}let d=new s.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/stripe/webhook/route",pathname:"/api/stripe/webhook",filename:"route",bundlePath:"app/api/stripe/webhook/route"},resolvedPagePath:"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/api/stripe/webhook/route.ts",nextConfigOutput:"",userland:o}),{requestAsyncStorage:l,staticGenerationAsyncStorage:g,serverHooks:b}=d,h="/api/stripe/webhook/route";function x(){return(0,a.patchFetch)({serverHooks:b,staticGenerationAsyncStorage:g})}},69206:(e,t,r)=>{"use strict";r.d(t,{Ag:()=>o});let o=new(r(48472)).Z(process.env.STRIPE_SECRET_KEY,{apiVersion:"2023-10-16"})}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),o=t.X(0,[9276,5972,785,8472],()=>r(29243));module.exports=o})();