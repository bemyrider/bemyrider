(()=>{var e={};e.id=338,e.ids=[338],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},12610:(e,s,a)=>{"use strict";a.r(s),a.d(s,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>o}),a(53119),a(31216),a(35866);var r=a(23191),t=a(88716),i=a(37922),l=a.n(i),n=a(95231),c={};for(let e in n)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(c[e]=()=>n[e]);a.d(s,c);let o=["",{children:["dashboard",{children:["merchant",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(a.bind(a,53119)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/merchant/page.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,95684)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/merchant/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,13321)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(a.bind(a,31216)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(a.t.bind(a,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/merchant/page.tsx"],m="/dashboard/merchant/page",u={require:a,loadChunk:()=>Promise.resolve()},x=new r.AppPageRouteModule({definition:{kind:t.x.APP_PAGE,page:"/dashboard/merchant/page",pathname:"/dashboard/merchant",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:o}})},7456:(e,s,a)=>{Promise.resolve().then(a.bind(a,23012))},23012:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>I});var r=a(10326),t=a(17577),i=a(35047),l=a(90772),n=a(54432),c=a(33071),o=a(88307),d=a(22915),m=a(70003),u=a(76557);let x=(0,u.Z)("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);var h=a(79635),p=a(37358),g=a(32333),f=a(26409),j=a(77636),b=a(48998),N=a(83855),v=a(35442),y=a(46226),w=a(25931),_=a(11358),z=a(31048),D=a(94019);let C=(0,u.Z)("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);var Z=a(31215);function S({isOpen:e,onClose:s,profileId:a,onProfileUpdated:i}){let[o,m]=(0,t.useState)(!1),[u,x]=(0,t.useState)(!1),[h,p]=(0,t.useState)(null),[g,f]=(0,t.useState)(null),[j,b]=(0,t.useState)({businessName:"",address:"",city:"",phoneNumber:"",description:"",profilePictureUrl:""}),N=(e,s)=>{b(a=>({...a,[e]:s}))},y=async()=>{try{let e;if(x(!0),p(null),f(null),!j.businessName.trim()){p("Il nome dell'attivit\xe0 \xe8 obbligatorio");return}console.log("\uD83D\uDCBE Salvando profilo merchant...",j);let{data:r}=await v.O.from("esercenti").select("id").eq("id",a).single();if((e=r?await v.O.from("esercenti").update({business_name:j.businessName.trim(),address:j.address.trim()||null,city:j.city.trim()||null,phone_number:j.phoneNumber.trim()||null,description:j.description.trim()||null,profile_picture_url:j.profilePictureUrl.trim()||null}).eq("id",a).select().single():await v.O.from("esercenti").insert({id:a,business_name:j.businessName.trim(),address:j.address.trim()||null,city:j.city.trim()||null,phone_number:j.phoneNumber.trim()||null,description:j.description.trim()||null,profile_picture_url:j.profilePictureUrl.trim()||null}).select().single()).error)throw e.error;console.log("✅ Profilo merchant salvato con successo:",e.data),f("Profilo salvato con successo!"),i(e.data),setTimeout(()=>{s()},1500)}catch(e){console.error("❌ Errore nel salvataggio del profilo merchant:",e),p(e.message||"Errore nel salvataggio del profilo")}finally{x(!1)}};return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(d.Z,{className:"h-6 w-6 text-blue-600"}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Profilo Attivit\xe0"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Modifica le informazioni della tua attivit\xe0"})]})]}),r.jsx(l.z,{variant:"ghost",size:"sm",onClick:s,className:"text-gray-400 hover:text-gray-600",children:r.jsx(D.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[o&&(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Caricamento profilo..."})]}),!o&&(0,r.jsxs)(r.Fragment,{children:[h&&r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:h}),g&&r.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-green-700",children:g}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(d.Z,{className:"h-5 w-5"}),"Informazioni Attivit\xe0"]}),r.jsx(c.SZ,{children:"Dettagli principali della tua attivit\xe0 commerciale"})]}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"businessName",children:"Nome Attivit\xe0 *"}),r.jsx(n.I,{id:"businessName",value:j.businessName,onChange:e=>N("businessName",e.target.value),placeholder:"es. Pizzeria da Mario",className:"mt-1"})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"description",children:"Descrizione"}),r.jsx("textarea",{id:"description",value:j.description,onChange:e=>N("description",e.target.value),placeholder:"Descrivi la tua attivit\xe0, specialit\xe0, servizi offerti...",className:"mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"profilePictureUrl",children:"URL Immagine Profilo"}),r.jsx(n.I,{id:"profilePictureUrl",value:j.profilePictureUrl,onChange:e=>N("profilePictureUrl",e.target.value),placeholder:"https://esempio.com/immagine.jpg",className:"mt-1"})]})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(C,{className:"h-5 w-5"}),"Informazioni di Contatto"]}),r.jsx(c.SZ,{children:"Dati per permettere ai rider di contattarti"})]}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"phoneNumber",children:"Numero di Telefono"}),r.jsx(n.I,{id:"phoneNumber",value:j.phoneNumber,onChange:e=>N("phoneNumber",e.target.value),placeholder:"+39 123 456 7890",className:"mt-1"})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"address",children:"Indirizzo"}),r.jsx(n.I,{id:"address",value:j.address,onChange:e=>N("address",e.target.value),placeholder:"Via Roma, 123",className:"mt-1"})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"city",children:"Citt\xe0"}),r.jsx(n.I,{id:"city",value:j.city,onChange:e=>N("city",e.target.value),placeholder:"Milano",className:"mt-1"})]})]})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50",children:[r.jsx(l.z,{variant:"outline",onClick:s,disabled:u,children:"Annulla"}),r.jsx(l.z,{onClick:y,disabled:u||o,className:"bg-blue-600 hover:bg-blue-700",children:u?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvataggio..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(Z.Z,{className:"h-4 w-4 mr-2"}),"Salva Profilo"]})})]})]})}):null}var k=a(36283);function A({isOpen:e,onClose:s,profileId:a,onFiscalDataUpdated:i}){let[o,d]=(0,t.useState)(!1),[m,u]=(0,t.useState)(!1),[h,p]=(0,t.useState)(null),[g,f]=(0,t.useState)(null),[b,N]=(0,t.useState)({companyName:"",vatNumber:"",address:"",city:""}),y=(e,s)=>{N(a=>({...a,[e]:s}))},w=e=>{let s=e.replace(/\s/g,"");return/^\d{11}$/.test(s)},_=async()=>{try{let e;if(u(!0),p(null),f(null),b.vatNumber&&!w(b.vatNumber)){p("La partita IVA deve essere composta da 11 cifre");return}console.log("\uD83D\uDCBE Salvando dati fiscali merchant...",b);let{data:r}=await v.O.from("esercente_tax_details").select("esercente_id").eq("esercente_id",a).single();if((e=r?await v.O.from("esercente_tax_details").update({company_name:b.companyName.trim()||null,vat_number:b.vatNumber.trim()||null,address:b.address.trim()||null,city:b.city.trim()||null}).eq("esercente_id",a).select().single():await v.O.from("esercente_tax_details").insert({esercente_id:a,company_name:b.companyName.trim()||null,vat_number:b.vatNumber.trim()||null,address:b.address.trim()||null,city:b.city.trim()||null}).select().single()).error)throw e.error;console.log("✅ Dati fiscali salvati con successo:",e.data),f("Dati fiscali salvati con successo!"),i(e.data),setTimeout(()=>{s()},1500)}catch(e){console.error("❌ Errore nel salvataggio dei dati fiscali:",e),p(e.message||"Errore nel salvataggio dei dati fiscali")}finally{u(!1)}};return e?r.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg shadow-xl w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between p-6 border-b",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx(x,{className:"h-6 w-6 text-green-600"}),(0,r.jsxs)("div",{children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900",children:"Dati Fiscali"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Informazioni fiscali per fatturazione e ricevute"})]})]}),r.jsx(l.z,{variant:"ghost",size:"sm",onClick:s,className:"text-gray-400 hover:text-gray-600",children:r.jsx(D.Z,{className:"h-5 w-5"})})]}),(0,r.jsxs)("div",{className:"p-6 space-y-6",children:[o&&(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-green-600 mx-auto"}),r.jsx("p",{className:"mt-2 text-gray-600",children:"Caricamento dati fiscali..."})]}),!o&&(0,r.jsxs)(r.Fragment,{children:[h&&r.jsx("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:h}),g&&r.jsx("div",{className:"p-4 bg-green-50 border border-green-200 rounded-lg text-green-700",children:g}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(x,{className:"h-5 w-5"}),"Informazioni Aziendali"]}),r.jsx(c.SZ,{children:"Dati necessari per la fatturazione e le ricevute fiscali"})]}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"companyName",children:"Ragione Sociale"}),r.jsx(n.I,{id:"companyName",value:b.companyName,onChange:e=>y("companyName",e.target.value),placeholder:"es. Mario Rossi S.r.l.",className:"mt-1"})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"vatNumber",children:"Partita IVA"}),r.jsx(n.I,{id:"vatNumber",value:b.vatNumber,onChange:e=>y("vatNumber",e.target.value),placeholder:"12345678901",className:"mt-1"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"11 cifre senza spazi (es. 12345678901)"})]})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(j.Z,{className:"h-5 w-5"}),"Indirizzo Fiscale"]}),r.jsx(c.SZ,{children:"Indirizzo per documenti fiscali e ricevute"})]}),(0,r.jsxs)(c.aY,{className:"space-y-4",children:[(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"address",children:"Indirizzo"}),r.jsx(n.I,{id:"address",value:b.address,onChange:e=>y("address",e.target.value),placeholder:"Via Roma, 123",className:"mt-1"})]}),(0,r.jsxs)("div",{children:[r.jsx(z._,{htmlFor:"city",children:"Citt\xe0"}),r.jsx(n.I,{id:"city",value:b.city,onChange:e=>y("city",e.target.value),placeholder:"Milano",className:"mt-1"})]})]})]}),r.jsx(c.Zb,{className:"bg-blue-50 border-blue-200",children:r.jsx(c.aY,{className:"p-4",children:(0,r.jsxs)("div",{className:"flex items-start gap-3",children:[r.jsx(k.Z,{className:"h-5 w-5 text-blue-600 mt-0.5"}),(0,r.jsxs)("div",{children:[r.jsx("h4",{className:"font-medium text-blue-900",children:"Informazioni Importanti"}),r.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Questi dati saranno utilizzati per generare ricevute fiscali e documenti di pagamento. Assicurati che le informazioni siano corrette e aggiornate."})]})]})})})]})]}),(0,r.jsxs)("div",{className:"flex items-center justify-end gap-3 p-6 border-t bg-gray-50",children:[r.jsx(l.z,{variant:"outline",onClick:s,disabled:m,children:"Annulla"}),r.jsx(l.z,{onClick:_,disabled:m||o,className:"bg-green-600 hover:bg-green-700",children:m?(0,r.jsxs)(r.Fragment,{children:[r.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvataggio..."]}):(0,r.jsxs)(r.Fragment,{children:[r.jsx(Z.Z,{className:"h-4 w-4 mr-2"}),"Salva Dati Fiscali"]})})]})]})}):null}var E=a(26093),P=a(57275),q=a(84291);function I(){let[e,s]=(0,t.useState)(null),[a,u]=(0,t.useState)(null),[z,D]=(0,t.useState)(null),[C,Z]=(0,t.useState)([]),[k,I]=(0,t.useState)([]),[T,O]=(0,t.useState)([]),[R,F]=(0,t.useState)(!0),[M,U]=(0,t.useState)(""),[G,Y]=(0,t.useState)(!1),[$,L]=(0,t.useState)(!1),[V,B]=(0,t.useState)(!1),[Q,X]=(0,t.useState)(!1),H=(0,i.useRouter)();(0,t.useCallback)(async()=>{try{let{data:{user:e},error:a}=await v.O.auth.getUser();if(a||!e){console.error("\uD83D\uDEAB No authenticated user, redirecting to login"),H.push("/auth/login");return}console.log("\uD83D\uDD0D Fetching profile for user:",e.id,"Email:",e.email),console.log("\uD83D\uDC64 User metadata:",e.user_metadata),console.log("\uD83D\uDD04 Attempting direct API call...");let r=await (0,w.QG)(e.id);if(!r){if(console.log("\uD83D\uDCDD No profile found, checking user metadata..."),e.user_metadata?.role==="merchant"){console.log("\uD83D\uDCDD Creating merchant profile for user:",e.id);let{error:s}=await v.O.from("profiles").insert({id:e.id,full_name:e.user_metadata.full_name||e.email?.split("@")[0]||"New Merchant",role:"merchant",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s){console.error("❌ Error creating merchant profile:",s),q.N9.error("Errore nella creazione del profilo merchant");return}console.log("✅ Merchant profile created successfully"),window.location.reload();return}console.log("\uD83D\uDEAB User metadata does not indicate merchant role, redirecting to login"),H.push("/auth/login");return}if(console.log("\uD83D\uDCCB Profile found:",r),"merchant"!==r.role){console.log("\uD83D\uDEAB ACCESSO NEGATO: User role is:",r.role,"- redirecting to appropriate dashboard"),"rider"===r.role?(console.log("➡️ Redirecting to rider dashboard"),H.push("/dashboard/rider")):(console.log("➡️ Unknown role, redirecting to login"),H.push("/auth/login"));return}console.log("✅ ACCESSO AUTORIZZATO: Merchant profile loaded successfully"),s(r)}catch(e){console.error("Error fetching profile:",e),q.N9.error(q.nb.serverError)}},[H]),(0,t.useCallback)(async()=>{if(e)try{let{data:s,error:a}=await v.O.from("esercenti").select("*").eq("id",e.id).single();a&&"PGRST116"!==a.code?console.error("Error fetching business data:",a):s&&u(s);let{data:r,error:t}=await v.O.from("esercente_tax_details").select("*").eq("esercente_id",e.id).single();t&&"PGRST116"!==t.code?console.error("Error fetching fiscal data:",t):r&&D(r)}catch(e){console.error("Error fetching merchant data:",e)}},[e]),(0,t.useCallback)(async()=>{try{let{data:e,error:s}=await v.O.from("profiles").select(`
          id,
          full_name,
          avatar_url,
          riders_details (
            bio,
            hourly_rate,
            stripe_onboarding_complete,
            active_location
          )
        `).eq("role","rider");if(s)throw s;let a=(e||[]).map(e=>({...e,riders_details:Array.isArray(e.riders_details)?e.riders_details[0]:e.riders_details})).filter(e=>e.riders_details);Z(a)}catch(e){console.error("Error fetching riders:",e),q.N9.error("Errore nel caricamento dei rider"),Z([])}},[]),(0,t.useCallback)(async()=>{if(e)try{console.log("\uD83D\uDD0D Fetching bookings for merchant... (temporarily disabled)"),I([]);return}catch(e){console.error("Error fetching bookings:",e)}},[e]),(0,t.useCallback)(async()=>{if(e)try{console.log("\uD83D\uDD0D Fetching service requests for merchant...");let{data:s,error:a}=await v.O.from("service_requests").select(`
          id,
          merchant_id,
          rider_id,
          requested_date,
          start_time,
          duration_hours,
          description,
          status,
          rider_response,
          created_at,
          updated_at,
          rider:profiles!rider_id (
            full_name,
            avatar_url
          )
        `).eq("merchant_id",e.id).order("created_at",{ascending:!1}).limit(10);if(a)throw a;let r=(s||[]).map(e=>({...e,rider:Array.isArray(e.rider)?e.rider[0]:e.rider})).filter(e=>e.rider);console.log("✅ Service requests loaded:",r.length),O(r)}catch(e){console.error("Error fetching service requests:",e),q.N9.error("Errore nel caricamento delle richieste di servizio"),O([])}},[e]);let J=C.filter(e=>e.full_name.toLowerCase().includes(M.toLowerCase())),K=e=>new Intl.NumberFormat("it-IT",{style:"currency",currency:"EUR"}).format(e),W=e=>new Intl.DateTimeFormat("it-IT",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"}).format(new Date(e)),ee=async()=>{try{Y(!0),console.log("\uD83D\uDEAA Logging out merchant..."),await v.O.auth.signOut(),console.log("✅ Logout successful, redirecting to home"),q.N9.success(q.nb.logoutSuccess),H.push("/")}catch(e){console.error("❌ Error during logout:",e),q.N9.error("Errore durante il logout"),Y(!1)}};return R&&!e?r.jsx(P.CT,{}):e?(0,r.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[r.jsx(E.Z,{userRole:"merchant",userName:e?.full_name||"Esercente",onLogout:ee,onDeleteAccount:()=>L(!0)}),(0,r.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[r.jsx("div",{className:"mb-8",children:(0,r.jsxs)("div",{className:"flex flex-col lg:flex-row lg:items-center justify-between gap-4",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h1",{className:"text-2xl sm:text-3xl font-bold text-gray-900 mb-2",children:["Benvenuto, ",e.full_name,"! \uD83C\uDFEA"]}),r.jsx("p",{className:"text-gray-600 text-sm sm:text-base",children:"Trova rider qualificati per le tue consegne e gestisci le prenotazioni"})]}),(0,r.jsxs)(l.z,{onClick:()=>H.push("/riders"),className:"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto min-h-[44px] touch-manipulation",size:"lg",children:[r.jsx(o.Z,{className:"h-5 w-5 mr-2"}),"Trova Rider"]})]})}),r.jsx("div",{className:"mb-8",children:(0,r.jsxs)(c.Zb,{children:[r.jsx(c.Ol,{children:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(d.Z,{className:"h-5 w-5"}),"Profilo Attivit\xe0"]}),r.jsx(c.SZ,{children:"Gestisci le informazioni della tua attivit\xe0 e i dati fiscali"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>B(!0),children:[r.jsx(m.Z,{className:"h-4 w-4 mr-2"}),"Modifica Profilo"]}),(0,r.jsxs)(l.z,{variant:"outline",size:"sm",onClick:()=>X(!0),children:[r.jsx(x,{className:"h-4 w-4 mr-2"}),"Dati Fiscali"]})]})]})}),(0,r.jsxs)(c.aY,{children:[(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(d.Z,{className:"h-4 w-4"}),"Informazioni Attivit\xe0"]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Nome Attivit\xe0:"}),r.jsx("p",{className:"text-gray-900",children:a?.business_name||"Non specificato"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Descrizione:"}),r.jsx("p",{className:"text-gray-900",children:a?.description||"Nessuna descrizione"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Telefono:"}),r.jsx("p",{className:"text-gray-900",children:a?.phone_number||"Non specificato"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Indirizzo:"}),r.jsx("p",{className:"text-gray-900",children:a?.address&&a?.city?`${a.address}, ${a.city}`:"Non specificato"})]})]})]}),(0,r.jsxs)("div",{children:[(0,r.jsxs)("h4",{className:"font-medium text-gray-900 mb-3 flex items-center gap-2",children:[r.jsx(x,{className:"h-4 w-4"}),"Dati Fiscali"]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Ragione Sociale:"}),r.jsx("p",{className:"text-gray-900",children:z?.company_name||"Non specificato"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Partita IVA:"}),r.jsx("p",{className:"text-gray-900",children:z?.vat_number||"Non specificato"})]}),(0,r.jsxs)("div",{children:[r.jsx("span",{className:"text-sm font-medium text-gray-600",children:"Indirizzo Fiscale:"}),r.jsx("p",{className:"text-gray-900",children:z?.address&&z?.city?`${z.address}, ${z.city}`:"Non specificato"})]})]})]})]}),r.jsx("div",{className:"mt-6 pt-6 border-t",children:(0,r.jsxs)("div",{className:"flex items-center gap-4",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-3 h-3 rounded-full ${a?"bg-green-500":"bg-yellow-500"}`}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Profilo Attivit\xe0"," ",a?"Completato":"Incompleto"]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:`w-3 h-3 rounded-full ${z?"bg-green-500":"bg-yellow-500"}`}),(0,r.jsxs)("span",{className:"text-sm text-gray-600",children:["Dati Fiscali"," ",z?"Completati":"Incompleti"]})]})]})})]})]})}),(0,r.jsxs)("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[(0,r.jsxs)("div",{className:"lg:col-span-3 grid grid-cols-2 lg:grid-cols-4 gap-3 sm:gap-4 mb-6",children:[r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(h.Z,{className:"h-8 w-8 text-blue-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Rider Disponibili"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:C.length})]})]})})}),r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(p.Z,{className:"h-8 w-8 text-green-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Prenotazioni Attive"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k.filter(e=>"confermata"===e.status).length})]})]})})}),r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(g.Z,{className:"h-8 w-8 text-purple-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Consegne Completate"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:k.filter(e=>"completata"===e.status).length})]})]})})}),r.jsx(c.Zb,{children:r.jsx(c.aY,{className:"p-6",children:(0,r.jsxs)("div",{className:"flex items-center",children:[r.jsx(f.Z,{className:"h-8 w-8 text-yellow-600"}),(0,r.jsxs)("div",{className:"ml-4",children:[r.jsx("p",{className:"text-sm font-medium text-gray-600",children:"Spesa Totale"}),r.jsx("p",{className:"text-2xl font-bold text-gray-900",children:K(k.reduce((e,s)=>e+s.total_amount,0))})]})]})})})]}),(0,r.jsxs)(c.Zb,{className:"lg:col-span-2",children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(o.Z,{className:"h-5 w-5"})," Rider Disponibili"]}),r.jsx(c.SZ,{children:"Trova e prenota rider per le tue consegne"})]}),r.jsx(c.aY,{children:(0,r.jsxs)("div",{className:"space-y-4",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[r.jsx(n.I,{type:"text",placeholder:"Cerca rider per nome...",value:M,onChange:e=>U(e.target.value),className:"flex-1"}),r.jsx(l.z,{onClick:()=>H.push("/riders"),children:"Visualizza Tutti"})]}),(0,r.jsxs)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:[J.slice(0,5).map(e=>(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 border rounded-lg hover:bg-gray-50 gap-3 sm:gap-0",children:[(0,r.jsxs)("div",{className:"flex items-center space-x-3",children:[r.jsx("div",{className:"w-12 h-12 sm:w-10 sm:h-10 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.avatar_url?r.jsx(y.default,{src:e.avatar_url,alt:e.full_name,width:40,height:40,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 text-blue-600 font-semibold text-sm sm:text-xs",children:e.full_name.split(" ").map(e=>e[0]).join("")})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-medium text-gray-900 truncate",children:e.full_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-500",children:[K(e.riders_details.hourly_rate),"/ora"]}),e.riders_details.active_location&&(0,r.jsxs)("p",{className:"text-xs text-blue-600 flex items-center",children:[r.jsx(j.Z,{className:"h-3 w-3 mr-1"}),r.jsx("span",{className:"truncate",children:e.riders_details.active_location})]})]})]}),(0,r.jsxs)(l.z,{size:"sm",className:"w-full sm:w-auto",onClick:()=>H.push(`/riders/${e.id}`),children:[r.jsx(b.Z,{className:"h-4 w-4 mr-1"}),"Prenota"]})]},e.id)),0===J.length&&r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nessun rider trovato"})]})]})})]}),(0,r.jsxs)(c.Zb,{children:[r.jsx(c.Ol,{children:(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(p.Z,{className:"h-5 w-5"})," Prenotazioni Recenti"]})}),(0,r.jsxs)(c.aY,{children:[r.jsx("div",{className:"space-y-3",children:k.length>0?k.map(e=>(0,r.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,r.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[r.jsx("p",{className:"font-medium text-gray-900",children:e.rider.full_name}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium ${"confermata"===e.status?"bg-blue-100 text-blue-800":"completata"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:e.status})]}),r.jsx("p",{className:"text-sm text-gray-600",children:W(e.start_time)}),r.jsx("p",{className:"text-sm font-medium text-gray-900",children:K(e.total_amount)})]},e.id)):r.jsx("p",{className:"text-center text-gray-500 py-8",children:"Nessuna prenotazione ancora"})}),(0,r.jsxs)("div",{className:"flex gap-2 mt-4",children:[r.jsx(l.z,{variant:"outline",className:"flex-1",onClick:()=>H.push("/dashboard/merchant/bookings"),children:"Gestisci Prenotazioni"}),k.length>0&&r.jsx(l.z,{variant:"outline",className:"flex-1",children:"Visualizza Tutte"})]})]})]}),(0,r.jsxs)(c.Zb,{children:[(0,r.jsxs)(c.Ol,{children:[(0,r.jsxs)(c.ll,{className:"flex items-center gap-2",children:[r.jsx(g.Z,{className:"h-5 w-5"}),"Richieste di Servizio"]}),r.jsx(c.SZ,{children:"Gestisci le richieste di servizio inviate ai rider"})]}),(0,r.jsxs)(c.aY,{children:[r.jsx("div",{className:"space-y-3",children:T.length>0?T.slice(0,5).map(e=>(0,r.jsxs)("div",{className:"p-3 border rounded-lg hover:bg-gray-50",children:[(0,r.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-2 sm:gap-0 mb-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-3",children:[r.jsx("div",{className:"w-10 h-10 sm:w-8 sm:h-8 rounded-full overflow-hidden bg-gray-100 flex items-center justify-center flex-shrink-0",children:e.rider.avatar_url?r.jsx(y.default,{src:e.rider.avatar_url,alt:e.rider.full_name,width:32,height:32,className:"w-full h-full object-cover"}):r.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-100 text-blue-600 font-semibold text-sm",children:e.rider.full_name.split(" ").map(e=>e[0]).join("")})}),(0,r.jsxs)("div",{className:"flex-1 min-w-0",children:[r.jsx("p",{className:"font-medium text-gray-900 truncate",children:e.rider.full_name}),(0,r.jsxs)("p",{className:"text-sm text-gray-600",children:[new Date(e.requested_date).toLocaleDateString("it-IT")," ","alle ",e.start_time]})]})]}),r.jsx("span",{className:`px-2 py-1 rounded-full text-xs font-medium whitespace-nowrap ${"pending"===e.status?"bg-yellow-100 text-yellow-800":"accepted"===e.status?"bg-green-100 text-green-800":"rejected"===e.status?"bg-red-100 text-red-800":"expired"===e.status?"bg-gray-100 text-gray-800":"bg-blue-100 text-blue-800"}`,children:"pending"===e.status?"In Attesa":"accepted"===e.status?"Accettata":"rejected"===e.status?"Rifiutata":"expired"===e.status?"Scaduta":"Completata"})]}),(0,r.jsxs)("div",{className:"text-sm text-gray-600",children:[(0,r.jsxs)("p",{children:[e.duration_hours,"h di servizio"]}),e.description&&r.jsx("p",{className:"text-xs text-gray-500 line-clamp-2",children:e.description})]})]},e.id)):(0,r.jsxs)("div",{className:"text-center py-8",children:[r.jsx(g.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),r.jsx("p",{className:"text-gray-500 mb-4",children:"Nessuna richiesta di servizio ancora inviata"}),(0,r.jsxs)(l.z,{onClick:()=>H.push("/riders"),className:"min-h-[44px] touch-manipulation",size:"lg",children:[r.jsx(N.Z,{className:"h-5 w-5 mr-2"}),"Invia Prima Richiesta"]})]})}),T.length>0&&(0,r.jsxs)("div",{className:"flex gap-2 mt-4",children:[r.jsx(l.z,{variant:"outline",className:"flex-1",onClick:()=>H.push("/dashboard/merchant/requests"),children:"Gestisci Richieste"}),r.jsx(l.z,{variant:"outline",className:"flex-1",children:"Visualizza Tutte"})]})]})]})]}),(0,r.jsxs)("div",{className:"mt-8",children:[r.jsx("h2",{className:"text-xl font-semibold text-gray-900 mb-4",children:"Azioni Rapide"}),(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[r.jsx(c.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>H.push("/riders"),children:(0,r.jsxs)(c.aY,{className:"p-6 text-center",children:[r.jsx(o.Z,{className:"h-12 w-12 text-blue-600 mx-auto mb-4"}),r.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Trova Rider"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Cerca rider disponibili nella tua zona"})]})}),r.jsx(c.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",children:(0,r.jsxs)(c.aY,{className:"p-6 text-center",children:[r.jsx(p.Z,{className:"h-12 w-12 text-green-600 mx-auto mb-4"}),r.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Gestisci Prenotazioni"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Visualizza e gestisci le tue prenotazioni"})]})}),r.jsx(c.Zb,{className:"cursor-pointer hover:shadow-md transition-shadow",onClick:()=>B(!0),children:(0,r.jsxs)(c.aY,{className:"p-6 text-center",children:[r.jsx(h.Z,{className:"h-12 w-12 text-purple-600 mx-auto mb-4"}),r.jsx("h3",{className:"font-semibold text-gray-900 mb-2",children:"Profilo Esercente"}),r.jsx("p",{className:"text-sm text-gray-600",children:"Modifica le informazioni del tuo negozio"})]})})]})]})]}),r.jsx(_.Z,{isOpen:$,onClose:()=>L(!1),userRole:"merchant"}),r.jsx(S,{isOpen:V,onClose:()=>B(!1),profileId:e?.id||"",onProfileUpdated:e=>{u(e),console.log("✅ Profilo business aggiornato:",e),q.N9.success(q.nb.profileUpdated)}}),r.jsx(A,{isOpen:Q,onClose:()=>X(!1),profileId:e?.id||"",onFiscalDataUpdated:e=>{D(e),console.log("✅ Dati fiscali aggiornati:",e),q.N9.success("Dati fiscali aggiornati con successo!")}})]}):null}},84291:(e,s,a)=>{"use strict";a.d(s,{nb:()=>m,N9:()=>d});var r=a(34789),t=a(54659),i=a(87888),l=a(37202);let n=(0,a(76557).Z)("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]),c={success:{icon:t.Z,defaultTitle:"Successo",className:"border-green-500 bg-green-50 text-green-900"},error:{icon:i.Z,defaultTitle:"Errore",className:"border-red-500 bg-red-50 text-red-900"},warning:{icon:l.Z,defaultTitle:"Attenzione",className:"border-yellow-500 bg-yellow-50 text-yellow-900"},info:{icon:n,defaultTitle:"Informazione",className:"border-blue-500 bg-blue-50 text-blue-900"},loading:{icon:n,defaultTitle:"Caricamento",className:"border-gray-500 bg-gray-50 text-gray-900"}};class o{notify(e,s,a={}){let t=c[e];return t.icon,(0,r.Am)({title:a.title||t.defaultTitle,description:s})}success(e,s){return this.notify("success",e,s)}error(e,s){return this.notify("error",e,s)}warning(e,s){return this.notify("warning",e,s)}info(e,s){return this.notify("info",e,s)}loading(e,s){let a=s||`loading-${Date.now()}`,r=this.notify("loading",e,{persistent:!0,title:"Caricamento in corso..."});return this.loadingToasts.set(a,r.id||""),{dismiss:()=>{this.loadingToasts.has(a)&&this.loadingToasts.delete(a)}}}dismissLoading(e){this.loadingToasts.has(e)&&this.loadingToasts.delete(e)}clearAllLoading(){this.loadingToasts.clear()}constructor(){this.loadingToasts=new Map}}let d=new o,m={loginSuccess:"Accesso effettuato con successo!",loginError:"Credenziali non valide. Riprova.",logoutSuccess:"Disconnessione effettuata con successo.",registrationSuccess:"Registrazione completata! Controlla la tua email.",requestAccepted:"Richiesta accettata con successo!",requestRejected:"Richiesta rifiutata.",requestCreated:"Richiesta inviata con successo!",requestError:"Errore nell'invio della richiesta.",profileUpdated:"Profilo aggiornato con successo!",profileUpdateError:"Errore nell'aggiornamento del profilo.",passwordChanged:"Password cambiata con successo!",bookingCreated:"Prenotazione creata con successo!",bookingCancelled:"Prenotazione annullata.",bookingError:"Errore nella gestione della prenotazione.",paymentSuccess:"Pagamento elaborato con successo!",paymentError:"Errore nel processamento del pagamento.",stripeError:"Errore con Stripe. Riprova pi\xf9 tardi.",networkError:"Errore di connessione. Controlla la tua connessione internet.",serverError:"Errore del server. Riprova pi\xf9 tardi.",validationError:"Controlla i dati inseriti e riprova.",saveSuccess:"Dati salvati con successo!",deleteSuccess:"Elemento eliminato con successo.",deleteError:"Errore nell'eliminazione dell'elemento."}},25931:(e,s,a)=>{"use strict";a.d(s,{QG:()=>i});var r=a(35442);async function t(e,s="GET",a){try{let{data:{session:t}}=await r.O.auth.getSession(),i={"Content-Type":"application/json",apikey:"sb_publishable_XfZivZLXatSeakd_ccimng_ZiTnn0dN"};t?.access_token&&(i.Authorization=`Bearer ${t.access_token}`);let l={method:s,headers:i};a&&"GET"!==s&&(l.body=JSON.stringify(a));let n=await fetch(`https://uolpvxgcobjefivqnscj.supabase.co/rest/v1/${e}`,l);if(!n.ok)throw Error(`API call failed: ${n.status} ${n.statusText}`);return await n.json()}catch(e){throw console.error("Direct API call failed:",e),e}}async function i(e){try{let s=await t(`profiles?id=eq.${e}`);return s.length>0?s[0]:null}catch(e){return console.error("Failed to get profile:",e),null}}},70003:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});let r=(0,a(76557).Z)("PenSquare",[["path",{d:"M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1qinfi"}],["path",{d:"M18.5 2.5a2.12 2.12 0 0 1 3 3L12 15l-4 1 1-4Z",key:"w2jsv5"}]])},88307:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});let r=(0,a(76557).Z)("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]])},22915:(e,s,a)=>{"use strict";a.d(s,{Z:()=>r});let r=(0,a(76557).Z)("Store",[["path",{d:"m2 7 4.41-4.41A2 2 0 0 1 7.83 2h8.34a2 2 0 0 1 1.42.59L22 7",key:"ztvudi"}],["path",{d:"M4 12v8a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-8",key:"1b2hhj"}],["path",{d:"M15 22v-4a2 2 0 0 0-2-2h-2a2 2 0 0 0-2 2v4",key:"2ebpfo"}],["path",{d:"M2 7h20",key:"1fcdvo"}],["path",{d:"M22 7v3a2 2 0 0 1-2 2v0a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 16 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 12 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 8 12a2.7 2.7 0 0 1-1.59-.63.7.7 0 0 0-.82 0A2.7 2.7 0 0 1 4 12v0a2 2 0 0 1-2-2V7",key:"jon5kx"}]])},95684:(e,s,a)=>{"use strict";function r({children:e}){return e}a.r(s),a.d(s,{default:()=>r})},53119:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>r});let r=(0,a(68570).createProxy)(String.raw`/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/merchant/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var a=e=>s(s.s=e),r=s.X(0,[276,643,158,481,309,637],()=>a(12610));module.exports=r})();