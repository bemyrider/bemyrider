(()=>{var e={};e.id=2613,e.ids=[2613],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},97249:(e,s,t)=>{"use strict";t.r(s),t.d(s,{GlobalError:()=>l.a,__next_app__:()=>x,originalPathname:()=>m,pages:()=>d,routeModule:()=>h,tree:()=>c}),t(86742),t(12177),t(31216),t(35866);var a=t(23191),r=t(88716),i=t(37922),l=t.n(i),o=t(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);t.d(s,n);let c=["",{children:["dashboard",{children:["rider",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(t.bind(t,86742)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,12177)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,13321)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(t.bind(t,31216)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(t.t.bind(t,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx"],m="/dashboard/rider/page",x={require:t,loadChunk:()=>Promise.resolve()},h=new a.AppPageRouteModule({definition:{kind:r.x.APP_PAGE,page:"/dashboard/rider/page",pathname:"/dashboard/rider",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},13506:(e,s,t)=>{Promise.resolve().then(t.bind(t,74516))},74516:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>eE});var a,r,i,l,o,n,c=t(10326),d=t(17577),m=t.n(d),x=t(35047),h=t(35442),u=t(11358),p=t(25876),g=t(90772),f=t(77863),j=t(94019);function b({items:e,onItemClick:s,className:t,isMobile:a=!1,isOpen:r=!0,onToggle:i}){let[l,o]=(0,d.useState)(""),n=e=>{o(e),s(e),a&&i&&i()},x=(0,c.jsxs)("div",{className:(0,f.cn)("flex flex-col h-full",t),children:[a&&(0,c.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[c.jsx("h2",{className:"text-lg font-semibold",children:"Menu"}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:i,className:"p-2",children:c.jsx(j.Z,{className:"h-5 w-5"})})]}),c.jsx("nav",{className:"flex-1 p-4",children:c.jsx("ul",{className:"space-y-2",children:e.map(e=>c.jsx("li",{children:(0,c.jsxs)(g.z,{variant:l===e.id?"default":"ghost",className:(0,f.cn)("w-full justify-start text-left",l===e.id?"bg-[#333366] hover:bg-[#333366]/90 text-white":"hover:bg-gray-100 text-gray-700 hover:text-gray-900"),onClick:()=>n(e.id),children:[c.jsx("span",{className:"mr-3",children:e.icon&&"function"==typeof e.icon?m().createElement(e.icon,{className:"h-5 w-5"}):e.icon}),c.jsx("span",{className:"truncate",children:e.label})]})},e.id))})}),c.jsx("div",{className:"p-4 border-t",children:c.jsx("div",{className:"text-xs text-gray-500 text-center",children:"Dashboard Rider"})})]});return a?c.jsx("div",{className:(0,f.cn)("fixed inset-0 z-50 bg-black/50 transition-opacity lg:hidden",r?"opacity-100":"opacity-0 pointer-events-none"),onClick:i,children:c.jsx("div",{className:(0,f.cn)("fixed left-0 top-0 h-full w-64 bg-white shadow-lg transform transition-transform",r?"translate-x-0":"-translate-x-full"),onClick:e=>e.stopPropagation(),children:x})}):c.jsx("div",{className:"hidden lg:block fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white border-r border-gray-200 shadow-sm z-30",children:x})}var N=t(33071),v=t(54432),y=t(31048),w=t(37358),_=t(54659),D=t(83855),A=t(48998),E=t(31215);let S=[{key:"Lun",label:"Luned\xec",short:"Lun"},{key:"Mar",label:"Marted\xec",short:"Mar"},{key:"Mer",label:"Mercoled\xec",short:"Mer"},{key:"Gio",label:"Gioved\xec",short:"Gio"},{key:"Ven",label:"Venerd\xec",short:"Ven"},{key:"Sab",label:"Sabato",short:"Sab"},{key:"Dom",label:"Domenica",short:"Dom"}];function C({riderId:e,onClose:s}){let[t,a]=(0,d.useState)(S.map(e=>({day:e.key,isAvailable:!1,timeSlots:[]}))),[r,i]=(0,d.useState)(!1),[l,o]=(0,d.useState)(!1),[n,m]=(0,d.useState)(null),x=e=>{a(s=>s.map(s=>s.day===e?{...s,isAvailable:!s.isAvailable,timeSlots:s.isAvailable?[]:[{start_time:"09:00",end_time:"17:00"}]}:s))},u=e=>{a(s=>s.map(s=>s.day===e?{...s,timeSlots:[...s.timeSlots,{start_time:"09:00",end_time:"17:00"}]}:s))},p=(e,s)=>{a(t=>t.map(t=>t.day===e?{...t,timeSlots:t.timeSlots.filter((e,t)=>t!==s)}:t))},f=(e,s,t,r)=>{a(a=>a.map(a=>a.day===e?{...a,timeSlots:a.timeSlots.map((e,a)=>a===s?{...e,[t]:r}:e)}:a))},b=async()=>{try{o(!0),m(null),await h.O.from("disponibilita_riders").delete().eq("rider_id",e);let a=[];for(let s of t)if(s.isAvailable)for(let t of s.timeSlots)a.push({rider_id:e,day_of_week:s.day,start_time:t.start_time,end_time:t.end_time});if(a.length>0){let{error:e}=await h.O.from("disponibilita_riders").insert(a);if(e)throw e}m({type:"success",text:"Disponibilit\xe0 salvata con successo!"}),setTimeout(()=>{s()},1500)}catch(e){console.error("Error saving availability:",e),m({type:"error",text:e.message||"Errore nel salvataggio"})}finally{o(!1)}};return r?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:c.jsx(N.Zb,{className:"w-full max-w-md",children:(0,c.jsxs)(N.aY,{className:"p-6 text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),c.jsx("p",{children:"Caricamento disponibilit\xe0..."})]})})}):c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)(N.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(w.Z,{className:"h-5 w-5 text-purple-600"}),c.jsx(N.ll,{children:"Gestisci Disponibilit\xe0"})]}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:s,children:c.jsx(j.Z,{className:"h-4 w-4"})})]}),c.jsx(N.SZ,{children:"Imposta i tuoi orari di disponibilit\xe0 per ogni giorno della settimana"})]}),(0,c.jsxs)(N.aY,{className:"space-y-6",children:[n&&(0,c.jsxs)("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${"success"===n.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:["success"===n.type&&c.jsx(_.Z,{className:"h-4 w-4"}),c.jsx("span",{children:n.text})]}),c.jsx("div",{className:"space-y-4",children:S.map(({key:e,label:s,short:a})=>{let r=t.find(s=>s.day===e);return c.jsx(N.Zb,{className:"border-l-4 border-purple-500",children:(0,c.jsxs)(N.aY,{className:"p-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-3",children:[c.jsx(g.z,{variant:r.isAvailable?"default":"outline",size:"sm",onClick:()=>x(e),className:"w-16",children:a}),c.jsx("span",{className:"font-medium",children:s})]}),r.isAvailable&&(0,c.jsxs)(g.z,{variant:"outline",size:"sm",onClick:()=>u(e),children:[c.jsx(D.Z,{className:"h-4 w-4 mr-1"}),"Aggiungi Fascia"]})]}),r.isAvailable&&(0,c.jsxs)("div",{className:"space-y-2",children:[r.timeSlots.map((s,t)=>(0,c.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 p-2 rounded",children:[c.jsx(A.Z,{className:"h-4 w-4 text-gray-500"}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(y._,{htmlFor:`start-${e}-${t}`,className:"text-sm",children:"Da:"}),c.jsx(v.I,{id:`start-${e}-${t}`,type:"time",value:s.start_time,onChange:s=>f(e,t,"start_time",s.target.value),className:"w-32"})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(y._,{htmlFor:`end-${e}-${t}`,className:"text-sm",children:"A:"}),c.jsx(v.I,{id:`end-${e}-${t}`,type:"time",value:s.end_time,onChange:s=>f(e,t,"end_time",s.target.value),className:"w-32"})]}),r.timeSlots.length>1&&c.jsx(g.z,{variant:"ghost",size:"sm",onClick:()=>p(e,t),className:"text-red-500 hover:text-red-700",children:c.jsx(j.Z,{className:"h-4 w-4"})})]},t)),0===r.timeSlots.length&&c.jsx("p",{className:"text-sm text-gray-500 italic",children:"Nessuna fascia oraria impostata"})]})]})},e)})}),(0,c.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[c.jsx(g.z,{variant:"outline",onClick:s,disabled:l,children:"Annulla"}),c.jsx(g.z,{onClick:b,disabled:l,children:l?(0,c.jsxs)(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,c.jsxs)(c.Fragment,{children:[c.jsx(E.Z,{className:"h-4 w-4 mr-2"}),"Salva Disponibilit\xe0"]})})]})]})]})})}var z=t(26409),I=t(87888),R=t(46260);function k({riderId:e,currentRate:s,onClose:t}){let[a,r]=(0,d.useState)(s?s.toString():""),[i,l]=(0,d.useState)(!1),[o,n]=(0,d.useState)(null),m=async s=>{s.preventDefault(),l(!0),n(null);try{s.target.checkValidity()||s.stopPropagation();let r=parseFloat(a.replace(",","."));if(isNaN(r)||r<=0)throw Error("⚠️ Inserisci una tariffa valida maggiore di €0,01");if(!(0,R.P0)(r))throw Error(R.RZ.INVALID_RIDER_RATE);console.log("\uD83D\uDD04 Updating rider rate...",{riderId:e,rate:r});let{error:i}=await h.O.from("riders_details").update({hourly_rate:r,updated_at:new Date().toISOString()}).eq("profile_id",e);if(i)throw console.error("❌ Error updating rate:",i),i;console.log("✅ Rate updated successfully"),n({type:"success",text:`✅ Tariffa aggiornata con successo a €${r.toFixed(2)}/ora`}),setTimeout(()=>{t(),window.location.reload()},1500)}catch(e){console.error("❌ Error:",e),n({type:"error",text:e.message||"Errore durante l'aggiornamento"})}finally{l(!1)}};return c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)(N.Zb,{className:"w-full max-w-md bg-white",children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(z.Z,{className:"h-5 w-5"}),"Aggiorna Tariffa"]}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:t,disabled:i,children:c.jsx(j.Z,{className:"h-4 w-4"})})]}),c.jsx(N.SZ,{children:"Imposta la tua tariffa oraria per i servizi di delivery"})]}),(0,c.jsxs)(N.aY,{children:[(0,c.jsxs)("form",{onSubmit:m,className:"space-y-4",noValidate:!0,children:[(0,c.jsxs)("div",{className:"space-y-2",children:[c.jsx(y._,{htmlFor:"hourlyRate",children:"Tariffa Oraria (€/ora)"}),(0,c.jsxs)("div",{className:"relative",children:[c.jsx(z.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),c.jsx(v.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]+)?",value:a,onChange:e=>{let s=e.target.value;if(r(s=s.replace(/[^0-9.,]/g,"").replace(",",".")),o?.type==="error"&&n(null),s&&!isNaN(parseFloat(s))){let e=parseFloat(s);e>12.5?n({type:"error",text:"⚠️ La tariffa non pu\xf2 superare €12,50/ora per rispettare i limiti fiscali"}):e<=0&&n({type:"error",text:"⚠️ Inserisci una tariffa valida maggiore di €0,01"})}},onKeyDown:e=>{-1===[46,8,9,27,13,190,188].indexOf(e.keyCode)&&(65!==e.keyCode||!0!==e.ctrlKey)&&(67!==e.keyCode||!0!==e.ctrlKey)&&(86!==e.keyCode||!0!==e.ctrlKey)&&(88!==e.keyCode||!0!==e.ctrlKey)&&(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},placeholder:"Es. 12.00",className:"pl-10",disabled:i})]}),c.jsx("p",{className:"text-xs text-gray-500",children:"Max €12,50/ora per rimanere sotto la soglia fiscale di €25,82 (2 ore max)"})]}),s&&c.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,c.jsxs)("p",{className:"text-sm text-blue-700",children:[c.jsx("strong",{children:"Tariffa attuale:"})," €",s,"/ora"]})}),o&&(0,c.jsxs)("div",{className:`p-3 rounded-lg flex items-center gap-2 ${"success"===o.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:["success"===o.type?c.jsx(_.Z,{className:"h-4 w-4"}):c.jsx(I.Z,{className:"h-4 w-4"}),c.jsx("span",{className:"text-sm",children:o.text})]}),(0,c.jsxs)("div",{className:"flex gap-2 pt-4",children:[c.jsx(g.z,{type:"button",variant:"outline",onClick:t,disabled:i,className:"flex-1",children:"Annulla"}),c.jsx(g.z,{type:"submit",disabled:i||!a,className:"flex-1",children:i?c.jsx(c.Fragment,{children:"Aggiornamento..."}):(0,c.jsxs)(c.Fragment,{children:[c.jsx(E.Z,{className:"mr-2 h-4 w-4"}),"Salva"]})})]})]}),(0,c.jsxs)("div",{className:"mt-6 bg-green-50 p-3 rounded-lg",children:[c.jsx("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"\uD83D\uDCCB Informazioni Fiscali"}),(0,c.jsxs)("ul",{className:"text-xs text-green-600 space-y-1",children:[(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Tariffa max:"})," €12,50/ora"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Durata max:"})," 2 ore per prenotazione"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Totale max:"})," €25,00 (< €25,82)"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Vantaggio:"})," Nessuna ritenuta d'acconto"]})]}),(0,c.jsxs)("p",{className:"text-xs text-green-600 mt-2 italic",children:["Fonte:"," ",c.jsx("a",{href:"https://www.agenziaentrate.gov.it/portale/schede/pagamenti/versamento-modello-f24-ritenute-su-reddito-di-lavoro-autonomo-f24_rit_red_lav_aut/redditi-soggetti-a-ritenuta-f24_rit_red_lav_aut",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-green-800",children:"Agenzia delle Entrate - Ritenute Lavoro Autonomo"})]})]})]})]})})}var Z=t(36283),O=t(79635),P=t(77636),L=t(76557);let M=(0,L.Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function F({isOpen:e,onClose:s,riderId:t}){let[a,r]=(0,d.useState)({first_name:"",last_name:"",fiscal_code:"",birth_place:"",birth_date:"",residence_address:"",residence_city:""}),[i,l]=(0,d.useState)(!1),[o,n]=(0,d.useState)(null),m=e=>/^[A-Z]{6}[0-9]{2}[A-Z][0-9]{2}[A-Z][0-9]{3}[A-Z]$/.test(e.toUpperCase()),x=e=>e.replace(/[AEIOU]/g,""),u=e=>e.replace(/[^AEIOU]/g,""),p=e=>["A","B","C","D","E","H","L","M","P","R","S","T"][e-1]||"A",f=e=>{for(let[s,t]of Object.entries({PALERMO:"G273",ROMA:"H501",MILANO:"F205",NAPOLI:"F839",TORINO:"L219",GENOVA:"D969",BOLOGNA:"A944",FIRENZE:"D612",VENEZIA:"L736",BARI:"A662",CATANIA:"C351",VERONA:"L781",MESSINA:"F158",PADOVA:"G224",TRIESTE:"L424",BRESCIA:"B157",PARMA:"G337",PRATO:"G999",MODENA:"F257","REGGIO CALABRIA":"H224","REGGIO EMILIA":"H223",PERUGIA:"G478",LIVORNO:"E625",RAVENNA:"H199",CAGLIARI:"B354",FOGGIA:"D643",RIMINI:"H294",SALERNO:"H703",FERRARA:"D548",SASSARI:"I452",LATINA:"E472","GIUGLIANO IN CAMPANIA":"E058",MONZA:"F704",SYRACUSA:"I754",PESCARA:"G482",BERGAMO:"A794",FORLÌ:"D704",TRENTO:"L378",VICENZA:"L840",TERNI:"L112",BOLZANO:"A952",NOVARA:"F952",PIACENZA:"G535",ANCONA:"A271",ANDRIA:"A285",AREZZO:"A390",UDINE:"L483",CESENA:"C514",LECCE:"E506",PESARO:"G479"}))if(e.includes(s))return t;let s=e.match(/\(([^)]+)\)/);if(s){let e=s[1],t={PA:"G273",RM:"H501",MI:"F205",NA:"F839",TO:"L219",GE:"D969",BO:"A944",FI:"D612",VE:"L736",BA:"A662",CT:"C351",VR:"L781",ME:"F158"};if(t[e])return t[e]}return"H501"},b=e=>{let s={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23},t={0:1,1:0,2:5,3:7,4:9,5:13,6:15,7:17,8:19,9:21},a={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},r={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},i=0;for(let l=0;l<15;l++){let o=e[l].toUpperCase();l%2==0?isNaN(parseInt(o))?i+=s[o]||0:i+=t[o]||0:isNaN(parseInt(o))?i+=a[o]||0:i+=r[o]||0}return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[i%26]},_=(e,s)=>{if(r(t=>({...t,[e]:s})),o?.type==="error"&&n(null),"fiscal_code"===e&&s.length>0){let e=s.toUpperCase();16!==s.length||m(e)||n({type:"error",text:"⚠️ Codice fiscale non valido. Controlla il formato (16 caratteri)"})}},D=async e=>{e.preventDefault(),l(!0),n(null);try{if(!a.first_name.trim())throw Error("⚠️ Il nome \xe8 obbligatorio");if(!a.last_name.trim())throw Error("⚠️ Il cognome \xe8 obbligatorio");if(!a.fiscal_code.trim())throw Error("⚠️ Il codice fiscale \xe8 obbligatorio");if(!m(a.fiscal_code.toUpperCase()))throw Error("⚠️ Codice fiscale non valido. Deve essere di 16 caratteri nel formato corretto");if(!a.birth_place.trim())throw Error("⚠️ Il luogo di nascita \xe8 obbligatorio");if(!a.birth_date.trim())throw Error("⚠️ La data di nascita \xe8 obbligatoria");if(!a.residence_address.trim())throw Error("⚠️ L'indirizzo di residenza \xe8 obbligatorio");if(!a.residence_city.trim())throw Error("⚠️ La citt\xe0 di residenza \xe8 obbligatoria");let e={rider_id:t,first_name:a.first_name.trim(),last_name:a.last_name.trim(),fiscal_code:a.fiscal_code.toUpperCase(),birth_place:a.birth_place.trim(),birth_date:a.birth_date,residence_address:a.residence_address.trim(),residence_city:a.residence_city.trim()},{error:r}=await h.O.from("rider_tax_details").upsert(e,{onConflict:"rider_id"});if(r)throw console.error("Error saving fiscal data:",r),Error("❌ Errore durante il salvataggio. Riprova.");n({type:"success",text:"✅ Dati fiscali salvati con successo!"}),setTimeout(()=>{s()},1500)}catch(e){console.error("Error saving fiscal data:",e),n({type:"error",text:e.message||"❌ Errore durante il salvataggio. Riprova."})}finally{l(!1)}},A=()=>{n(null),s()};return e?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,c.jsxs)(N.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)(N.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(Z.Z,{className:"h-5 w-5"}),"Dati Fiscali"]}),c.jsx(N.SZ,{children:"Inserisci i tuoi dati fiscali per la fatturazione e la compliance"})]}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:A,disabled:i,children:c.jsx(j.Z,{className:"h-4 w-4"})})]}),(0,c.jsxs)(N.aY,{children:[o&&c.jsx("div",{className:`mb-4 p-3 rounded-lg ${"success"===o.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:o.text}),(0,c.jsxs)("form",{onSubmit:D,className:"space-y-4",noValidate:!0,children:[(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"firstName",className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-4 w-4"}),"Nome *"]}),c.jsx(v.I,{id:"firstName",type:"text",value:a.first_name,onChange:e=>_("first_name",e.target.value),placeholder:"Es. Mario",disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"lastName",className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-4 w-4"}),"Cognome *"]}),c.jsx(v.I,{id:"lastName",type:"text",value:a.last_name,onChange:e=>_("last_name",e.target.value),placeholder:"Es. Rossi",disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"birthPlace",className:"flex items-center gap-2",children:[c.jsx(P.Z,{className:"h-4 w-4"}),"Luogo di Nascita *"]}),c.jsx(v.I,{id:"birthPlace",type:"text",value:a.birth_place,onChange:e=>_("birth_place",e.target.value),placeholder:"Es. Roma (RM)",disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"birthDate",className:"flex items-center gap-2",children:[c.jsx(w.Z,{className:"h-4 w-4"}),"Data di Nascita *"]}),c.jsx(v.I,{id:"birthDate",type:"date",value:a.birth_date,onChange:e=>_("birth_date",e.target.value),disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"fiscalCode",className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-4 w-4"}),"Codice Fiscale *"]}),(0,c.jsxs)("div",{className:"flex gap-2",children:[c.jsx(v.I,{id:"fiscalCode",type:"text",maxLength:16,value:a.fiscal_code,onChange:e=>_("fiscal_code",e.target.value.toUpperCase()),placeholder:"Es. RSSMRA85M01H501X",className:"uppercase flex-1",disabled:i,required:!0}),(0,c.jsxs)(g.z,{type:"button",variant:"outline",onClick:()=>{let{first_name:e,last_name:s,birth_date:t,birth_place:i}=a;if(!e.trim()||!s.trim()||!t||!i.trim()){n({type:"error",text:"⚠️ Compila tutti i campi (nome, cognome, data e luogo di nascita) per calcolare il codice fiscale"});return}try{let a=s.toUpperCase().replace(/\s/g,""),l=x(a),o=u(a),c="";c=l.length>=3?l.substring(0,3):(l+o+"XXX").substring(0,3);let d=e.toUpperCase().replace(/\s/g,""),m=x(d),h=u(d),g="";g=m.length>=4?m[0]+m[2]+m[3]:m.length>=3?m.substring(0,3):(m+h+"XXX").substring(0,3);let j=t.substring(2,4),N=p(parseInt(t.substring(5,7))),v=t.substring(8,10),y=f(i.toUpperCase()),w=c+g+j+N+v+y,_=b(w),D=w+_;r(e=>({...e,fiscal_code:D})),n({type:"success",text:`✅ Codice fiscale calcolato: ${D}. Verifica che sia corretto.`})}catch(e){n({type:"error",text:"❌ Errore nel calcolo del codice fiscale. Inseriscilo manualmente."})}},disabled:i,className:"shrink-0",children:[c.jsx(M,{className:"h-4 w-4 mr-1"}),"Calcola"]})]}),c.jsx("p",{className:"text-xs text-gray-500",children:"16 caratteri alfanumerici (lettere maiuscole e numeri)"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"residenceAddress",className:"flex items-center gap-2",children:[c.jsx(P.Z,{className:"h-4 w-4"}),"Indirizzo di Residenza *"]}),c.jsx(v.I,{id:"residenceAddress",type:"text",value:a.residence_address,onChange:e=>_("residence_address",e.target.value),placeholder:"Es. Via Roma, 123",disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"residenceCity",className:"flex items-center gap-2",children:[c.jsx(P.Z,{className:"h-4 w-4"}),"Citt\xe0 di Residenza *"]}),c.jsx(v.I,{id:"residenceCity",type:"text",value:a.residence_city,onChange:e=>_("residence_city",e.target.value),placeholder:"Es. Milano (MI)",disabled:i,required:!0})]}),(0,c.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,c.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[c.jsx(I.Z,{className:"h-4 w-4"}),"Informazioni Importanti"]}),(0,c.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Privacy:"})," I dati sono protetti secondo il GDPR"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Uso:"})," Utilizzati solo per fatturazione e compliance fiscale"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Sicurezza:"})," Trasmissione e archiviazione crittografate"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Modifiche:"})," Puoi aggiornare i dati in qualsiasi momento"]})]})]}),(0,c.jsxs)("div",{className:"flex gap-3 pt-4",children:[c.jsx(g.z,{type:"button",variant:"outline",onClick:A,disabled:i,className:"flex-1",children:"Annulla"}),c.jsx(g.z,{type:"submit",disabled:i,className:"flex-1",children:i?(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx(E.Z,{className:"h-4 w-4"}),"Salva Dati Fiscali"]})})]})]})]})]})}):null}var T=t(40617),q=t(97697);let G=(0,L.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);var B=t(46226);(function(e){e.AVAILABLE="available",e.BUSY="busy",e.OFFLINE="offline"})(a||(a={})),function(e){e.PENDING="pending",e.CONFIRMED="confirmed",e.COMPLETED="completed",e.CANCELLED="cancelled"}(r||(r={})),function(e){e.RIDER="rider",e.MERCHANT="merchant"}(i||(i={})),function(e){e.BIKE="bike",e.SCOOTER="scooter",e.CAR="car",e.MOTORBIKE="motorbike",e.WALKING="walking"}(l||(l={})),function(e){e.BICI="bici",e.E_BIKE="e_bike",e.SCOOTER="scooter",e.AUTO="auto"}(o||(o={}));let U={bici:"\uD83D\uDEB2 Bicicletta",e_bike:"\uD83D\uDEB4‍♂️ E-Bike",scooter:"\uD83D\uDEF5 Scooter",auto:"\uD83D\uDE97 Auto"},V=e=>e?.code==="PGRST301"||e?.code==="PGRST302"||e?.status===401||e?.status===403||e?.message?.includes("JWT"),H=async()=>{try{console.log("\uD83D\uDD04 Refreshing session...");let{data:e,error:s}=await h.O.auth.refreshSession();if(s)return console.error("❌ Failed to refresh session:",s),!1;if(e.session)return console.log("✅ Session refreshed successfully"),!0;return console.warn("⚠️ No session returned after refresh"),!1}catch(e){return console.error("❌ Error during session refresh:",e),!1}},$=async(e,s=1)=>{let t;for(let a=0;a<=s;a++)try{let{data:{user:s},error:t}=await h.O.auth.getUser();if(t||!s)throw Error("User not authenticated");return await e()}catch(e){if(t=e,V(e)&&a<s){if(console.log(`🔄 Auth error detected, attempting refresh (attempt ${a+1}/${s+1})`),!await H())throw Error("Failed to refresh session");await new Promise(e=>setTimeout(e,1e3));continue}throw e}throw t},Y=(e,s)=>!!V(e)&&(console.log("\uD83D\uDEAB Authentication error detected, redirecting to login"),s.push("/auth/login"),!0),K=Object.values(o).map(e=>({value:e,label:U[e]}));function X({isOpen:e,onClose:s,riderId:t,onProfileUpdate:a}){let r=(0,x.useRouter)(),[i,l]=(0,d.useState)({full_name:"",bio:"",hourly_rate:"",vehicle_type:"",profile_picture_url:"",active_location:""}),[o,n]=(0,d.useState)(!1),[m,u]=(0,d.useState)(null),p=e=>{let s=parseFloat(e);return!isNaN(s)&&s>0&&s<=12.5},f=(e,s)=>{if(l(t=>({...t,[e]:s})),m?.type==="error"&&u(null),"hourly_rate"===e&&s.length>0){let e=parseFloat(s);isNaN(e)?u({type:"error",text:"⚠️ Inserisci un numero valido per la tariffa"}):e<=0?u({type:"error",text:"⚠️ La tariffa deve essere maggiore di €0"}):e>12.5&&u({type:"error",text:"⚠️ Tariffa massima consentita: €12.50/h (per evitare ritenuta d'acconto)"})}},b=async e=>{e.preventDefault(),n(!0),u(null);try{if(!i.full_name.trim())throw Error("⚠️ Il nome completo \xe8 obbligatorio");if(i.hourly_rate&&!p(i.hourly_rate))throw Error("⚠️ La tariffa oraria deve essere tra €0.01 e €12.50");await $(async()=>{let{error:e}=await h.O.from("profiles").update({full_name:i.full_name.trim()||null,updated_at:new Date().toISOString()}).eq("id",t);if(e)throw console.error("Error updating profile:",e),e;let s={bio:i.bio.trim()||null,vehicle_type:i.vehicle_type||null,profile_picture_url:i.profile_picture_url.trim()||null,active_location:i.active_location.trim()||null,updated_at:new Date().toISOString()};i.hourly_rate.trim()&&(s.hourly_rate=parseFloat(i.hourly_rate));let{error:a}=await h.O.from("riders_details").update(s).eq("profile_id",t);if(a)throw console.error("Error updating rider details:",a),a},2),u({type:"success",text:"✅ Profilo aggiornato con successo!"}),a&&a(),setTimeout(()=>{s()},1500)}catch(e){if(console.error("Profile update error:",e),Y(e,r)){u({type:"error",text:"\uD83D\uDD12 Sessione scaduta. Stai per essere reindirizzato al login..."}),setTimeout(()=>{s()},2e3);return}u({type:"error",text:e.message||"❌ Errore durante l'aggiornamento del profilo. Riprova."})}finally{n(!1)}},w=()=>{u(null),s()};return e?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,c.jsxs)(N.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)(N.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,c.jsxs)("div",{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-5 w-5"}),"Modifica Profilo"]}),c.jsx(N.SZ,{children:"Aggiorna le tue informazioni di profilo rider"})]}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:w,disabled:o,children:c.jsx(j.Z,{className:"h-4 w-4"})})]}),(0,c.jsxs)(N.aY,{children:[m&&c.jsx("div",{className:`mb-4 p-3 rounded-lg ${"success"===m.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:m.text}),(0,c.jsxs)("form",{onSubmit:b,className:"space-y-4",noValidate:!0,children:[(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"fullName",className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-4 w-4"}),"Nome Completo"]}),c.jsx(v.I,{id:"fullName",type:"text",value:i.full_name,onChange:e=>f("full_name",e.target.value),placeholder:"Inserisci il tuo nome completo",disabled:o,required:!0}),c.jsx("p",{className:"text-xs text-gray-500",children:"Il nome che verr\xe0 mostrato ai clienti"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"bio",className:"flex items-center gap-2",children:[c.jsx(T.Z,{className:"h-4 w-4"}),"Bio / Descrizione"]}),c.jsx("textarea",{id:"bio",value:i.bio,onChange:e=>f("bio",e.target.value),placeholder:"Descrivi brevemente te stesso e la tua esperienza come rider...",className:"w-full p-2 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500,disabled:o}),(0,c.jsxs)("p",{className:"text-xs text-gray-500",children:["Massimo 500 caratteri (",500-i.bio.length," rimanenti)"]})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"vehicleType",className:"flex items-center gap-2",children:[c.jsx(q.Z,{className:"h-4 w-4"}),"Tipo di Veicolo"]}),(0,c.jsxs)("select",{id:"vehicleType",value:i.vehicle_type,onChange:e=>f("vehicle_type",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,children:[c.jsx("option",{value:"",children:"Seleziona veicolo"}),K.map(e=>c.jsx("option",{value:e.value,children:e.label},e.value))]})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"activeLocation",className:"flex items-center gap-2",children:[c.jsx(P.Z,{className:"h-4 w-4"}),"Localit\xe0 Attiva"]}),c.jsx(v.I,{id:"activeLocation",type:"text",value:i.active_location,onChange:e=>f("active_location",e.target.value),placeholder:"Milano, Roma, Torino, ecc...",disabled:o,maxLength:100}),c.jsx("p",{className:"text-xs text-gray-500",children:"La citt\xe0 o zona dove sei attivo per le consegne (massimo 100 caratteri)"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"hourlyRate",className:"flex items-center gap-2",children:[c.jsx(z.Z,{className:"h-4 w-4"}),"Tariffa Oraria (€/h)"]}),c.jsx(v.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:i.hourly_rate,onChange:e=>f("hourly_rate",e.target.value),placeholder:"Es. 10.00",disabled:o}),c.jsx("p",{className:"text-xs text-gray-500",children:"Tariffa massima: €12.50/h per evitare ritenuta d'acconto su prestazioni occasionali"})]}),(0,c.jsxs)("div",{className:"space-y-2",children:[(0,c.jsxs)(y._,{htmlFor:"profilePictureUrl",className:"flex items-center gap-2",children:[c.jsx(G,{className:"h-4 w-4"}),"URL Immagine Profilo"]}),c.jsx(v.I,{id:"profilePictureUrl",type:"url",value:i.profile_picture_url,onChange:e=>f("profile_picture_url",e.target.value),placeholder:"https://esempio.com/mia-foto.jpg",disabled:o}),i.profile_picture_url&&(0,c.jsxs)("div",{className:"mt-3",children:[c.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Anteprima:"}),c.jsx("div",{className:"flex justify-center",children:(0,c.jsxs)("div",{className:"relative",children:[c.jsx(B.default,{src:i.profile_picture_url,alt:"Anteprima foto profilo",width:96,height:96,className:"w-24 h-24 rounded-full object-cover border-3 border-blue-200 shadow-md",onError:e=>{e.currentTarget.style.display="none"}}),c.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]})}),c.jsx("p",{className:"text-xs text-green-600 text-center mt-2",children:"✓ Immagine caricata correttamente"})]}),c.jsx("p",{className:"text-xs text-gray-500",children:"Inserisci l'URL di un'immagine (JPG, PNG, WEBP)"})]}),(0,c.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,c.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[c.jsx(I.Z,{className:"h-4 w-4"}),"Informazioni"]}),(0,c.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Nome:"})," Mostrato ai clienti nelle prenotazioni"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Bio:"})," Aiuta i clienti a conoscerti meglio"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Veicolo:"})," Influenza i tipi di consegne disponibili"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Localit\xe0:"})," Determina la tua visibilit\xe0 nelle ricerche geografiche"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Tariffa:"})," Pu\xf2 essere aggiornata in qualsiasi momento"]}),(0,c.jsxs)("li",{children:["• ",c.jsx("strong",{children:"Foto profilo:"})," Aumenta la fiducia dei clienti"]})]})]}),(0,c.jsxs)("div",{className:"flex gap-3 pt-4",children:[c.jsx(g.z,{type:"button",variant:"outline",onClick:w,disabled:o,className:"flex-1",children:"Annulla"}),c.jsx(g.z,{type:"submit",disabled:o,className:"flex-1",children:o?(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,c.jsxs)("div",{className:"flex items-center gap-2",children:[c.jsx(E.Z,{className:"h-4 w-4"}),"Salva Modifiche"]})})]})]})]})]})}):null}var J=t(87673),W=t(34789);function Q({isOpen:e,onClose:s,request:t,riderHourlyRate:a,onRespond:r}){let{toast:i}=(0,W.pm)(),[l,o]=(0,d.useState)(!1),[n,m]=(0,d.useState)(null),[x,h]=(0,d.useState)(""),u=async e=>{if(e.preventDefault(),t&&n){o(!0);try{await r(t.id,n,x.trim()||void 0),console.log("\uD83C\uDF89 Risposta inviata con successo, mostrando toast..."),s(),setTimeout(()=>{console.log("\uD83C\uDF5E Mostrando toast dopo chiusura modal..."),console.log("\uD83D\uDCDD Toast data:",{title:"accepted"===n?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});let e=i({title:"accepted"===n?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});console.log("\uD83C\uDFAF Toast result:",e),console.log("✅ Toast chiamato con successo - dovrebbe apparire ora!")},100)}catch(e){console.error("❌ Error responding to request:",e),console.log("\uD83D\uDEA8 Mostrando toast di errore..."),i({title:"Errore",description:"Errore durante la risposta alla richiesta"}),setTimeout(()=>{console.log("\uD83D\uDD12 Chiudendo modal dopo errore..."),s()},1e3)}finally{o(!1)}}};return e&&t?c.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,c.jsxs)(N.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,c.jsxs)(N.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,c.jsxs)("div",{children:[c.jsx(N.ll,{className:"text-xl",children:"Rispondi alla Richiesta di Servizio"}),c.jsx(N.SZ,{children:t.merchant.esercenti?.business_name||t.merchant.full_name})]}),c.jsx(g.z,{variant:"ghost",size:"sm",onClick:s,children:c.jsx(j.Z,{className:"h-4 w-4"})})]}),(0,c.jsxs)(N.aY,{children:[(0,c.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 space-y-3",children:[c.jsx("h4",{className:"font-medium text-gray-900",children:"Dettagli della Richiesta"}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(w.Z,{className:"h-4 w-4 text-gray-500"}),c.jsx("span",{children:new Date(t.requested_date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(A.Z,{className:"h-4 w-4 text-gray-500"}),(0,c.jsxs)("span",{children:[t.start_time.substring(0,5)," - ",t.duration_hours,"h di servizio"]})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(P.Z,{className:"h-4 w-4 text-gray-500"}),c.jsx("span",{className:"truncate",title:t.merchant_address,children:t.merchant_address})]}),(0,c.jsxs)("div",{className:"flex items-center space-x-2",children:[c.jsx(z.Z,{className:"h-4 w-4 text-gray-500"}),(0,c.jsxs)("span",{children:["€",(t.duration_hours*(a||15)).toFixed(2)," ","(stimato)"]})]})]}),t.description&&c.jsx("div",{className:"mt-3 p-3 bg-white rounded border-l-4 border-blue-500",children:(0,c.jsxs)("div",{className:"flex items-start space-x-2",children:[c.jsx(T.Z,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Istruzioni del merchant:"}),c.jsx("p",{className:"text-sm text-blue-700",children:t.description})]})]})})]}),(0,c.jsxs)("form",{onSubmit:u,className:"space-y-6",children:[(0,c.jsxs)("div",{children:[c.jsx(y._,{className:"text-base font-medium",children:"La tua risposta *"}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[(0,c.jsxs)(g.z,{type:"button",variant:"accepted"===n?"default":"outline",className:`h-16 flex-col space-y-2 ${"accepted"===n?"bg-green-600 hover:bg-green-700":"hover:bg-green-50 hover:border-green-300"}`,onClick:()=>m("accepted"),children:[c.jsx(_.Z,{className:"h-6 w-6"}),c.jsx("span",{children:"Accetta"})]}),(0,c.jsxs)(g.z,{type:"button",variant:"rejected"===n?"default":"outline",className:`h-16 flex-col space-y-2 ${"rejected"===n?"bg-red-600 hover:bg-red-700":"hover:bg-red-50 hover:border-red-300"}`,onClick:()=>m("rejected"),children:[c.jsx(j.Z,{className:"h-6 w-6"}),c.jsx("span",{children:"Rifiuta"})]})]})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)(y._,{htmlFor:"response_message",children:["Messaggio opzionale","rejected"===n&&c.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),c.jsx(J.g,{id:"response_message",value:x,onChange:e=>h(e.target.value),placeholder:"accepted"===n?"Aggiungi eventuali note o conferme...":"Spiega il motivo del rifiuto...",className:"mt-1",rows:3,required:"rejected"===n}),c.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"rejected"===n?"Campo obbligatorio per i rifiuti":"Campo opzionale per aggiungere dettagli"})]}),(0,c.jsxs)("div",{className:"flex space-x-3 pt-4",children:[c.jsx(g.z,{type:"button",variant:"outline",onClick:s,className:"flex-1",disabled:l,children:"Annulla"}),c.jsx(g.z,{type:"submit",className:`flex-1 ${"accepted"===n?"bg-green-600 hover:bg-green-700":"rejected"===n?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"}`,disabled:l||!n||"rejected"===n&&!x.trim(),children:l?(0,c.jsxs)(c.Fragment,{children:[c.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Invio..."]}):"accepted"===n?"Accetta Richiesta":"rejected"===n?"Rifiuta Richiesta":"Seleziona risposta"})]})]})]})]})}):null}var ee=t(54707),es=t(57275),et=t(88378),ea=t(70003);let er=(0,L.Z)("Briefcase",[["rect",{width:"20",height:"14",x:"2",y:"7",rx:"2",ry:"2",key:"eto64e"}],["path",{d:"M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16",key:"zwj3tp"}]]),ei={bici:{icon:"\uD83D\uDEB2",label:"Bicicletta"},e_bike:{icon:"\uD83D\uDEB4‍♂️",label:"E-Bike"},scooter:{icon:"\uD83D\uDEF5",label:"Scooter"},auto:{icon:"\uD83D\uDE97",label:"Auto"}};function el({profile:e,portfolioData:s,onProfileUpdate:t,onPortfolioSave:a,onPortfolioEdit:r,onboardingState:i,requiredState:l}){let[o,n]=(0,d.useState)(!1),[m,x]=(0,d.useState)(!1),[h,u]=(0,d.useState)(!1),p=()=>({images:s?.portfolioImages?.length||0,certifications:s?.certifications?.length||0,portfolioUrl:s?.portfolioUrl?1:0});return i>=l?(0,c.jsxs)(c.Fragment,{children:[(0,c.jsxs)(N.Zb,{children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-5 w-5"})," Profilo & Disponibilit\xe0"]}),c.jsx(N.SZ,{children:"Gestisci il tuo profilo, tariffa, calendario e portfolio"})]}),(0,c.jsxs)(N.aY,{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"border-b pb-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-4 w-4"})," Profilo Rider"]}),(0,c.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,c.jsxs)("div",{className:"flex flex-col items-center text-center",children:[e.riders_details?.profile_picture_url?(0,c.jsxs)("div",{className:"relative",children:[c.jsx(B.default,{src:e.riders_details.profile_picture_url,alt:"Foto profilo",width:128,height:128,className:"w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl",onError:e=>{e.currentTarget.style.display="none"}}),c.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:c.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]}):(0,c.jsxs)("div",{className:"relative",children:[c.jsx("div",{className:"w-32 h-32 rounded-full flex items-center justify-center shadow-xl border-4 border-white",style:{background:"linear-gradient(to bottom right, #333366, #4a4a7a)"},children:c.jsx("span",{className:"text-3xl font-bold text-white",children:e.full_name?e.full_name.charAt(0).toUpperCase():e.rider_tax_details?.first_name?.charAt(0).toUpperCase()||"R"})}),c.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:c.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]}),(0,c.jsxs)("div",{className:"mt-4 space-y-2",children:[c.jsx("h4",{className:"text-xl font-bold text-gray-900",children:e.rider_tax_details?.first_name&&e.rider_tax_details?.last_name?`${e.rider_tax_details.first_name} ${e.rider_tax_details.last_name}`:e.full_name||"Nome non impostato"}),(0,c.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-2",children:[[1,2,3,4,5].map(e=>c.jsx("svg",{className:"w-4 h-4 text-yellow-400 fill-current",viewBox:"0 0 20 20",children:c.jsx("path",{d:"M10 1l2.5 6.5h6.5l-5.25 4 2 6.5-5.75-4.25-5.75 4.25 2-6.5-5.25-4h6.5z"})},e)),c.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"5.0 • Nuovo rider"})]}),c.jsx("div",{className:"flex items-center justify-center gap-2",children:(e=>{let s=ei[e];return s?(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-700 capitalize",children:[s.icon," ",s.label]}):c.jsx("span",{className:"text-sm font-medium text-gray-700",children:"Veicolo non specificato"})})(e.riders_details?.vehicle_type)})]})]}),(0,c.jsxs)("div",{className:"flex-1 space-y-4",children:[e.riders_details?.bio&&c.jsx("div",{children:(0,c.jsxs)("p",{className:"text-gray-700 italic text-center md:text-left",children:['"',e.riders_details.bio,'"']})}),(0,c.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,c.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,c.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["€",e.riders_details?.hourly_rate||0]}),c.jsx("div",{className:"text-sm text-gray-600",children:"per ora"})]}),(0,c.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[c.jsx("div",{className:"text-lg font-bold text-green-600",children:"Disponibile"}),c.jsx("div",{className:"text-xs text-gray-600",children:"Aggiornato oggi"})]})]}),(0,c.jsxs)("div",{className:"flex gap-2",children:[(0,c.jsxs)(g.z,{variant:"outline",size:"sm",onClick:()=>u(!0),className:"flex-1",children:[c.jsx(ea.Z,{className:"w-4 h-4 mr-2"}),"Modifica Profilo"]}),(0,c.jsxs)(g.z,{variant:"outline",size:"sm",onClick:()=>x(!0),className:"flex-1",children:[c.jsx(z.Z,{className:"w-4 h-4 mr-2"}),"Tariffa"]})]})]})]})]}),(0,c.jsxs)("div",{className:"border-b pb-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(w.Z,{className:"h-4 w-4"})," Disponibilit\xe0"]}),c.jsx("div",{className:"text-center",children:(0,c.jsxs)(g.z,{variant:"outline",onClick:()=>n(!0),className:"w-full md:w-auto",children:[c.jsx(w.Z,{className:"w-4 h-4 mr-2"}),"Gestisci Calendario Disponibilit\xe0"]})})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(er,{className:"h-4 w-4"})," Portfolio"]}),s?(0,c.jsxs)("div",{className:"space-y-4",children:[(()=>{let e=p();return(0,c.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,c.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:e.images}),c.jsx("p",{className:"text-xs text-gray-600",children:"Immagini"})]}),(0,c.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:e.certifications}),c.jsx("p",{className:"text-xs text-gray-600",children:"Certificazioni"})]}),(0,c.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:e.portfolioUrl}),c.jsx("p",{className:"text-xs text-gray-600",children:"Portfolio Web"})]})]})})(),s.portfolioImages?.length>0&&(0,c.jsxs)("div",{className:"flex justify-center gap-2",children:[s.portfolioImages.slice(0,3).map((e,s)=>c.jsx("div",{className:"w-16 h-16 rounded-lg overflow-hidden border",children:c.jsx(B.default,{src:e,alt:`Portfolio ${s+1}`,width:64,height:64,className:"w-full h-full object-cover"})},s)),s.portfolioImages.length>3&&c.jsx("div",{className:"w-16 h-16 rounded-lg bg-gray-100 border flex items-center justify-center",children:(0,c.jsxs)("span",{className:"text-xs text-gray-500",children:["+",s.portfolioImages.length-3]})})]}),(0,c.jsxs)(g.z,{variant:"outline",onClick:r,className:"w-full",children:[c.jsx(ea.Z,{className:"w-4 h-4 mr-2"}),"Modifica Portfolio"]})]}):(0,c.jsxs)("div",{className:"text-center py-8",children:[c.jsx(er,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-500 mb-2",children:"Portfolio non configurato"}),c.jsx("p",{className:"text-sm text-gray-400 mb-4",children:"Crea il tuo portfolio per attrarre pi\xf9 clienti"}),c.jsx(g.z,{onClick:r,style:{backgroundColor:"#333366"},children:"Crea Portfolio"})]})]})]})]}),o&&e&&c.jsx(C,{riderId:e.id,onClose:()=>n(!1)}),m&&e&&c.jsx(k,{riderId:e.id,currentRate:e.riders_details?.hourly_rate||null,onClose:()=>x(!1)}),h&&e&&c.jsx(X,{isOpen:h,onClose:()=>u(!1),riderId:e.id,onProfileUpdate:t})]}):c.jsx(N.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,c.jsxs)(N.aY,{className:"relative px-6 pt-6 pb-6",children:[c.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,c.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[c.jsx(et.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(O.Z,{className:"h-5 w-5"})," Profilo & Disponibilit\xe0"]}),c.jsx(N.SZ,{children:"Gestisci il tuo profilo, tariffa, calendario e portfolio"})]})]})})}var eo=t(32333);let en=(0,L.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var ec=t(37202);function ed({serviceRequests:e,profile:s,onOpenRespondModal:t,onboardingState:a,requiredState:r}){let i=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"accepted":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"completed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},l=e=>{switch(e){case"pending":return"In Attesa";case"accepted":return"Accettata";case"rejected":return"Rifiutata";case"completed":return"Completata";case"cancelled":return"Annullata";default:return e}},o=e=>(s.riders_details?.hourly_rate||0)*e.duration_hours;return a>=r?(0,c.jsxs)(N.Zb,{children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(eo.Z,{className:"h-5 w-5"})," Gestione Lavoro"]}),c.jsx(N.SZ,{children:"Gestisci richieste di servizio e prenotazioni attive"})]}),(0,c.jsxs)(N.aY,{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,c.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[c.jsx("p",{className:"text-2xl font-bold text-yellow-600",children:e.filter(e=>"pending"===e.status).length}),c.jsx("p",{className:"text-sm text-yellow-700 font-medium",children:"In Attesa"}),c.jsx("p",{className:"text-xs text-yellow-600 mt-1",children:"Richieste nuove"})]}),(0,c.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[c.jsx("p",{className:"text-2xl font-bold text-green-600",children:e.filter(e=>"accepted"===e.status).length}),c.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Accettate"}),c.jsx("p",{className:"text-xs text-green-600 mt-1",children:"Lavoro confermato"})]}),(0,c.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[c.jsx("p",{className:"text-2xl font-bold text-blue-600",children:e.filter(e=>["in_progress","booked"].includes(e.status)).length}),c.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Attive"}),c.jsx("p",{className:"text-xs text-blue-600 mt-1",children:"In corso"})]})]}),(0,c.jsxs)("div",{className:"space-y-4",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[c.jsx(en,{className:"h-4 w-4"})," Richieste Recenti"]}),0===e.length?(0,c.jsxs)("div",{className:"text-center py-12",children:[c.jsx(en,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-500 mb-2 text-lg",children:"Nessuna richiesta ricevuta"}),c.jsx("p",{className:"text-sm text-gray-400 max-w-md mx-auto",children:"Le nuove richieste di servizio appariranno qui automaticamente. Tieni aggiornato il tuo profilo per ricevere pi\xf9 richieste!"})]}):c.jsx("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:e.slice(0,5).map(e=>c.jsx("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,c.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,c.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"font-semibold text-gray-900 truncate",children:e.merchant.esercenti?.business_name||e.merchant.full_name}),(0,c.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:[e.merchant.esercenti?.address,","," ",e.merchant.esercenti?.city]})]}),c.jsx("span",{className:`px-2 py-1 text-xs rounded-full whitespace-nowrap ${i(e.status)}`,children:l(e.status)})]}),(0,c.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-2",children:[(0,c.jsxs)("div",{className:"flex items-center gap-1",children:[c.jsx(w.Z,{className:"w-4 h-4"}),new Date(e.requested_date).toLocaleDateString("it-IT")]}),(0,c.jsxs)("div",{className:"flex items-center gap-1",children:[c.jsx(A.Z,{className:"w-4 h-4"}),e.start_time.substring(0,5)," •"," ",e.duration_hours,"h"]}),(0,c.jsxs)("div",{className:"flex items-center gap-1",children:[c.jsx(z.Z,{className:"w-4 h-4"}),"€",o(e)]})]}),e.description&&c.jsx("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.description})]}),c.jsx("div",{className:"flex flex-col sm:flex-row gap-2 sm:min-w-fit",children:"pending"===e.status?c.jsx(g.z,{size:"sm",onClick:()=>t(e),className:"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto",children:"Rispondi"}):(0,c.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:["accepted"===e.status&&(0,c.jsxs)("div",{className:"flex items-center gap-1 justify-center",children:[c.jsx(_.Z,{className:"w-3 h-3 text-green-500"}),"Confermata"]}),"rejected"===e.status&&(0,c.jsxs)("div",{className:"flex items-center gap-1 justify-center",children:[c.jsx(ec.Z,{className:"w-3 h-3 text-red-500"}),"Rifiutata"]})]})})]})},e.id))}),e.length>5&&c.jsx("div",{className:"text-center pt-4 border-t",children:(0,c.jsxs)(g.z,{variant:"outline",className:"w-full",children:["Visualizza Tutte le Richieste (",e.length,")"]})})]}),(0,c.jsxs)("div",{className:"border-t pt-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(w.Z,{className:"h-4 w-4"})," Prenotazioni Attive"]}),(0,c.jsxs)("div",{className:"text-center py-8",children:[c.jsx(w.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),c.jsx("p",{className:"text-gray-500 mb-2",children:"Nessuna prenotazione attiva"}),c.jsx("p",{className:"text-sm text-gray-400",children:"Le prenotazioni confermate appariranno qui"})]})]})]})]}):c.jsx(N.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,c.jsxs)(N.aY,{className:"relative px-6 pt-6 pb-6",children:[c.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,c.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[c.jsx(A.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(eo.Z,{className:"h-5 w-5"})," Gestione Lavoro"]}),c.jsx(N.SZ,{children:"Gestisci richieste di servizio e prenotazioni attive"})]})]})})}let em=(0,L.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]),ex=(0,L.Z)("Banknote",[["rect",{width:"20",height:"12",x:"2",y:"6",rx:"2",key:"9lu3g6"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}],["path",{d:"M6 12h.01M18 12h.01",key:"113zkx"}]]),eh=(0,L.Z)("CircleDollarSign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]),eu=(0,L.Z)("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]),ep=(0,L.Z)("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1-2-1Z",key:"wqdwcb"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17V7",key:"pyj7ub"}]]);function eg({profile:e,onStripeOnboarding:s,onManagePayments:t,onboardingState:a,requiredState:r,loading:i}){let[l,o]=(0,d.useState)(!1),n=async()=>{o(!0);try{await new Promise(e=>setTimeout(e,1e3))}catch(e){console.error("Error checking onboarding status:",e)}finally{o(!1)}};return a>=r?(0,c.jsxs)(N.Zb,{children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(em,{className:"h-5 w-5"})," Pagamenti & Guadagni"]}),c.jsx(N.SZ,{children:"Gestisci pagamenti Stripe e monitora i tuoi guadagni"})]}),(0,c.jsxs)(N.aY,{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"border-b pb-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(ex,{className:"h-4 w-4"})," Account Pagamenti"]}),e.riders_details?.stripe_onboarding_complete?c.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,c.jsxs)("div",{className:"flex items-center justify-between",children:[(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(_.Z,{className:"h-8 w-8 text-green-600"}),(0,c.jsxs)("div",{children:[c.jsx("h4",{className:"font-semibold text-green-800",children:"Account Stripe Attivo"}),c.jsx("p",{className:"text-sm text-green-600",children:"Puoi ricevere pagamenti dai clienti"})]})]}),c.jsx(g.z,{variant:"outline",onClick:t,disabled:i,className:"border-green-300 text-green-700 hover:bg-green-100",children:i?"Caricamento...":"Gestisci Account"})]})}):c.jsx("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,c.jsxs)("div",{className:"flex items-start gap-3",children:[c.jsx(ec.Z,{className:"h-8 w-8 text-yellow-600 mt-0.5"}),(0,c.jsxs)("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Configurazione Account Stripe Richiesta"}),c.jsx("p",{className:"text-sm text-yellow-700 mb-4",children:"Completa l'onboarding Stripe per attivare i pagamenti e ricevere compensi per i tuoi servizi. Il processo richiede pochi minuti."}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[c.jsx(g.z,{onClick:s,disabled:i,className:"bg-green-600 hover:bg-green-700 flex-1",children:i?"Caricamento...":"Attiva Pagamenti"}),e.riders_details?.stripe_account_id&&c.jsx(g.z,{variant:"outline",onClick:n,disabled:l,className:"border-yellow-300 text-yellow-700 hover:bg-yellow-100",children:l?"Verificando...":"Verifica Stato"})]})]})]})})]}),(0,c.jsxs)("div",{children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(eh,{className:"h-4 w-4"})," Guadagni e Statistiche"]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,c.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm text-blue-700 font-medium",children:"Guadagni Totali"}),c.jsx("p",{className:"text-2xl font-bold text-blue-900",children:"€0.00"})]}),c.jsx(eu,{className:"h-8 w-8 text-blue-600"})]}),c.jsx("p",{className:"text-xs text-blue-600",children:"Da quando hai iniziato"})]}),(0,c.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,c.jsxs)("div",{children:[c.jsx("p",{className:"text-sm text-green-700 font-medium",children:"Questo Mese"}),c.jsx("p",{className:"text-2xl font-bold text-green-900",children:"€0.00"})]}),c.jsx(w.Z,{className:"h-8 w-8 text-green-600"})]}),c.jsx("p",{className:"text-xs text-green-600",children:"In crescita del 0%"})]})]}),(0,c.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,c.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:"0"}),c.jsx("p",{className:"text-xs text-gray-600",children:"Lavori Completati"})]}),(0,c.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:"0h"}),c.jsx("p",{className:"text-xs text-gray-600",children:"Ore Lavorate"})]}),(0,c.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:"€0"}),c.jsx("p",{className:"text-xs text-gray-600",children:"Media per Lavoro"})]}),(0,c.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[c.jsx("p",{className:"text-lg font-bold text-gray-900",children:"0"}),c.jsx("p",{className:"text-xs text-gray-600",children:"Valutazioni"})]})]}),(0,c.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,c.jsxs)(g.z,{variant:"outline",className:"flex-1",children:[c.jsx(ep,{className:"w-4 h-4 mr-2"}),"Visualizza Storico Pagamenti"]}),(0,c.jsxs)(g.z,{variant:"outline",className:"flex-1",children:[c.jsx(eu,{className:"w-4 h-4 mr-2"}),"Report Dettagliati"]})]}),!e.riders_details?.stripe_onboarding_complete&&c.jsx("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:(0,c.jsxs)("p",{className:"text-sm text-orange-700",children:["\uD83D\uDCA1 ",c.jsx("strong",{children:"Nota:"})," I guadagni verranno visualizzati automaticamente dopo l'attivazione dell'account Stripe e il completamento dei primi lavori."]})})]})]})]}):c.jsx(N.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,c.jsxs)(N.aY,{className:"relative px-6 pt-6 pb-6",children:[c.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,c.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[c.jsx(em,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(em,{className:"h-5 w-5"})," Pagamenti & Guadagni"]}),c.jsx(N.SZ,{children:"Gestisci pagamenti Stripe e monitora i tuoi guadagni"})]})]})})}let ef=(0,L.Z)("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);var ej=t(58038);let eb=(0,L.Z)("HelpCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]),eN=(0,L.Z)("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);function ev({profile:e,onUpdateRate:s,onFiscalData:t,onDeleteAccount:a,onboardingState:r,requiredState:i}){return r>=i?(0,c.jsxs)(N.Zb,{children:[(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(et.Z,{className:"h-5 w-5"})," Impostazioni"]}),c.jsx(N.SZ,{children:"Gestisci impostazioni account, preferenze e dati fiscali"})]}),(0,c.jsxs)(N.aY,{className:"space-y-6",children:[(0,c.jsxs)("div",{className:"space-y-3",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[c.jsx(et.Z,{className:"h-4 w-4"})," Azioni Rapide"]}),(0,c.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[c.jsx(g.z,{variant:"outline",className:"h-auto p-4 justify-start",onClick:s,disabled:!e.riders_details?.stripe_onboarding_complete,children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(z.Z,{className:"h-5 w-5 text-blue-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Aggiorna Tariffa"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Modifica prezzo orario"})]})]})}),c.jsx(g.z,{variant:"outline",className:"h-auto p-4 justify-start",onClick:t,disabled:!e.riders_details?.stripe_onboarding_complete,children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(Z.Z,{className:"h-5 w-5 text-green-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Dati Fiscali"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Gestisci informazioni fiscali"})]})]})}),c.jsx(g.z,{variant:"outline",className:"h-auto p-4 justify-start",disabled:!e.riders_details?.stripe_onboarding_complete,children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(A.Z,{className:"h-5 w-5 text-purple-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Cronologia"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Visualizza storico attivit\xe0"})]})]})}),c.jsx(g.z,{variant:"outline",className:"h-auto p-4 justify-start",disabled:!e.riders_details?.stripe_onboarding_complete,children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(ef,{className:"h-5 w-5 text-orange-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Notifiche"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Impostazioni notifiche"})]})]})})]}),!e.riders_details?.stripe_onboarding_complete&&c.jsx("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:c.jsx("p",{className:"text-sm text-orange-700 text-center",children:"Completa l'onboarding Stripe per abilitare queste funzioni"})})]}),(0,c.jsxs)("div",{className:"border-t pt-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(ej.Z,{className:"h-4 w-4"})," Sicurezza e Privacy"]}),(0,c.jsxs)("div",{className:"space-y-3",children:[c.jsx(g.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(O.Z,{className:"h-5 w-5 text-indigo-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Profilo e Sicurezza"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Gestisci password e sicurezza account"})]})]})}),c.jsx(g.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(ej.Z,{className:"h-5 w-5 text-indigo-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Privacy e Dati"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Controlla le tue impostazioni privacy"})]})]})})]})]}),(0,c.jsxs)("div",{className:"border-t pt-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[c.jsx(eb,{className:"h-4 w-4"})," Supporto"]}),(0,c.jsxs)("div",{className:"space-y-3",children:[c.jsx(g.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(eb,{className:"h-5 w-5 text-teal-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Centro Assistenza"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Guide, FAQ e supporto"})]})]})}),c.jsx(g.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,c.jsxs)("div",{className:"flex items-center gap-3",children:[c.jsx(ef,{className:"h-5 w-5 text-teal-600"}),(0,c.jsxs)("div",{className:"text-left",children:[c.jsx("div",{className:"font-medium",children:"Contatta Supporto"}),c.jsx("div",{className:"text-xs text-gray-500",children:"Hai bisogno di aiuto?"})]})]})})]})]}),(0,c.jsxs)("div",{className:"border-t pt-6",children:[(0,c.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-red-600",children:[c.jsx(ec.Z,{className:"h-4 w-4"})," Zona Pericolo"]}),c.jsx("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,c.jsxs)("div",{className:"flex items-start gap-3",children:[c.jsx(ec.Z,{className:"h-6 w-6 text-red-600 mt-0.5"}),(0,c.jsxs)("div",{className:"flex-1",children:[c.jsx("h4",{className:"font-medium text-red-800 mb-2",children:"Eliminazione Account"}),c.jsx("p",{className:"text-sm text-red-700 mb-3",children:"Questa azione \xe8 irreversibile. Tutti i tuoi dati, inclusi profilo, portfolio e cronologia dei lavori verranno eliminati definitivamente."}),(0,c.jsxs)(g.z,{variant:"outline",size:"sm",onClick:a,className:"border-red-300 text-red-700 hover:bg-red-100",children:[c.jsx(eN,{className:"w-4 h-4 mr-2"}),"Elimina Account"]})]})]})})]})]})]}):c.jsx(N.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,c.jsxs)(N.aY,{className:"relative px-6 pt-6 pb-6",children:[c.jsx("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,c.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[c.jsx(et.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),c.jsx("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),c.jsx("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,c.jsxs)(N.Ol,{children:[(0,c.jsxs)(N.ll,{className:"flex items-center gap-2",children:[c.jsx(et.Z,{className:"h-5 w-5"})," Impostazioni"]}),c.jsx(N.SZ,{children:"Gestisci impostazioni account e preferenze"})]})]})})}!function(e){e[e.STRIPE_ONLY=0]="STRIPE_ONLY",e[e.BASIC_PROFILE=1]="BASIC_PROFILE",e[e.AVAILABILITY=2]="AVAILABILITY",e[e.FULL_FEATURES=3]="FULL_FEATURES"}(n||(n={}));let ey=[{key:"stripe",label:"Stripe",description:"Attiva pagamenti"},{key:"profile",label:"Profilo",description:"Completa profilo"},{key:"availability",label:"Disponibilit\xe0",description:"Imposta orari"},{key:"portfolio",label:"Portfolio",description:"Crea portfolio"}],ew=e=>e?.stripe_onboarding_complete?e?.hourly_rate&&e?.bio?e?.availabilityConfigured?3:2:1:0,e_=({currentState:e})=>e>=3?null:(0,c.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,c.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,c.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Onboarding: ",e+1," di ",ey.length," completati"]}),(0,c.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round((e+1)/ey.length*100),"%"]})]}),c.jsx("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:c.jsx("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-500",style:{width:`${(e+1)/ey.length*100}%`}})})]}),eD=()=>{let[e,s]=(0,d.useState)(null),[t,a]=(0,d.useState)(!1),[r,i]=(0,d.useState)(!1),[l,o]=(0,d.useState)(!1),[n,c]=(0,d.useState)(!1),[m,x]=(0,d.useState)(!0),[h,u]=(0,d.useState)(null),[p,g]=(0,d.useState)(null),[f,j]=(0,d.useState)(!1),[b,N]=(0,d.useState)(!1),[v,y]=(0,d.useState)(!1),[w,_]=(0,d.useState)([]),[D,A]=(0,d.useState)(!1),[E,S]=(0,d.useState)(null),[C,z]=(0,d.useState)(!1),[I,R]=(0,d.useState)(null);return{profile:e,setProfile:s,showAvailabilityCalendar:t,setShowAvailabilityCalendar:a,showUpdateRateModal:r,setShowUpdateRateModal:i,showFiscalDataModal:l,setShowFiscalDataModal:o,showEditProfileModal:n,setShowEditProfileModal:c,loading:m,setLoading:x,error:h,setError:u,onboardingUrl:p,setOnboardingUrl:g,checkingOnboarding:f,setCheckingOnboarding:j,loggingOut:b,setLoggingOut:N,showDeleteModal:v,setShowDeleteModal:y,serviceRequests:w,setServiceRequests:_,showRespondModal:D,setShowRespondModal:A,selectedRequest:E,setSelectedRequest:S,showPortfolioEditor:C,setShowPortfolioEditor:z,portfolioData:I,setPortfolioData:R}};function eA(){let e=eD(),s=(0,x.useRouter)(),t=(0,x.useSearchParams)(),a=(0,d.useRef)(!1),r=(0,d.useRef)(!1),i=(0,d.useRef)(!1),l=(0,d.useMemo)(()=>e.profile?.id,[e.profile?.id]),o=(0,d.useMemo)(()=>t.get("onboarding_complete"),[t]),[n,m]=(0,d.useState)(!1),[g,f]=(0,d.useState)(!1),{isOpen:j,toggle:N}=function(){let[e,s]=(0,d.useState)(!1);return{isOpen:e,toggle:()=>s(!e),open:()=>s(!0),close:()=>s(!1)}}(),v=[{id:"profilo",label:"Profilo & Disponibilit\xe0",icon:c.jsx(O.Z,{className:"h-5 w-5"})},{id:"lavoro",label:"Gestione Lavoro",icon:c.jsx(er,{className:"h-5 w-5"})},{id:"pagamenti",label:"Pagamenti",icon:c.jsx(em,{className:"h-5 w-5"})},{id:"impostazioni",label:"Impostazioni",icon:c.jsx(et.Z,{className:"h-5 w-5"})}],y=(0,d.useCallback)(async()=>{if(a.current){console.log("\uD83D\uDEAB FETCH PROFILE already running, skipping");return}if(i.current&&!o){console.log("\uD83D\uDEAB PROFILE already fetched, skipping");return}a.current=!0,console.log("\uD83D\uDD04 FETCH PROFILE started");try{let{data:{user:t},error:r}=await h.O.auth.getUser();if(r||!t){console.error("\uD83D\uDEAB No authenticated user, redirecting to login"),s.push("/auth/login");return}let{data:l,error:o}=await h.O.from("profiles").select(`
          id, full_name, avatar_url, role,
          riders_details (
            vehicle_type, profile_picture_url, bio, hourly_rate,
            stripe_account_id, stripe_onboarding_complete
          ),
          rider_tax_details (
            first_name, last_name, fiscal_code, birth_place,
            birth_date, residence_address, residence_city
          )
        `).eq("id",t.id).single();if(o){if("PGRST116"===o.code){if(t.user_metadata?.role==="rider"){let{error:e}=await h.O.from("profiles").insert({id:t.id,full_name:t.user_metadata.full_name||"New Rider",role:"rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(!e){await h.O.from("riders_details").insert({profile_id:t.id,hourly_rate:15,bio:"New Rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),i.current=!1,a.current=!1,setTimeout(()=>y(),100);return}}else{s.push("/auth/register");return}}console.error("❌ Error fetching profile:",o),e.setError("Errore nel caricamento del profilo");return}if(l?.role!=="rider"){"merchant"===l.role?s.push("/dashboard/merchant"):s.push("/auth/login");return}let n=Array.isArray(l.riders_details)?l.riders_details[0]:l.riders_details;e.setProfile({id:l.id,full_name:l.full_name,avatar_url:l.avatar_url,riders_details:n||null,rider_tax_details:Array.isArray(l.rider_tax_details)?l.rider_tax_details[0]||null:l.rider_tax_details||null}),i.current=!0,console.log("✅ Profile loaded successfully")}catch(s){console.error("Error fetching profile:",s),e.setError("Errore nel caricamento del profilo")}finally{a.current=!1,e.setLoading(!1)}},[s,o,e]),w=async()=>{e.setLoading(!0),e.setError(null);try{let e=await fetch("/api/stripe/onboarding",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to start onboarding")}let s=await e.json();if(s.url)window.location.href=s.url;else throw Error("No URL returned from Stripe")}catch(s){console.error("Error starting Stripe onboarding:",s),e.setError(s.message||"\xc8 sorto un errore durante l'attivazione dei pagamenti")}finally{e.setLoading(!1)}},_=async()=>{let{data:{user:s}}=await h.O.auth.getUser();if(!s){e.setError("Devi effettuare il login per utilizzare questa funzionalit\xe0");return}if(!e.profile?.riders_details?.stripe_account_id){e.setError("ID dell'account Stripe non trovato.");return}e.setLoading(!0),e.setError(null);try{let s=await fetch("/api/stripe/create-login-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:e.profile.riders_details.stripe_account_id})}),{url:t,error:a}=await s.json();if(a)throw Error(a);t&&window.open(t,"_blank")}catch(s){console.error("Error creating Stripe login link:",s),e.setError(s.message||"Failed to open Stripe Dashboard.")}finally{e.setLoading(!1)}},D=(0,d.useCallback)(async()=>{if(!l){console.log("\uD83D\uDEAB No profile ID, skipping service requests");return}if(r.current){console.log("\uD83D\uDEAB Already fetching service requests, skipping");return}r.current=!0,console.log("\uD83D\uDD04 Fetching service requests for:",l);try{let{data:s,error:t}=await h.O.from("service_requests").select(`
          id, requested_date, start_time, duration_hours,
          merchant_address, description, status, rider_response,
          created_at, updated_at,
          merchant:profiles!merchant_id (
            id, full_name,
            esercenti (business_name, address, city)
          )
        `).eq("rider_id",l).order("created_at",{ascending:!1});if(t)throw t;let a=(s||[]).map(e=>{let s=Array.isArray(e.merchant)?e.merchant[0]:e.merchant;return{...e,merchant:{...s,esercenti:Array.isArray(s?.esercenti)?s.esercenti[0]:s?.esercenti}}}).filter(e=>e.merchant);e.setServiceRequests(a),console.log("✅ Service requests loaded:",a.length)}catch(s){console.error("❌ Error fetching service requests:",s),e.setError("Errore nel caricamento delle richieste di servizio")}finally{r.current=!1}},[l,e]);(0,d.useCallback)(async()=>{if(!e.profile?.id){console.log("\uD83D\uDEAB NO PROFILE ID - skipping portfolio fetch");return}if(n){console.log("\uD83D\uDEAB ALREADY FETCHING - skipping portfolio fetch");return}if(g){console.log("\uD83D\uDEAB ALREADY FETCHED - skipping portfolio fetch");return}if(!window.location.pathname.includes("/dashboard/rider")){console.log("\uD83D\uDEAB NOT ON DASHBOARD - skipping portfolio fetch");return}console.log("\uD83D\uDD04 FETCHING PORTFOLIO DATA - ALL CHECKS PASSED"),m(!0);try{let s=await fetch(`/api/riders/${e.profile.id}/portfolio`);if(s.ok){let t=await s.json();console.log("✅ PORTFOLIO DATA RECEIVED:",t),e.setPortfolioData(t),f(!0)}else console.error("❌ Portfolio API error:",s.status),e.setPortfolioData({portfolioImages:[],certifications:[],portfolioUrl:"",servicesDescription:""}),f(!0)}catch(s){console.error("❌ Portfolio fetch error:",s),e.setPortfolioData({portfolioImages:[],certifications:[],portfolioUrl:"",servicesDescription:""}),f(!0)}finally{m(!1)}},[n,g,e]);let A=async s=>{if(e.profile)try{if(!(await fetch(`/api/riders/${e.profile.id}/portfolio`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(s)})).ok)throw Error("Errore nel salvataggio del portfolio");e.setPortfolioData(s),f(!1),console.log("✅ Portfolio salvato con successo")}catch(e){throw console.error("Errore nel salvataggio del portfolio:",e),e}},E=(0,d.useCallback)(async(e,s,t)=>{try{let a=await fetch(`/api/service-requests/${e}/respond`,{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,riderResponse:t,userId:l})});if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);let i=await a.json();if(!i.success)throw Error(i.error||"Failed to respond to request");console.log("✅ Response sent successfully"),r.current=!1,D()}catch(e){throw console.error("❌ Error responding to request:",e),e}},[l,D]),S=(0,d.useCallback)(async()=>{try{e.setLoggingOut(!0),console.log("\uD83D\uDEAA Logging out rider..."),await h.O.auth.signOut(),console.log("✅ Logout successful, redirecting to home"),s.push("/")}catch(s){console.error("❌ Error during logout:",s),e.setError("Errore durante il logout"),e.setLoggingOut(!1)}},[s,e]);if(e.loading&&!e.profile)return c.jsx(es.Iq,{});if(e.error)return(0,c.jsxs)("div",{children:["Error: ",e.error]});if(!e.profile)return c.jsx("div",{children:"Could not load profile."});let z=ew(e.profile.riders_details);return(0,c.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[c.jsx(p.Z,{userRole:"rider",userName:e.profile?.full_name||"Rider",onLogout:S,onDeleteAccount:()=>e.setShowDeleteModal(!0)}),c.jsx(b,{items:v,onItemClick:e=>{let s=document.getElementById(e);if(s){let e=s.offsetTop-80;window.scrollTo({top:e,behavior:"smooth"})}},isMobile:!1,isOpen:!0,onToggle:N}),(0,c.jsxs)("div",{className:"container mx-auto px-4 py-8 pt-20",children:[(0,c.jsxs)("div",{className:"mb-8",children:[(0,c.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Benvenuto, ",e.profile.full_name,"! \uD83D\uDEB4‍♂️"]}),c.jsx("p",{className:"text-gray-600",children:"Completa l'onboarding per sbloccare tutte le funzionalit\xe0"})]}),c.jsx(e_,{currentState:z}),e.error&&c.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:e.error}),(0,c.jsxs)("div",{className:"flex flex-col space-y-4 md:space-y-6 lg:max-w-4xl lg:mx-auto",children:[c.jsx("div",{id:"pagamenti",children:c.jsx(eg,{profile:e.profile,onStripeOnboarding:w,onManagePayments:_,onboardingState:z,requiredState:0,loading:e.loading})}),c.jsx("div",{id:"profilo",children:c.jsx(el,{profile:e.profile,portfolioData:e.portfolioData,onProfileUpdate:()=>{i.current=!1,y()},onPortfolioSave:A,onPortfolioEdit:()=>e.setShowPortfolioEditor(!0),onboardingState:z,requiredState:1})}),c.jsx("div",{id:"lavoro",children:c.jsx(ed,{serviceRequests:e.serviceRequests,profile:e.profile,onOpenRespondModal:s=>{e.setSelectedRequest(s),e.setShowRespondModal(!0)},onboardingState:z,requiredState:2})}),c.jsx("div",{id:"impostazioni",children:c.jsx(ev,{profile:e.profile,onUpdateRate:()=>e.setShowUpdateRateModal(!0),onFiscalData:()=>e.setShowFiscalDataModal(!0),onDeleteAccount:()=>e.setShowDeleteModal(!0),onboardingState:z,requiredState:1})})]})]}),c.jsx(u.Z,{isOpen:e.showDeleteModal,onClose:()=>e.setShowDeleteModal(!1),userRole:"rider"}),e.showAvailabilityCalendar&&e.profile&&c.jsx(C,{riderId:e.profile.id,onClose:()=>e.setShowAvailabilityCalendar(!1)}),e.showUpdateRateModal&&e.profile&&c.jsx(k,{riderId:e.profile.id,currentRate:e.profile.riders_details?.hourly_rate||null,onClose:()=>e.setShowUpdateRateModal(!1)}),e.showFiscalDataModal&&e.profile&&c.jsx(F,{isOpen:e.showFiscalDataModal,riderId:e.profile.id,onClose:()=>e.setShowFiscalDataModal(!1)}),e.showEditProfileModal&&e.profile&&c.jsx(X,{isOpen:e.showEditProfileModal,onClose:()=>e.setShowEditProfileModal(!1),riderId:e.profile.id,onProfileUpdate:y}),c.jsx(Q,{isOpen:e.showRespondModal,onClose:()=>{e.setShowRespondModal(!1),e.setSelectedRequest(null)},request:e.selectedRequest,riderHourlyRate:e.profile?.riders_details?.hourly_rate||null,onRespond:E}),e.showPortfolioEditor&&e.portfolioData&&e.profile&&c.jsx(ee.Z,{initialData:e.portfolioData,onSave:A,onClose:()=>e.setShowPortfolioEditor(!1)})]})}function eE(){return c.jsx(d.Suspense,{fallback:c.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,c.jsxs)("div",{className:"text-center",children:[c.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 mx-auto",style:{borderBottomColor:"#333366"}}),c.jsx("p",{className:"mt-4 text-gray-600",children:"Caricamento dashboard..."})]})}),children:c.jsx(eA,{})})}},40617:(e,s,t)=>{"use strict";t.d(s,{Z:()=>a});let a=(0,t(76557).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},12177:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>r});var a=t(19510);function r({children:e}){return a.jsx("div",{className:"min-h-screen bg-gray-50 overflow-x-hidden",children:a.jsx("div",{className:"relative",children:a.jsx("div",{className:"lg:pl-64",children:e})})})}},86742:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>a});let a=(0,t(68570).createProxy)(String.raw`/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx#default`)}};var s=require("../../../webpack-runtime.js");s.C(e);var t=e=>s(s.s=e),a=s.X(0,[9276,9643,5158,2481,1275,11,8019,9257],()=>t(97249));module.exports=a})();