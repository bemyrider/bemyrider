(()=>{var e={};e.id=613,e.ids=[613],e.modules={72934:e=>{"use strict";e.exports=require("next/dist/client/components/action-async-storage.external.js")},54580:e=>{"use strict";e.exports=require("next/dist/client/components/request-async-storage.external.js")},45869:e=>{"use strict";e.exports=require("next/dist/client/components/static-generation-async-storage.external.js")},20399:e=>{"use strict";e.exports=require("next/dist/compiled/next-server/app-page.runtime.prod.js")},78893:e=>{"use strict";e.exports=require("buffer")},84770:e=>{"use strict";e.exports=require("crypto")},17702:e=>{"use strict";e.exports=require("events")},32615:e=>{"use strict";e.exports=require("http")},35240:e=>{"use strict";e.exports=require("https")},98216:e=>{"use strict";e.exports=require("net")},68621:e=>{"use strict";e.exports=require("punycode")},76162:e=>{"use strict";e.exports=require("stream")},82452:e=>{"use strict";e.exports=require("tls")},17360:e=>{"use strict";e.exports=require("url")},71568:e=>{"use strict";e.exports=require("zlib")},97249:(e,r,s)=>{"use strict";s.r(r),s.d(r,{GlobalError:()=>l.a,__next_app__:()=>u,originalPathname:()=>m,pages:()=>d,routeModule:()=>x,tree:()=>c}),s(86742),s(31216),s(35866);var t=s(23191),a=s(88716),i=s(37922),l=s.n(i),o=s(95231),n={};for(let e in o)0>["default","tree","pages","GlobalError","originalPathname","__next_app__","routeModule"].indexOf(e)&&(n[e]=()=>o[e]);s.d(r,n);let c=["",{children:["dashboard",{children:["rider",{children:["__PAGE__",{},{page:[()=>Promise.resolve().then(s.bind(s,86742)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,12177)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,13321)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/layout.tsx"]}]},{layout:[()=>Promise.resolve().then(s.bind(s,31216)),"/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/layout.tsx"],"not-found":[()=>Promise.resolve().then(s.t.bind(s,35866,23)),"next/dist/client/components/not-found-error"]}],d=["/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx"],m="/dashboard/rider/page",u={require:s,loadChunk:()=>Promise.resolve()},x=new t.AppPageRouteModule({definition:{kind:a.x.APP_PAGE,page:"/dashboard/rider/page",pathname:"/dashboard/rider",bundlePath:"",filename:"",appPaths:[]},userland:{loaderTree:c}})},13506:(e,r,s)=>{Promise.resolve().then(s.bind(s,27542))},27542:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>ei});var t,a,i,l,o,n=s(10326),c=s(17577),d=s(35047),m=s(90772),u=s(33071),x=s(76557);let h=(0,x.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var p=s(54659),g=s(37202),f=s(37358),j=s(32333);let b=(0,x.Z)("CircleDollarSign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);var y=s(3634),N=s(26409),v=s(36283),_=s(48998);let w=(0,x.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var D=s(35442),A=s(46226),E=s(11358),C=s(26093),S=s(54432),R=s(31048),I=s(94019),O=s(83855),z=s(31215);let k=[{key:"Lun",label:"Luned\xec",short:"Lun"},{key:"Mar",label:"Marted\xec",short:"Mar"},{key:"Mer",label:"Mercoled\xec",short:"Mer"},{key:"Gio",label:"Gioved\xec",short:"Gio"},{key:"Ven",label:"Venerd\xec",short:"Ven"},{key:"Sab",label:"Sabato",short:"Sab"},{key:"Dom",label:"Domenica",short:"Dom"}];function Z({riderId:e,onClose:r}){let[s,t]=(0,c.useState)(k.map(e=>({day:e.key,isAvailable:!1,timeSlots:[]}))),[a,i]=(0,c.useState)(!1),[l,o]=(0,c.useState)(!1),[d,x]=(0,c.useState)(null),h=e=>{t(r=>r.map(r=>r.day===e?{...r,isAvailable:!r.isAvailable,timeSlots:r.isAvailable?[]:[{start_time:"09:00",end_time:"17:00"}]}:r))},g=e=>{t(r=>r.map(r=>r.day===e?{...r,timeSlots:[...r.timeSlots,{start_time:"09:00",end_time:"17:00"}]}:r))},j=(e,r)=>{t(s=>s.map(s=>s.day===e?{...s,timeSlots:s.timeSlots.filter((e,s)=>s!==r)}:s))},b=(e,r,s,a)=>{t(t=>t.map(t=>t.day===e?{...t,timeSlots:t.timeSlots.map((e,t)=>t===r?{...e,[s]:a}:e)}:t))},y=async()=>{try{o(!0),x(null),await D.O.from("disponibilita_riders").delete().eq("rider_id",e);let t=[];for(let r of s)if(r.isAvailable)for(let s of r.timeSlots)t.push({rider_id:e,day_of_week:r.day,start_time:s.start_time,end_time:s.end_time});if(t.length>0){let{error:e}=await D.O.from("disponibilita_riders").insert(t);if(e)throw e}x({type:"success",text:"Disponibilit\xe0 salvata con successo!"}),setTimeout(()=>{r()},1500)}catch(e){console.error("Error saving availability:",e),x({type:"error",text:e.message||"Errore nel salvataggio"})}finally{o(!1)}};return a?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:n.jsx(u.Zb,{className:"w-full max-w-md",children:(0,n.jsxs)(u.aY,{className:"p-6 text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),n.jsx("p",{children:"Caricamento disponibilit\xe0..."})]})})}):n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)(u.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(u.Ol,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(f.Z,{className:"h-5 w-5 text-purple-600"}),n.jsx(u.ll,{children:"Gestisci Disponibilit\xe0"})]}),n.jsx(m.z,{variant:"ghost",size:"sm",onClick:r,children:n.jsx(I.Z,{className:"h-4 w-4"})})]}),n.jsx(u.SZ,{children:"Imposta i tuoi orari di disponibilit\xe0 per ogni giorno della settimana"})]}),(0,n.jsxs)(u.aY,{className:"space-y-6",children:[d&&(0,n.jsxs)("div",{className:`p-3 rounded-lg flex items-center space-x-2 ${"success"===d.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:["success"===d.type&&n.jsx(p.Z,{className:"h-4 w-4"}),n.jsx("span",{children:d.text})]}),n.jsx("div",{className:"space-y-4",children:k.map(({key:e,label:r,short:t})=>{let a=s.find(r=>r.day===e);return n.jsx(u.Zb,{className:"border-l-4 border-purple-500",children:(0,n.jsxs)(u.aY,{className:"p-4",children:[(0,n.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-3",children:[n.jsx(m.z,{variant:a.isAvailable?"default":"outline",size:"sm",onClick:()=>h(e),className:"w-16",children:t}),n.jsx("span",{className:"font-medium",children:r})]}),a.isAvailable&&(0,n.jsxs)(m.z,{variant:"outline",size:"sm",onClick:()=>g(e),children:[n.jsx(O.Z,{className:"h-4 w-4 mr-1"}),"Aggiungi Fascia"]})]}),a.isAvailable&&(0,n.jsxs)("div",{className:"space-y-2",children:[a.timeSlots.map((r,s)=>(0,n.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 p-2 rounded",children:[n.jsx(_.Z,{className:"h-4 w-4 text-gray-500"}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(R._,{htmlFor:`start-${e}-${s}`,className:"text-sm",children:"Da:"}),n.jsx(S.I,{id:`start-${e}-${s}`,type:"time",value:r.start_time,onChange:r=>b(e,s,"start_time",r.target.value),className:"w-32"})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(R._,{htmlFor:`end-${e}-${s}`,className:"text-sm",children:"A:"}),n.jsx(S.I,{id:`end-${e}-${s}`,type:"time",value:r.end_time,onChange:r=>b(e,s,"end_time",r.target.value),className:"w-32"})]}),a.timeSlots.length>1&&n.jsx(m.z,{variant:"ghost",size:"sm",onClick:()=>j(e,s),className:"text-red-500 hover:text-red-700",children:n.jsx(I.Z,{className:"h-4 w-4"})})]},s)),0===a.timeSlots.length&&n.jsx("p",{className:"text-sm text-gray-500 italic",children:"Nessuna fascia oraria impostata"})]})]})},e)})}),(0,n.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[n.jsx(m.z,{variant:"outline",onClick:r,disabled:l,children:"Annulla"}),n.jsx(m.z,{onClick:y,disabled:l,children:l?(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,n.jsxs)(n.Fragment,{children:[n.jsx(z.Z,{className:"h-4 w-4 mr-2"}),"Salva Disponibilit\xe0"]})})]})]})]})})}var T=s(87888),L=s(46260);function M({riderId:e,currentRate:r,onClose:s}){let[t,a]=(0,c.useState)(r?r.toString():""),[i,l]=(0,c.useState)(!1),[o,d]=(0,c.useState)(null),x=async r=>{r.preventDefault(),l(!0),d(null);try{r.target.checkValidity()||r.stopPropagation();let a=parseFloat(t.replace(",","."));if(isNaN(a)||a<=0)throw Error("‚ö†Ô∏è Inserisci una tariffa valida maggiore di ‚Ç¨0,01");if(!(0,L.P0)(a))throw Error(L.RZ.INVALID_RIDER_RATE);console.log("\uD83D\uDD04 Updating rider rate...",{riderId:e,rate:a});let{error:i}=await D.O.from("riders_details").update({hourly_rate:a,updated_at:new Date().toISOString()}).eq("profile_id",e);if(i)throw console.error("‚ùå Error updating rate:",i),i;console.log("‚úÖ Rate updated successfully"),d({type:"success",text:`‚úÖ Tariffa aggiornata con successo a ‚Ç¨${a.toFixed(2)}/ora`}),setTimeout(()=>{s(),window.location.reload()},1500)}catch(e){console.error("‚ùå Error:",e),d({type:"error",text:e.message||"Errore durante l'aggiornamento"})}finally{l(!1)}};return n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)(u.Zb,{className:"w-full max-w-md bg-white",children:[(0,n.jsxs)(u.Ol,{children:[(0,n.jsxs)("div",{className:"flex items-center justify-between",children:[(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(N.Z,{className:"h-5 w-5"}),"Aggiorna Tariffa"]}),n.jsx(m.z,{variant:"ghost",size:"sm",onClick:s,disabled:i,children:n.jsx(I.Z,{className:"h-4 w-4"})})]}),n.jsx(u.SZ,{children:"Imposta la tua tariffa oraria per i servizi di delivery"})]}),(0,n.jsxs)(u.aY,{children:[(0,n.jsxs)("form",{onSubmit:x,className:"space-y-4",noValidate:!0,children:[(0,n.jsxs)("div",{className:"space-y-2",children:[n.jsx(R._,{htmlFor:"hourlyRate",children:"Tariffa Oraria (‚Ç¨/ora)"}),(0,n.jsxs)("div",{className:"relative",children:[n.jsx(N.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),n.jsx(S.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]+)?",value:t,onChange:e=>{let r=e.target.value;if(a(r=r.replace(/[^0-9.,]/g,"").replace(",",".")),o?.type==="error"&&d(null),r&&!isNaN(parseFloat(r))){let e=parseFloat(r);e>12.5?d({type:"error",text:"‚ö†Ô∏è La tariffa non pu\xf2 superare ‚Ç¨12,50/ora per rispettare i limiti fiscali"}):e<=0&&d({type:"error",text:"‚ö†Ô∏è Inserisci una tariffa valida maggiore di ‚Ç¨0,01"})}},onKeyDown:e=>{-1===[46,8,9,27,13,190,188].indexOf(e.keyCode)&&(65!==e.keyCode||!0!==e.ctrlKey)&&(67!==e.keyCode||!0!==e.ctrlKey)&&(86!==e.keyCode||!0!==e.ctrlKey)&&(88!==e.keyCode||!0!==e.ctrlKey)&&(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},placeholder:"Es. 12.00",className:"pl-10",disabled:i})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Max ‚Ç¨12,50/ora per rimanere sotto la soglia fiscale di ‚Ç¨25,82 (2 ore max)"})]}),r&&n.jsx("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,n.jsxs)("p",{className:"text-sm text-blue-700",children:[n.jsx("strong",{children:"Tariffa attuale:"})," ‚Ç¨",r,"/ora"]})}),o&&(0,n.jsxs)("div",{className:`p-3 rounded-lg flex items-center gap-2 ${"success"===o.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"}`,children:["success"===o.type?n.jsx(p.Z,{className:"h-4 w-4"}):n.jsx(T.Z,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm",children:o.text})]}),(0,n.jsxs)("div",{className:"flex gap-2 pt-4",children:[n.jsx(m.z,{type:"button",variant:"outline",onClick:s,disabled:i,className:"flex-1",children:"Annulla"}),n.jsx(m.z,{type:"submit",disabled:i||!t,className:"flex-1",children:i?n.jsx(n.Fragment,{children:"Aggiornamento..."}):(0,n.jsxs)(n.Fragment,{children:[n.jsx(z.Z,{className:"mr-2 h-4 w-4"}),"Salva"]})})]})]}),(0,n.jsxs)("div",{className:"mt-6 bg-green-50 p-3 rounded-lg",children:[n.jsx("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"\uD83D\uDCCB Informazioni Fiscali"}),(0,n.jsxs)("ul",{className:"text-xs text-green-600 space-y-1",children:[(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Tariffa max:"})," ‚Ç¨12,50/ora"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Durata max:"})," 2 ore per prenotazione"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Totale max:"})," ‚Ç¨25,00 (< ‚Ç¨25,82)"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Vantaggio:"})," Nessuna ritenuta d'acconto"]})]}),(0,n.jsxs)("p",{className:"text-xs text-green-600 mt-2 italic",children:["Fonte:"," ",n.jsx("a",{href:"https://www.agenziaentrate.gov.it/portale/schede/pagamenti/versamento-modello-f24-ritenute-su-reddito-di-lavoro-autonomo-f24_rit_red_lav_aut/redditi-soggetti-a-ritenuta-f24_rit_red_lav_aut",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-green-800",children:"Agenzia delle Entrate - Ritenute Lavoro Autonomo"})]})]})]})]})})}var F=s(79635),P=s(77636);let q=(0,x.Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function G({isOpen:e,onClose:r,riderId:s}){let[t,a]=(0,c.useState)({first_name:"",last_name:"",fiscal_code:"",birth_place:"",birth_date:"",residence_address:"",residence_city:""}),[i,l]=(0,c.useState)(!1),[o,d]=(0,c.useState)(null),x=e=>/^[A-Z]{6}[0-9]{2}[A-Z][0-9]{2}[A-Z][0-9]{3}[A-Z]$/.test(e.toUpperCase()),h=e=>e.replace(/[AEIOU]/g,""),p=e=>e.replace(/[^AEIOU]/g,""),g=e=>["A","B","C","D","E","H","L","M","P","R","S","T"][e-1]||"A",j=e=>{for(let[r,s]of Object.entries({PALERMO:"G273",ROMA:"H501",MILANO:"F205",NAPOLI:"F839",TORINO:"L219",GENOVA:"D969",BOLOGNA:"A944",FIRENZE:"D612",VENEZIA:"L736",BARI:"A662",CATANIA:"C351",VERONA:"L781",MESSINA:"F158",PADOVA:"G224",TRIESTE:"L424",BRESCIA:"B157",PARMA:"G337",PRATO:"G999",MODENA:"F257","REGGIO CALABRIA":"H224","REGGIO EMILIA":"H223",PERUGIA:"G478",LIVORNO:"E625",RAVENNA:"H199",CAGLIARI:"B354",FOGGIA:"D643",RIMINI:"H294",SALERNO:"H703",FERRARA:"D548",SASSARI:"I452",LATINA:"E472","GIUGLIANO IN CAMPANIA":"E058",MONZA:"F704",SYRACUSA:"I754",PESCARA:"G482",BERGAMO:"A794",FORL√å:"D704",TRENTO:"L378",VICENZA:"L840",TERNI:"L112",BOLZANO:"A952",NOVARA:"F952",PIACENZA:"G535",ANCONA:"A271",ANDRIA:"A285",AREZZO:"A390",UDINE:"L483",CESENA:"C514",LECCE:"E506",PESARO:"G479"}))if(e.includes(r))return s;let r=e.match(/\(([^)]+)\)/);if(r){let e=r[1],s={PA:"G273",RM:"H501",MI:"F205",NA:"F839",TO:"L219",GE:"D969",BO:"A944",FI:"D612",VE:"L736",BA:"A662",CT:"C351",VR:"L781",ME:"F158"};if(s[e])return s[e]}return"H501"},b=e=>{let r={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23},s={0:1,1:0,2:5,3:7,4:9,5:13,6:15,7:17,8:19,9:21},t={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},a={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},i=0;for(let l=0;l<15;l++){let o=e[l].toUpperCase();l%2==0?isNaN(parseInt(o))?i+=r[o]||0:i+=s[o]||0:isNaN(parseInt(o))?i+=t[o]||0:i+=a[o]||0}return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[i%26]},y=(e,r)=>{if(a(s=>({...s,[e]:r})),o?.type==="error"&&d(null),"fiscal_code"===e&&r.length>0){let e=r.toUpperCase();16!==r.length||x(e)||d({type:"error",text:"‚ö†Ô∏è Codice fiscale non valido. Controlla il formato (16 caratteri)"})}},N=async e=>{e.preventDefault(),l(!0),d(null);try{if(!t.first_name.trim())throw Error("‚ö†Ô∏è Il nome \xe8 obbligatorio");if(!t.last_name.trim())throw Error("‚ö†Ô∏è Il cognome \xe8 obbligatorio");if(!t.fiscal_code.trim())throw Error("‚ö†Ô∏è Il codice fiscale \xe8 obbligatorio");if(!x(t.fiscal_code.toUpperCase()))throw Error("‚ö†Ô∏è Codice fiscale non valido. Deve essere di 16 caratteri nel formato corretto");if(!t.birth_place.trim())throw Error("‚ö†Ô∏è Il luogo di nascita \xe8 obbligatorio");if(!t.birth_date.trim())throw Error("‚ö†Ô∏è La data di nascita \xe8 obbligatoria");if(!t.residence_address.trim())throw Error("‚ö†Ô∏è L'indirizzo di residenza \xe8 obbligatorio");if(!t.residence_city.trim())throw Error("‚ö†Ô∏è La citt\xe0 di residenza \xe8 obbligatoria");let e={rider_id:s,first_name:t.first_name.trim(),last_name:t.last_name.trim(),fiscal_code:t.fiscal_code.toUpperCase(),birth_place:t.birth_place.trim(),birth_date:t.birth_date,residence_address:t.residence_address.trim(),residence_city:t.residence_city.trim()},{error:a}=await D.O.from("rider_tax_details").upsert(e,{onConflict:"rider_id"});if(a)throw console.error("Error saving fiscal data:",a),Error("‚ùå Errore durante il salvataggio. Riprova.");d({type:"success",text:"‚úÖ Dati fiscali salvati con successo!"}),setTimeout(()=>{r()},1500)}catch(e){console.error("Error saving fiscal data:",e),d({type:"error",text:e.message||"‚ùå Errore durante il salvataggio. Riprova."})}finally{l(!1)}},_=()=>{d(null),r()};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,n.jsxs)(u.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(u.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(v.Z,{className:"h-5 w-5"}),"Dati Fiscali"]}),n.jsx(u.SZ,{children:"Inserisci i tuoi dati fiscali per la fatturazione e la compliance"})]}),n.jsx(m.z,{variant:"ghost",size:"sm",onClick:_,disabled:i,children:n.jsx(I.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)(u.aY,{children:[o&&n.jsx("div",{className:`mb-4 p-3 rounded-lg ${"success"===o.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:o.text}),(0,n.jsxs)("form",{onSubmit:N,className:"space-y-4",noValidate:!0,children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"firstName",className:"flex items-center gap-2",children:[n.jsx(F.Z,{className:"h-4 w-4"}),"Nome *"]}),n.jsx(S.I,{id:"firstName",type:"text",value:t.first_name,onChange:e=>y("first_name",e.target.value),placeholder:"Es. Mario",disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"lastName",className:"flex items-center gap-2",children:[n.jsx(F.Z,{className:"h-4 w-4"}),"Cognome *"]}),n.jsx(S.I,{id:"lastName",type:"text",value:t.last_name,onChange:e=>y("last_name",e.target.value),placeholder:"Es. Rossi",disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"birthPlace",className:"flex items-center gap-2",children:[n.jsx(P.Z,{className:"h-4 w-4"}),"Luogo di Nascita *"]}),n.jsx(S.I,{id:"birthPlace",type:"text",value:t.birth_place,onChange:e=>y("birth_place",e.target.value),placeholder:"Es. Roma (RM)",disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"birthDate",className:"flex items-center gap-2",children:[n.jsx(f.Z,{className:"h-4 w-4"}),"Data di Nascita *"]}),n.jsx(S.I,{id:"birthDate",type:"date",value:t.birth_date,onChange:e=>y("birth_date",e.target.value),disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"fiscalCode",className:"flex items-center gap-2",children:[n.jsx(F.Z,{className:"h-4 w-4"}),"Codice Fiscale *"]}),(0,n.jsxs)("div",{className:"flex gap-2",children:[n.jsx(S.I,{id:"fiscalCode",type:"text",maxLength:16,value:t.fiscal_code,onChange:e=>y("fiscal_code",e.target.value.toUpperCase()),placeholder:"Es. RSSMRA85M01H501X",className:"uppercase flex-1",disabled:i,required:!0}),(0,n.jsxs)(m.z,{type:"button",variant:"outline",onClick:()=>{let{first_name:e,last_name:r,birth_date:s,birth_place:i}=t;if(!e.trim()||!r.trim()||!s||!i.trim()){d({type:"error",text:"‚ö†Ô∏è Compila tutti i campi (nome, cognome, data e luogo di nascita) per calcolare il codice fiscale"});return}try{let t=r.toUpperCase().replace(/\s/g,""),l=h(t),o=p(t),n="";n=l.length>=3?l.substring(0,3):(l+o+"XXX").substring(0,3);let c=e.toUpperCase().replace(/\s/g,""),m=h(c),u=p(c),x="";x=m.length>=4?m[0]+m[2]+m[3]:m.length>=3?m.substring(0,3):(m+u+"XXX").substring(0,3);let f=s.substring(2,4),y=g(parseInt(s.substring(5,7))),N=s.substring(8,10),v=j(i.toUpperCase()),_=n+x+f+y+N+v,w=b(_),D=_+w;a(e=>({...e,fiscal_code:D})),d({type:"success",text:`‚úÖ Codice fiscale calcolato: ${D}. Verifica che sia corretto.`})}catch(e){d({type:"error",text:"‚ùå Errore nel calcolo del codice fiscale. Inseriscilo manualmente."})}},disabled:i,className:"shrink-0",children:[n.jsx(q,{className:"h-4 w-4 mr-1"}),"Calcola"]})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"16 caratteri alfanumerici (lettere maiuscole e numeri)"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"residenceAddress",className:"flex items-center gap-2",children:[n.jsx(P.Z,{className:"h-4 w-4"}),"Indirizzo di Residenza *"]}),n.jsx(S.I,{id:"residenceAddress",type:"text",value:t.residence_address,onChange:e=>y("residence_address",e.target.value),placeholder:"Es. Via Roma, 123",disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"residenceCity",className:"flex items-center gap-2",children:[n.jsx(P.Z,{className:"h-4 w-4"}),"Citt\xe0 di Residenza *"]}),n.jsx(S.I,{id:"residenceCity",type:"text",value:t.residence_city,onChange:e=>y("residence_city",e.target.value),placeholder:"Es. Milano (MI)",disabled:i,required:!0})]}),(0,n.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,n.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[n.jsx(T.Z,{className:"h-4 w-4"}),"Informazioni Importanti"]}),(0,n.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Privacy:"})," I dati sono protetti secondo il GDPR"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Uso:"})," Utilizzati solo per fatturazione e compliance fiscale"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Sicurezza:"})," Trasmissione e archiviazione crittografate"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Modifiche:"})," Puoi aggiornare i dati in qualsiasi momento"]})]})]}),(0,n.jsxs)("div",{className:"flex gap-3 pt-4",children:[n.jsx(m.z,{type:"button",variant:"outline",onClick:_,disabled:i,className:"flex-1",children:"Annulla"}),n.jsx(m.z,{type:"submit",disabled:i,className:"flex-1",children:i?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx(z.Z,{className:"h-4 w-4"}),"Salva Dati Fiscali"]})})]})]})]})]})}):null}var U=s(40617),B=s(97697);let V=(0,x.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);(function(e){e.AVAILABLE="available",e.BUSY="busy",e.OFFLINE="offline"})(t||(t={})),function(e){e.PENDING="pending",e.CONFIRMED="confirmed",e.COMPLETED="completed",e.CANCELLED="cancelled"}(a||(a={})),function(e){e.RIDER="rider",e.MERCHANT="merchant"}(i||(i={})),function(e){e.BIKE="bike",e.SCOOTER="scooter",e.CAR="car",e.MOTORBIKE="motorbike",e.WALKING="walking"}(l||(l={})),function(e){e.BICI="bici",e.E_BIKE="e_bike",e.SCOOTER="scooter",e.AUTO="auto"}(o||(o={}));let H={bici:"\uD83D\uDEB2 Bicicletta",e_bike:"\uD83D\uDEB4‚Äç‚ôÇÔ∏è E-Bike",scooter:"\uD83D\uDEF5 Scooter",auto:"\uD83D\uDE97 Auto"},$=e=>e?.code==="PGRST301"||e?.code==="PGRST302"||e?.status===401||e?.status===403||e?.message?.includes("JWT"),Y=async()=>{try{console.log("\uD83D\uDD04 Refreshing session...");let{data:e,error:r}=await D.O.auth.refreshSession();if(r)return console.error("‚ùå Failed to refresh session:",r),!1;if(e.session)return console.log("‚úÖ Session refreshed successfully"),!0;return console.warn("‚ö†Ô∏è No session returned after refresh"),!1}catch(e){return console.error("‚ùå Error during session refresh:",e),!1}},K=async(e,r=1)=>{let s;for(let t=0;t<=r;t++)try{let{data:{user:r},error:s}=await D.O.auth.getUser();if(s||!r)throw Error("User not authenticated");return await e()}catch(e){if(s=e,$(e)&&t<r){if(console.log(`üîÑ Auth error detected, attempting refresh (attempt ${t+1}/${r+1})`),!await Y())throw Error("Failed to refresh session");await new Promise(e=>setTimeout(e,1e3));continue}throw e}throw s},X=(e,r)=>!!$(e)&&(console.log("\uD83D\uDEAB Authentication error detected, redirecting to login"),r.push("/auth/login"),!0),J=Object.values(o).map(e=>({value:e,label:H[e]}));function W({isOpen:e,onClose:r,riderId:s,onProfileUpdate:t}){let a=(0,d.useRouter)(),[i,l]=(0,c.useState)({full_name:"",bio:"",hourly_rate:"",vehicle_type:"",profile_picture_url:"",active_location:""}),[o,x]=(0,c.useState)(!1),[h,p]=(0,c.useState)(null),g=e=>{let r=parseFloat(e);return!isNaN(r)&&r>0&&r<=12.5},f=(e,r)=>{if(l(s=>({...s,[e]:r})),h?.type==="error"&&p(null),"hourly_rate"===e&&r.length>0){let e=parseFloat(r);isNaN(e)?p({type:"error",text:"‚ö†Ô∏è Inserisci un numero valido per la tariffa"}):e<=0?p({type:"error",text:"‚ö†Ô∏è La tariffa deve essere maggiore di ‚Ç¨0"}):e>12.5&&p({type:"error",text:"‚ö†Ô∏è Tariffa massima consentita: ‚Ç¨12.50/h (per evitare ritenuta d'acconto)"})}},j=async e=>{e.preventDefault(),x(!0),p(null);try{if(!i.full_name.trim())throw Error("‚ö†Ô∏è Il nome completo \xe8 obbligatorio");if(i.hourly_rate&&!g(i.hourly_rate))throw Error("‚ö†Ô∏è La tariffa oraria deve essere tra ‚Ç¨0.01 e ‚Ç¨12.50");await K(async()=>{let{error:e}=await D.O.from("profiles").update({full_name:i.full_name.trim()||null,updated_at:new Date().toISOString()}).eq("id",s);if(e)throw console.error("Error updating profile:",e),e;let r={bio:i.bio.trim()||null,vehicle_type:i.vehicle_type||null,profile_picture_url:i.profile_picture_url.trim()||null,active_location:i.active_location.trim()||null,updated_at:new Date().toISOString()};i.hourly_rate.trim()&&(r.hourly_rate=parseFloat(i.hourly_rate));let{error:t}=await D.O.from("riders_details").update(r).eq("profile_id",s);if(t)throw console.error("Error updating rider details:",t),t},2),p({type:"success",text:"‚úÖ Profilo aggiornato con successo!"}),t&&t(),setTimeout(()=>{r()},1500)}catch(e){if(console.error("Profile update error:",e),X(e,a)){p({type:"error",text:"\uD83D\uDD12 Sessione scaduta. Stai per essere reindirizzato al login..."}),setTimeout(()=>{r()},2e3);return}p({type:"error",text:e.message||"‚ùå Errore durante l'aggiornamento del profilo. Riprova."})}finally{x(!1)}},b=()=>{p(null),r()};return e?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,n.jsxs)(u.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(u.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,n.jsxs)("div",{children:[(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(F.Z,{className:"h-5 w-5"}),"Modifica Profilo"]}),n.jsx(u.SZ,{children:"Aggiorna le tue informazioni di profilo rider"})]}),n.jsx(m.z,{variant:"ghost",size:"sm",onClick:b,disabled:o,children:n.jsx(I.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)(u.aY,{children:[h&&n.jsx("div",{className:`mb-4 p-3 rounded-lg ${"success"===h.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"}`,children:h.text}),(0,n.jsxs)("form",{onSubmit:j,className:"space-y-4",noValidate:!0,children:[(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"fullName",className:"flex items-center gap-2",children:[n.jsx(F.Z,{className:"h-4 w-4"}),"Nome Completo"]}),n.jsx(S.I,{id:"fullName",type:"text",value:i.full_name,onChange:e=>f("full_name",e.target.value),placeholder:"Inserisci il tuo nome completo",disabled:o,required:!0}),n.jsx("p",{className:"text-xs text-gray-500",children:"Il nome che verr\xe0 mostrato ai clienti"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"bio",className:"flex items-center gap-2",children:[n.jsx(U.Z,{className:"h-4 w-4"}),"Bio / Descrizione"]}),n.jsx("textarea",{id:"bio",value:i.bio,onChange:e=>f("bio",e.target.value),placeholder:"Descrivi brevemente te stesso e la tua esperienza come rider...",className:"w-full p-2 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500,disabled:o}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:["Massimo 500 caratteri (",500-i.bio.length," rimanenti)"]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"vehicleType",className:"flex items-center gap-2",children:[n.jsx(B.Z,{className:"h-4 w-4"}),"Tipo di Veicolo"]}),(0,n.jsxs)("select",{id:"vehicleType",value:i.vehicle_type,onChange:e=>f("vehicle_type",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,children:[n.jsx("option",{value:"",children:"Seleziona veicolo"}),J.map(e=>n.jsx("option",{value:e.value,children:e.label},e.value))]})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"activeLocation",className:"flex items-center gap-2",children:[n.jsx(P.Z,{className:"h-4 w-4"}),"Localit\xe0 Attiva"]}),n.jsx(S.I,{id:"activeLocation",type:"text",value:i.active_location,onChange:e=>f("active_location",e.target.value),placeholder:"Milano, Roma, Torino, ecc...",disabled:o,maxLength:100}),n.jsx("p",{className:"text-xs text-gray-500",children:"La citt\xe0 o zona dove sei attivo per le consegne (massimo 100 caratteri)"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"hourlyRate",className:"flex items-center gap-2",children:[n.jsx(N.Z,{className:"h-4 w-4"}),"Tariffa Oraria (‚Ç¨/h)"]}),n.jsx(S.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:i.hourly_rate,onChange:e=>f("hourly_rate",e.target.value),placeholder:"Es. 10.00",disabled:o}),n.jsx("p",{className:"text-xs text-gray-500",children:"Tariffa massima: ‚Ç¨12.50/h per evitare ritenuta d'acconto su prestazioni occasionali"})]}),(0,n.jsxs)("div",{className:"space-y-2",children:[(0,n.jsxs)(R._,{htmlFor:"profilePictureUrl",className:"flex items-center gap-2",children:[n.jsx(V,{className:"h-4 w-4"}),"URL Immagine Profilo"]}),n.jsx(S.I,{id:"profilePictureUrl",type:"url",value:i.profile_picture_url,onChange:e=>f("profile_picture_url",e.target.value),placeholder:"https://esempio.com/mia-foto.jpg",disabled:o}),i.profile_picture_url&&(0,n.jsxs)("div",{className:"mt-3",children:[n.jsx("p",{className:"text-xs text-gray-600 mb-3",children:"Anteprima:"}),n.jsx("div",{className:"flex justify-center",children:(0,n.jsxs)("div",{className:"relative",children:[n.jsx(A.default,{src:i.profile_picture_url,alt:"Anteprima foto profilo",width:96,height:96,className:"w-24 h-24 rounded-full object-cover border-3 border-blue-200 shadow-md",onError:e=>{e.currentTarget.style.display="none"}}),n.jsx("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]})}),n.jsx("p",{className:"text-xs text-green-600 text-center mt-2",children:"‚úì Immagine caricata correttamente"})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Inserisci l'URL di un'immagine (JPG, PNG, WEBP)"})]}),(0,n.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,n.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[n.jsx(T.Z,{className:"h-4 w-4"}),"Informazioni"]}),(0,n.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Nome:"})," Mostrato ai clienti nelle prenotazioni"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Bio:"})," Aiuta i clienti a conoscerti meglio"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Veicolo:"})," Influenza i tipi di consegne disponibili"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Localit\xe0:"})," Determina la tua visibilit\xe0 nelle ricerche geografiche"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Tariffa:"})," Pu\xf2 essere aggiornata in qualsiasi momento"]}),(0,n.jsxs)("li",{children:["‚Ä¢ ",n.jsx("strong",{children:"Foto profilo:"})," Aumenta la fiducia dei clienti"]})]})]}),(0,n.jsxs)("div",{className:"flex gap-3 pt-4",children:[n.jsx(m.z,{type:"button",variant:"outline",onClick:b,disabled:o,className:"flex-1",children:"Annulla"}),n.jsx(m.z,{type:"submit",disabled:o,className:"flex-1",children:o?(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,n.jsxs)("div",{className:"flex items-center gap-2",children:[n.jsx(z.Z,{className:"h-4 w-4"}),"Salva Modifiche"]})})]})]})]})]})}):null}var Q=s(77863);let ee=c.forwardRef(({className:e,...r},s)=>n.jsx("textarea",{className:(0,Q.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:s,...r}));ee.displayName="Textarea";var er=s(34789);function es({isOpen:e,onClose:r,request:s,riderHourlyRate:t,onRespond:a}){let{toast:i}=(0,er.pm)(),[l,o]=(0,c.useState)(!1),[d,x]=(0,c.useState)(null),[h,g]=(0,c.useState)(""),j=async e=>{if(e.preventDefault(),s&&d){o(!0);try{await a(s.id,d,h.trim()||void 0),console.log("\uD83C\uDF89 Risposta inviata con successo, mostrando toast..."),r(),setTimeout(()=>{console.log("\uD83C\uDF5E Mostrando toast dopo chiusura modal..."),console.log("\uD83D\uDCDD Toast data:",{title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});let e=i({title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});console.log("\uD83C\uDFAF Toast result:",e),console.log("‚úÖ Toast chiamato con successo - dovrebbe apparire ora!")},100)}catch(e){console.error("‚ùå Error responding to request:",e),console.log("\uD83D\uDEA8 Mostrando toast di errore..."),i({title:"Errore",description:"Errore durante la risposta alla richiesta"}),setTimeout(()=>{console.log("\uD83D\uDD12 Chiudendo modal dopo errore..."),r()},1e3)}finally{o(!1)}}};return e&&s?n.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,n.jsxs)(u.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,n.jsxs)(u.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,n.jsxs)("div",{children:[n.jsx(u.ll,{className:"text-xl",children:"Rispondi alla Richiesta di Servizio"}),n.jsx(u.SZ,{children:s.merchant.esercenti?.business_name||s.merchant.full_name})]}),n.jsx(m.z,{variant:"ghost",size:"sm",onClick:r,children:n.jsx(I.Z,{className:"h-4 w-4"})})]}),(0,n.jsxs)(u.aY,{children:[(0,n.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 space-y-3",children:[n.jsx("h4",{className:"font-medium text-gray-900",children:"Dettagli della Richiesta"}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(f.Z,{className:"h-4 w-4 text-gray-500"}),n.jsx("span",{children:new Date(s.requested_date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(_.Z,{className:"h-4 w-4 text-gray-500"}),(0,n.jsxs)("span",{children:[s.start_time.substring(0,5)," - ",s.duration_hours,"h di servizio"]})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(P.Z,{className:"h-4 w-4 text-gray-500"}),n.jsx("span",{className:"truncate",title:s.merchant_address,children:s.merchant_address})]}),(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(N.Z,{className:"h-4 w-4 text-gray-500"}),(0,n.jsxs)("span",{children:["‚Ç¨",(s.duration_hours*(t||15)).toFixed(2)," ","(stimato)"]})]})]}),s.description&&n.jsx("div",{className:"mt-3 p-3 bg-white rounded border-l-4 border-blue-500",children:(0,n.jsxs)("div",{className:"flex items-start space-x-2",children:[n.jsx(U.Z,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,n.jsxs)("div",{children:[n.jsx("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Istruzioni del merchant:"}),n.jsx("p",{className:"text-sm text-blue-700",children:s.description})]})]})})]}),(0,n.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,n.jsxs)("div",{children:[n.jsx(R._,{className:"text-base font-medium",children:"La tua risposta *"}),(0,n.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[(0,n.jsxs)(m.z,{type:"button",variant:"accepted"===d?"default":"outline",className:`h-16 flex-col space-y-2 ${"accepted"===d?"bg-green-600 hover:bg-green-700":"hover:bg-green-50 hover:border-green-300"}`,onClick:()=>x("accepted"),children:[n.jsx(p.Z,{className:"h-6 w-6"}),n.jsx("span",{children:"Accetta"})]}),(0,n.jsxs)(m.z,{type:"button",variant:"rejected"===d?"default":"outline",className:`h-16 flex-col space-y-2 ${"rejected"===d?"bg-red-600 hover:bg-red-700":"hover:bg-red-50 hover:border-red-300"}`,onClick:()=>x("rejected"),children:[n.jsx(I.Z,{className:"h-6 w-6"}),n.jsx("span",{children:"Rifiuta"})]})]})]}),(0,n.jsxs)("div",{children:[(0,n.jsxs)(R._,{htmlFor:"response_message",children:["Messaggio opzionale","rejected"===d&&n.jsx("span",{className:"text-red-500 ml-1",children:"*"})]}),n.jsx(ee,{id:"response_message",value:h,onChange:e=>g(e.target.value),placeholder:"accepted"===d?"Aggiungi eventuali note o conferme...":"Spiega il motivo del rifiuto...",className:"mt-1",rows:3,required:"rejected"===d}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"rejected"===d?"Campo obbligatorio per i rifiuti":"Campo opzionale per aggiungere dettagli"})]}),(0,n.jsxs)("div",{className:"flex space-x-3 pt-4",children:[n.jsx(m.z,{type:"button",variant:"outline",onClick:r,className:"flex-1",disabled:l,children:"Annulla"}),n.jsx(m.z,{type:"submit",className:`flex-1 ${"accepted"===d?"bg-green-600 hover:bg-green-700":"rejected"===d?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"}`,disabled:l||!d||"rejected"===d&&!h.trim(),children:l?(0,n.jsxs)(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Invio..."]}):"accepted"===d?"Accetta Richiesta":"rejected"===d?"Rifiuta Richiesta":"Seleziona risposta"})]})]})]})]})}):null}var et=s(57275);function ea(){let[e,r]=(0,c.useState)(null),[s,t]=(0,c.useState)(!1),[a,i]=(0,c.useState)(!1),[l,o]=(0,c.useState)(!1),[x,S]=(0,c.useState)(!1),[R,I]=(0,c.useState)(!0),[O,z]=(0,c.useState)(null),[k,T]=(0,c.useState)(null),[L,F]=(0,c.useState)(!1),[P,q]=(0,c.useState)(!1),[U,B]=(0,c.useState)(!1),[V,H]=(0,c.useState)([]),[$,Y]=(0,c.useState)(!1),[K,X]=(0,c.useState)(null),J=(0,d.useRouter)();(0,d.useSearchParams)();let Q=(0,c.useCallback)(async()=>{try{let{data:{user:e},error:s}=await D.O.auth.getUser();if(s||!e){console.error("\uD83D\uDEAB No authenticated user, redirecting to login"),J.push("/auth/login");return}console.log("\uD83D\uDD0D Fetching profile for user:",e.id,"Email:",e.email),console.log("\uD83D\uDC64 User metadata:",e.user_metadata);let{data:t,error:a}=await D.O.from("profiles").select(`
          id,
          full_name,
          avatar_url,
          role,
          riders_details (
            vehicle_type,
            profile_picture_url,
            bio,
            hourly_rate,
            stripe_account_id,
            stripe_onboarding_complete
          ),
          rider_tax_details (
            first_name,
            last_name,
            fiscal_code,
            birth_place,
            birth_date,
            residence_address,
            residence_city
          )
        `).eq("id",e.id).single();if(a){if("PGRST116"===a.code){if(console.log("\uD83D\uDCDD No profile found, checking user metadata..."),e.user_metadata?.role==="rider"){console.log("\uD83D\uDCDD Creating rider profile for user:",e.id);let{error:r}=await D.O.from("profiles").insert({id:e.id,full_name:e.user_metadata.full_name||"New Rider",role:"rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(r){console.error("‚ùå Error creating rider profile:",r),z("Errore nella creazione del profilo rider");return}let{error:s}=await D.O.from("riders_details").insert({profile_id:e.id,hourly_rate:15,bio:"New Rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s){console.error("‚ùå Error creating rider details:",s),z("Errore nella creazione dei dettagli del rider");return}console.log("‚úÖ Rider profile created successfully"),window.location.reload();return}console.log("\uD83D\uDEAB User metadata does not indicate rider role or missing role, redirecting to registration"),J.push("/auth/register");return}console.error("‚ùå Error fetching profile:",a),z("Errore nel caricamento del profilo");return}if(t){if(console.log("\uD83D\uDCCB Profile found:",t),"rider"!==t.role){console.log("\uD83D\uDEAB ACCESSO NEGATO: User role is:",t.role,"- redirecting to appropriate dashboard"),"merchant"===t.role?(console.log("‚û°Ô∏è Redirecting to merchant dashboard"),J.push("/dashboard/merchant")):(console.log("‚û°Ô∏è Unknown role, redirecting to login"),J.push("/auth/login"));return}console.log("‚úÖ ACCESSO AUTORIZZATO: Rider profile loaded successfully");let e=Array.isArray(t.riders_details)?t.riders_details[0]:t.riders_details;r({id:t.id,full_name:t.full_name,avatar_url:t.avatar_url,riders_details:e||null,rider_tax_details:Array.isArray(t.rider_tax_details)?t.rider_tax_details[0]||null:t.rider_tax_details||null}),ei()}}catch(e){console.error("Error fetching profile:",e),z("Errore nel caricamento del profilo")}finally{I(!1)}},[J]),ee=async()=>{if(!e?.riders_details?.stripe_account_id)return!1;F(!0);try{let r=await fetch("/api/stripe/onboarding",{method:"GET",credentials:"include"});if(r.ok){let s=await r.json();return console.log("\uD83D\uDD04 Onboarding status check result:",s),s.stripe_onboarding_complete!==e.riders_details?.stripe_onboarding_complete&&(console.log("‚úÖ Onboarding status changed, updating profile..."),await Q()),s.stripe_onboarding_complete}}catch(e){console.error("Error checking onboarding status:",e)}finally{F(!1)}return e.riders_details?.stripe_onboarding_complete||!1},er=async()=>{I(!0),z(null);try{let e=await fetch("/api/stripe/onboarding",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok){let r=await e.json();throw Error(r.error||"Failed to start onboarding")}let r=await e.json();if(r.url)window.location.href=r.url;else throw Error("No URL returned from Stripe")}catch(e){console.error("Error starting Stripe onboarding:",e),z(e.message||"Si \xe8 verificato un errore durante l'attivazione dei pagamenti")}finally{I(!1)}},ea=async()=>{let{data:{user:r}}=await D.O.auth.getUser();if(!r){z("Devi effettuare il login per utilizzare questa funzionalit\xe0");return}if(!e?.riders_details?.stripe_account_id){z("ID dell'account Stripe non trovato.");return}I(!0),z(null);try{let r=await fetch("/api/stripe/create-login-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:e.riders_details.stripe_account_id})}),{url:s,error:t}=await r.json();if(t)throw Error(t);s&&window.open(s,"_blank")}catch(e){console.error("Error creating Stripe login link:",e),z(e.message||"Failed to open Stripe Dashboard.")}finally{I(!1)}},ei=(0,c.useCallback)(async()=>{if(!e){console.log("\uD83D\uDEAB No profile available, skipping fetchServiceRequests");return}try{console.log("\uD83D\uDD0D Fetching service requests for rider ID:",e.id);let{data:r,error:s}=await D.O.from("service_requests").select(`
          id,
          requested_date,
          start_time,
          duration_hours,
          merchant_address,
          description,
          status,
          rider_response,
          created_at,
          updated_at,
          merchant:profiles!merchant_id (
            id,
            full_name,
            esercenti (
              business_name,
              address,
              city
            )
          )
        `).eq("rider_id",e.id).order("created_at",{ascending:!1});if(s)throw console.error("‚ùå Error fetching service requests:",s),s;console.log("\uD83D\uDCCA Raw data from DB:",r);let t=(r||[]).map(e=>{let r=Array.isArray(e.merchant)?e.merchant[0]:e.merchant;return{...e,merchant:{...r,esercenti:Array.isArray(r?.esercenti)?r.esercenti[0]:r?.esercenti}}}).filter(e=>e.merchant);console.log("\uD83D\uDD04 Transformed requests:",t),console.log("‚úÖ Service requests fetched successfully:",t.length,"requests"),H(t)}catch(e){console.error("‚ùå Error fetching service requests:",e),z("Errore nel caricamento delle richieste di servizio")}},[e]),el=async(r,s,t)=>{try{console.log("\uD83D\uDCE4 Responding to service request:",r,s);let a=await fetch("/api/service-requests/"+r+"/respond",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,riderResponse:t,userId:e?.id})});if(!a.ok)throw Error(`HTTP error! status: ${a.status}`);let i=await a.json();if(!i.success)throw Error(i.error||"Failed to respond to request");console.log("‚úÖ Response sent successfully"),ei()}catch(e){throw console.error("‚ùå Error responding to request:",e),e}},eo=e=>{X(e),Y(!0)},en=async()=>{try{q(!0),console.log("\uD83D\uDEAA Logging out rider..."),await D.O.auth.signOut(),console.log("‚úÖ Logout successful, redirecting to home"),J.push("/")}catch(e){console.error("‚ùå Error during logout:",e),z("Errore durante il logout"),q(!1)}};if(R&&!e)return n.jsx(et.Iq,{});if(O)return(0,n.jsxs)("div",{children:["Error: ",O]});if(!e)return n.jsx("div",{children:"Could not load profile."});let ec=e.riders_details;return(0,n.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[n.jsx(C.Z,{userRole:"rider",userName:e?.full_name||"Rider",onLogout:en,onDeleteAccount:()=>B(!0)}),(0,n.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,n.jsxs)("div",{className:"mb-8",children:[(0,n.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Benvenuto, ",e.full_name,"! \uD83D\uDEB4‚Äç‚ôÇÔ∏è"]}),n.jsx("p",{className:"text-gray-600",children:"Gestisci il tuo profilo, disponibilit\xe0 e ricevi pagamenti"})]}),O&&n.jsx("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:O}),(0,n.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:[n.jsx(u.Zb,{className:"relative overflow-hidden",children:(0,n.jsxs)(u.aY,{className:"relative px-6 pt-6 pb-6",children:[n.jsx("div",{className:"flex justify-center mb-4",children:ec?.profile_picture_url?(0,n.jsxs)("div",{className:"relative",children:[n.jsx(A.default,{src:ec.profile_picture_url,alt:"Foto profilo",width:128,height:128,className:"w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl",onError:e=>{e.currentTarget.style.display="none"}}),n.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:n.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]}):(0,n.jsxs)("div",{className:"relative",children:[n.jsx("div",{className:"w-32 h-32 rounded-full flex items-center justify-center shadow-xl border-4 border-white",style:{background:"linear-gradient(to bottom right, #333366, #4a4a7a)"},children:n.jsx("span",{className:"text-3xl font-bold text-white",children:e.full_name?e.full_name.charAt(0).toUpperCase():e.rider_tax_details?.first_name?.charAt(0).toUpperCase()||"R"})}),n.jsx("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:n.jsx("div",{className:"w-2 h-2 bg-white rounded-full"})})]})}),(0,n.jsxs)("div",{className:"text-center mb-4",children:[n.jsx("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:e.rider_tax_details?.first_name&&e.rider_tax_details?.last_name?`${e.rider_tax_details.first_name} ${e.rider_tax_details.last_name}`:e.full_name||"Nome non impostato"}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-2",children:[[1,2,3,4,5].map(e=>n.jsx("svg",{className:"w-4 h-4 text-yellow-400 fill-current",viewBox:"0 0 20 20",children:n.jsx("path",{d:"M10 1l2.5 6.5h6.5l-5.25 4 2 6.5-5.75-4.25-5.75 4.25 2-6.5-5.25-4h6.5z"})},e)),n.jsx("span",{className:"text-sm text-gray-600 ml-1",children:"5.0 ‚Ä¢ Nuovo rider"})]}),(0,n.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-3",children:[ec?.vehicle_type==="bici"&&n.jsx("span",{children:"\uD83D\uDEB2"}),ec?.vehicle_type==="e_bike"&&n.jsx("span",{children:"\uD83D\uDEB4‚Äç‚ôÇÔ∏è"}),ec?.vehicle_type==="scooter"&&n.jsx("span",{children:"\uD83D\uDEF5"}),ec?.vehicle_type==="auto"&&n.jsx("span",{children:"\uD83D\uDE97"}),n.jsx("span",{className:"text-sm font-medium text-gray-700 capitalize",children:ec?.vehicle_type==="bici"?"Bicicletta":ec?.vehicle_type==="e_bike"?"E-Bike":ec?.vehicle_type==="scooter"?"Scooter":ec?.vehicle_type==="auto"?"Auto":"Veicolo non specificato"})]})]}),ec?.bio&&n.jsx("div",{className:"mb-4",children:(0,n.jsxs)("p",{className:"text-gray-700 text-center italic",children:["‚Äú",ec.bio,"‚Äù"]})}),(0,n.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[(0,n.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,n.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:["‚Ç¨",ec?.hourly_rate||0]}),n.jsx("div",{className:"text-xs text-gray-600",children:"per ora"})]}),(0,n.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-green-600",children:"Disponibile"}),n.jsx("div",{className:"text-xs text-gray-600",children:"Aggiornato ieri"})]})]}),(0,n.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4 justify-center",children:[n.jsx("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"rgba(51, 51, 102, 0.1)",color:"#333366"},children:"‚ö° Consegne veloci"}),n.jsx("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"‚úì Verificato"}),n.jsx("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full",children:"\uD83C\uDFC6 Rider professionale"})]}),n.jsx(m.z,{className:"w-full text-white font-medium",style:{backgroundColor:"#333366"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#4a4a7a",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#333366",onClick:()=>S(!0),children:"Modifica Profilo"})]})}),(0,n.jsxs)(u.Zb,{children:[n.jsx(u.Ol,{children:(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(h,{className:"h-5 w-5"})," Pagamenti"]})}),n.jsx(u.aY,{children:ec?.stripe_onboarding_complete?(0,n.jsxs)("div",{className:"text-center text-green-600",children:[n.jsx(p.Z,{className:"h-8 w-8 mx-auto mb-2"}),n.jsx("p",{children:"Onboarding Stripe Completato"}),n.jsx(m.z,{variant:"outline",className:"mt-4 w-full",onClick:ea,disabled:R,children:R?"Caricamento...":"Gestisci Pagamenti"})]}):(0,n.jsxs)("div",{className:"text-center",children:[(0,n.jsxs)("p",{className:"text-yellow-600 mb-2",children:[n.jsx(g.Z,{className:"inline h-5 w-5 mr-1"}),"Account Stripe Richiesto"]}),n.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Completa l'onboarding Stripe per ricevere pagamenti"}),n.jsx(m.z,{onClick:er,disabled:R,className:"w-full bg-green-600 hover:bg-green-700",children:R?"Caricamento...":"Attiva Pagamenti"}),ec?.stripe_account_id&&n.jsx("div",{className:"mt-2",children:n.jsx(m.z,{variant:"outline",size:"sm",onClick:ee,disabled:L,children:L?"Verificando...":"Verifica Stato"})})]})})]}),(0,n.jsxs)(u.Zb,{children:[n.jsx(u.Ol,{children:(0,n.jsxs)("div",{className:"flex items-center space-x-2",children:[n.jsx(f.Z,{className:"h-5 w-5 text-purple-600"}),n.jsx(u.ll,{children:"Disponibilit\xe0"})]})}),(0,n.jsxs)(u.aY,{className:"text-center",children:[n.jsx(m.z,{variant:"outline",disabled:!ec?.stripe_onboarding_complete,onClick:()=>t(!0),children:"Gestisci Calendario"}),!ec?.stripe_onboarding_complete&&n.jsx("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,n.jsxs)(u.Zb,{children:[n.jsx(u.Ol,{children:(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(j.Z,{className:"h-5 w-5"})," Prenotazioni"]})}),(0,n.jsxs)(u.aY,{className:"text-center",children:[n.jsx("p",{className:"text-3xl font-bold",children:"0"}),n.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Prenotazioni Attive"}),n.jsx(m.z,{variant:"outline",disabled:!ec?.stripe_onboarding_complete,children:"Visualizza Tutte"}),!ec?.stripe_onboarding_complete&&n.jsx("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,n.jsxs)(u.Zb,{children:[n.jsx(u.Ol,{children:(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(b,{className:"h-5 w-5"})," Guadagni"]})}),(0,n.jsxs)(u.aY,{className:"text-center",children:[n.jsx("p",{className:"text-3xl font-bold",children:"‚Ç¨0"}),n.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"Questo mese"}),n.jsx(m.z,{variant:"outline",disabled:!ec?.stripe_onboarding_complete,children:"Visualizza Storico"}),!ec?.stripe_onboarding_complete&&n.jsx("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,n.jsxs)(u.Zb,{children:[n.jsx(u.Ol,{children:(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(y.Z,{className:"h-5 w-5"})," Azioni Rapide"]})}),(0,n.jsxs)(u.aY,{className:"space-y-2",children:[(0,n.jsxs)(m.z,{variant:"outline",className:"w-full justify-start",disabled:!ec?.stripe_onboarding_complete,onClick:()=>i(!0),children:[n.jsx(N.Z,{className:"mr-2 h-4 w-4"})," Aggiorna Tariffa"]}),(0,n.jsxs)(m.z,{variant:"outline",className:"w-full justify-start",disabled:!ec?.stripe_onboarding_complete,onClick:()=>o(!0),children:[n.jsx(v.Z,{className:"mr-2 h-4 w-4"})," Dati Fiscali"]}),(0,n.jsxs)(m.z,{variant:"outline",className:"w-full justify-start",disabled:!ec?.stripe_onboarding_complete,children:[n.jsx(_.Z,{className:"mr-2 h-4 w-4"})," Cronologia"]}),!ec?.stripe_onboarding_complete&&n.jsx("p",{className:"text-xs text-orange-500 mt-2 text-center",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,n.jsxs)(u.Zb,{children:[(0,n.jsxs)(u.Ol,{children:[(0,n.jsxs)(u.ll,{className:"flex items-center gap-2",children:[n.jsx(w,{className:"h-5 w-5"})," Richieste di Servizio"]}),n.jsx(u.SZ,{children:"Gestisci le richieste di servizio ricevute"})]}),n.jsx(u.aY,{children:0===V.length?(0,n.jsxs)("div",{className:"text-center py-8",children:[n.jsx(w,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),n.jsx("p",{className:"text-gray-500 mb-2",children:"Nessuna richiesta ricevuta"}),n.jsx("p",{className:"text-sm text-gray-400",children:"Le nuove richieste appariranno qui"})]}):(0,n.jsxs)("div",{className:"space-y-3",children:[(0,n.jsxs)("div",{className:"grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[(0,n.jsxs)("div",{className:"text-center p-2 bg-yellow-50 rounded-lg",children:[n.jsx("p",{className:"text-lg font-bold text-yellow-600",children:V.filter(e=>"pending"===e.status).length}),n.jsx("p",{className:"text-xs text-yellow-700",children:"In Attesa"})]}),(0,n.jsxs)("div",{className:"text-center p-2 bg-green-50 rounded-lg",children:[n.jsx("p",{className:"text-lg font-bold text-green-600",children:V.filter(e=>"accepted"===e.status).length}),n.jsx("p",{className:"text-xs text-green-700",children:"Accettate"})]}),(0,n.jsxs)("div",{className:"text-center p-2 bg-red-50 rounded-lg",children:[n.jsx("p",{className:"text-lg font-bold text-red-600",children:V.filter(e=>"rejected"===e.status).length}),n.jsx("p",{className:"text-xs text-red-700",children:"Rifiutate"})]})]}),n.jsx("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:V.slice(0,3).map(e=>(0,n.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-lg gap-2 sm:gap-0",children:[(0,n.jsxs)("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"font-medium text-sm truncate",children:e.merchant.esercenti?.business_name||e.merchant.full_name}),(0,n.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.requested_date).toLocaleDateString("it-IT")," ","‚Ä¢ ",e.start_time.substring(0,5)," ‚Ä¢",e.duration_hours,"h"]})]}),n.jsx("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-2",children:"pending"===e.status?n.jsx(m.z,{size:"sm",onClick:()=>eo(e),className:"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto",children:"Rispondi"}):n.jsx("span",{className:`px-2 py-1 text-xs rounded-full whitespace-nowrap ${"accepted"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"}`,children:"accepted"===e.status?"Accettata":"Rifiutata"})})]},e.id))}),V.length>3&&(0,n.jsxs)(m.z,{variant:"outline",className:"w-full min-h-[44px] touch-manipulation",size:"lg",children:["Visualizza Tutte (",V.length,")"]})]})})]})]})]}),n.jsx(E.Z,{isOpen:U,onClose:()=>B(!1),userRole:"rider"}),s&&e&&n.jsx(Z,{riderId:e.id,onClose:()=>t(!1)}),a&&e&&n.jsx(M,{riderId:e.id,currentRate:e.riders_details?.hourly_rate||null,onClose:()=>i(!1)}),l&&e&&n.jsx(G,{isOpen:l,riderId:e.id,onClose:()=>o(!1)}),x&&e&&n.jsx(W,{isOpen:x,onClose:()=>S(!1),riderId:e.id,onProfileUpdate:Q}),n.jsx(es,{isOpen:$,onClose:()=>{Y(!1),X(null)},request:K,riderHourlyRate:e?.riders_details?.hourly_rate||null,onRespond:el})]})}function ei(){return n.jsx(c.Suspense,{fallback:n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:(0,n.jsxs)("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 mx-auto",style:{borderBottomColor:"#333366"}}),n.jsx("p",{className:"mt-4 text-gray-600",children:"Caricamento dashboard..."})]})}),children:n.jsx(ea,{})})}},46260:(e,r,s)=>{"use strict";s.d(r,{P0:()=>a,Pz:()=>i,RZ:()=>l,SI:()=>t});let t={MAX_RIDER_HOURLY_RATE:12.5,MAX_BOOKING_HOURS:2,MIN_RIDER_HOURLY_RATE:5,MIN_BOOKING_HOURS:1},a=e=>e>=t.MIN_RIDER_HOURLY_RATE&&e<=t.MAX_RIDER_HOURLY_RATE,i=e=>e>=t.MIN_BOOKING_HOURS&&e<=t.MAX_BOOKING_HOURS,l={INVALID_RIDER_RATE:`La tariffa oraria deve essere compresa tra ‚Ç¨${t.MIN_RIDER_HOURLY_RATE} e ‚Ç¨${t.MAX_RIDER_HOURLY_RATE}`,INVALID_BOOKING_HOURS:`Le ore di prenotazione devono essere comprese tra ${t.MIN_BOOKING_HOURS} e ${t.MAX_BOOKING_HOURS}`}},97697:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(76557).Z)("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]])},40617:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(76557).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},3634:(e,r,s)=>{"use strict";s.d(r,{Z:()=>t});let t=(0,s(76557).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])},12177:(e,r,s)=>{"use strict";function t({children:e}){return e}s.r(r),s.d(r,{default:()=>t})},86742:(e,r,s)=>{"use strict";s.r(r),s.d(r,{default:()=>t});let t=(0,s(68570).createProxy)(String.raw`/home/dimagio/Applications/bemyrider project/bemyrider_app/bemyrider/app/dashboard/rider/page.tsx#default`)}};var r=require("../../../webpack-runtime.js");r.C(e);var s=e=>r(r.s=e),t=r.X(0,[276,643,158,481,309,637],()=>s(97249));module.exports=t})();