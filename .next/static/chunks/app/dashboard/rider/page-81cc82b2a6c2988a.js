(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{6022:function(e,r,s){Promise.resolve().then(s.bind(s,6226))},6226:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return ed}});var t,a,i,l,n,o,c,d,u,m,x=s(7437),h=s(2265),p=s(9376),g=s(2869),f=s(6070),j=s(9763);let b=(0,j.Z)("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);var v=s(5302),N=s(3639),y=s(1047),_=s(5557);let w=(0,j.Z)("CircleDollarSign",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 18V6",key:"zqpxq5"}]]);var D=s(1239),E=s(1477),A=s(8736),C=s(1723);let S=(0,j.Z)("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);var R=s(2141),I=s(3145),O=s(9651),z=s(2321),k=s(5186),Z=s(6815),T=s(2489),L=s(9397),M=s(3229);let F=[{key:"Lun",label:"Luned\xec",short:"Lun"},{key:"Mar",label:"Marted\xec",short:"Mar"},{key:"Mer",label:"Mercoled\xec",short:"Mer"},{key:"Gio",label:"Gioved\xec",short:"Gio"},{key:"Ven",label:"Venerd\xec",short:"Ven"},{key:"Sab",label:"Sabato",short:"Sab"},{key:"Dom",label:"Domenica",short:"Dom"}];function P(e){let{riderId:r,onClose:s}=e,[t,a]=(0,h.useState)(F.map(e=>({day:e.key,isAvailable:!1,timeSlots:[]}))),[i,l]=(0,h.useState)(!1),[n,o]=(0,h.useState)(!1),[c,d]=(0,h.useState)(null);(0,h.useEffect)(()=>{u()},[r]);let u=async()=>{try{l(!0);let{data:e,error:s}=await R.O.from("disponibilita_riders").select("*").eq("rider_id",r);if(s){console.error("Error fetching availability:",s);return}let t=new Map;null==e||e.forEach(e=>{t.set(e.day_of_week,{start_time:e.start_time,end_time:e.end_time})}),a(e=>e.map(e=>{let r=t.get(e.day);return{...e,isAvailable:!!r,timeSlots:r?[r]:[]}}))}catch(e){console.error("Error:",e)}finally{l(!1)}},m=e=>{a(r=>r.map(r=>r.day===e?{...r,isAvailable:!r.isAvailable,timeSlots:r.isAvailable?[]:[{start_time:"09:00",end_time:"17:00"}]}:r))},p=e=>{a(r=>r.map(r=>r.day===e?{...r,timeSlots:[...r.timeSlots,{start_time:"09:00",end_time:"17:00"}]}:r))},j=(e,r)=>{a(s=>s.map(s=>s.day===e?{...s,timeSlots:s.timeSlots.filter((e,s)=>s!==r)}:s))},b=(e,r,s,t)=>{a(a=>a.map(a=>a.day===e?{...a,timeSlots:a.timeSlots.map((e,a)=>a===r?{...e,[s]:t}:e)}:a))},N=async()=>{try{o(!0),d(null),await R.O.from("disponibilita_riders").delete().eq("rider_id",r);let e=[];for(let s of t)if(s.isAvailable)for(let t of s.timeSlots)e.push({rider_id:r,day_of_week:s.day,start_time:t.start_time,end_time:t.end_time});if(e.length>0){let{error:r}=await R.O.from("disponibilita_riders").insert(e);if(r)throw r}d({type:"success",text:"Disponibilit\xe0 salvata con successo!"}),setTimeout(()=>{s()},1500)}catch(e){console.error("Error saving availability:",e),d({type:"error",text:e.message||"Errore nel salvataggio"})}finally{o(!1)}};return i?(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,x.jsx)(f.Zb,{className:"w-full max-w-md",children:(0,x.jsxs)(f.aY,{className:"p-6 text-center",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,x.jsx)("p",{children:"Caricamento disponibilit\xe0..."})]})})}):(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,x.jsxs)(f.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)(f.Ol,{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(y.Z,{className:"h-5 w-5 text-purple-600"}),(0,x.jsx)(f.ll,{children:"Gestisci Disponibilit\xe0"})]}),(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:s,children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]}),(0,x.jsx)(f.SZ,{children:"Imposta i tuoi orari di disponibilit\xe0 per ogni giorno della settimana"})]}),(0,x.jsxs)(f.aY,{className:"space-y-6",children:[c&&(0,x.jsxs)("div",{className:"p-3 rounded-lg flex items-center space-x-2 ".concat("success"===c.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===c.type&&(0,x.jsx)(v.Z,{className:"h-4 w-4"}),(0,x.jsx)("span",{children:c.text})]}),(0,x.jsx)("div",{className:"space-y-4",children:F.map(e=>{let{key:r,label:s,short:a}=e,i=t.find(e=>e.day===r);return(0,x.jsx)(f.Zb,{className:"border-l-4 border-purple-500",children:(0,x.jsxs)(f.aY,{className:"p-4",children:[(0,x.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,x.jsx)(g.z,{variant:i.isAvailable?"default":"outline",size:"sm",onClick:()=>m(r),className:"w-16",children:a}),(0,x.jsx)("span",{className:"font-medium",children:s})]}),i.isAvailable&&(0,x.jsxs)(g.z,{variant:"outline",size:"sm",onClick:()=>p(r),children:[(0,x.jsx)(L.Z,{className:"h-4 w-4 mr-1"}),"Aggiungi Fascia"]})]}),i.isAvailable&&(0,x.jsxs)("div",{className:"space-y-2",children:[i.timeSlots.map((e,s)=>(0,x.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 p-2 rounded",children:[(0,x.jsx)(C.Z,{className:"h-4 w-4 text-gray-500"}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(Z._,{htmlFor:"start-".concat(r,"-").concat(s),className:"text-sm",children:"Da:"}),(0,x.jsx)(k.I,{id:"start-".concat(r,"-").concat(s),type:"time",value:e.start_time,onChange:e=>b(r,s,"start_time",e.target.value),className:"w-32"})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(Z._,{htmlFor:"end-".concat(r,"-").concat(s),className:"text-sm",children:"A:"}),(0,x.jsx)(k.I,{id:"end-".concat(r,"-").concat(s),type:"time",value:e.end_time,onChange:e=>b(r,s,"end_time",e.target.value),className:"w-32"})]}),i.timeSlots.length>1&&(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:()=>j(r,s),className:"text-red-500 hover:text-red-700",children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]},s)),0===i.timeSlots.length&&(0,x.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Nessuna fascia oraria impostata"})]})]})},r)})}),(0,x.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,x.jsx)(g.z,{variant:"outline",onClick:s,disabled:n,children:"Annulla"}),(0,x.jsx)(g.z,{onClick:N,disabled:n,children:n?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(M.Z,{className:"h-4 w-4 mr-2"}),"Salva Disponibilit\xe0"]})})]})]})]})})}var U=s(2252),G=s(8685);function B(e){let{riderId:r,currentRate:s,onClose:t}=e,[a,i]=(0,h.useState)(s?s.toString():""),[l,n]=(0,h.useState)(!1),[o,c]=(0,h.useState)(null),d=async e=>{e.preventDefault(),n(!0),c(null);try{e.target.checkValidity()||e.stopPropagation();let s=parseFloat(a.replace(",","."));if(isNaN(s)||s<=0)throw Error("⚠️ Inserisci una tariffa valida maggiore di €0,01");if(!(0,G.P0)(s))throw Error(G.RZ.INVALID_RIDER_RATE);console.log("\uD83D\uDD04 Updating rider rate...",{riderId:r,rate:s});let{error:i}=await R.O.from("riders_details").update({hourly_rate:s,updated_at:new Date().toISOString()}).eq("profile_id",r);if(i)throw console.error("❌ Error updating rate:",i),i;console.log("✅ Rate updated successfully"),c({type:"success",text:"✅ Tariffa aggiornata con successo a €".concat(s.toFixed(2),"/ora")}),setTimeout(()=>{t(),window.location.reload()},1500)}catch(e){console.error("❌ Error:",e),c({type:"error",text:e.message||"Errore durante l'aggiornamento"})}finally{n(!1)}};return(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,x.jsxs)(f.Zb,{className:"w-full max-w-md bg-white",children:[(0,x.jsxs)(f.Ol,{children:[(0,x.jsxs)("div",{className:"flex items-center justify-between",children:[(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(E.Z,{className:"h-5 w-5"}),"Aggiorna Tariffa"]}),(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:t,disabled:l,children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]}),(0,x.jsx)(f.SZ,{children:"Imposta la tua tariffa oraria per i servizi di delivery"})]}),(0,x.jsxs)(f.aY,{children:[(0,x.jsxs)("form",{onSubmit:d,className:"space-y-4",noValidate:!0,children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsx)(Z._,{htmlFor:"hourlyRate",children:"Tariffa Oraria (€/ora)"}),(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(E.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,x.jsx)(k.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]+)?",value:a,onChange:e=>{let r=e.target.value;if(i(r=r.replace(/[^0-9.,]/g,"").replace(",",".")),(null==o?void 0:o.type)==="error"&&c(null),r&&!isNaN(parseFloat(r))){let e=parseFloat(r);e>12.5?c({type:"error",text:"⚠️ La tariffa non pu\xf2 superare €12,50/ora per rispettare i limiti fiscali"}):e<=0&&c({type:"error",text:"⚠️ Inserisci una tariffa valida maggiore di €0,01"})}},onKeyDown:e=>{-1===[46,8,9,27,13,190,188].indexOf(e.keyCode)&&(65!==e.keyCode||!0!==e.ctrlKey)&&(67!==e.keyCode||!0!==e.ctrlKey)&&(86!==e.keyCode||!0!==e.ctrlKey)&&(88!==e.keyCode||!0!==e.ctrlKey)&&(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},placeholder:"Es. 12.00",className:"pl-10",disabled:l})]}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"Max €12,50/ora per rimanere sotto la soglia fiscale di €25,82 (2 ore max)"})]}),s&&(0,x.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,x.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,x.jsx)("strong",{children:"Tariffa attuale:"})," €",s,"/ora"]})}),o&&(0,x.jsxs)("div",{className:"p-3 rounded-lg flex items-center gap-2 ".concat("success"===o.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===o.type?(0,x.jsx)(v.Z,{className:"h-4 w-4"}):(0,x.jsx)(U.Z,{className:"h-4 w-4"}),(0,x.jsx)("span",{className:"text-sm",children:o.text})]}),(0,x.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,x.jsx)(g.z,{type:"button",variant:"outline",onClick:t,disabled:l,className:"flex-1",children:"Annulla"}),(0,x.jsx)(g.z,{type:"submit",disabled:l||!a,className:"flex-1",children:l?(0,x.jsx)(x.Fragment,{children:"Aggiornamento..."}):(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)(M.Z,{className:"mr-2 h-4 w-4"}),"Salva"]})})]})]}),(0,x.jsxs)("div",{className:"mt-6 bg-green-50 p-3 rounded-lg",children:[(0,x.jsx)("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"\uD83D\uDCCB Informazioni Fiscali"}),(0,x.jsxs)("ul",{className:"text-xs text-green-600 space-y-1",children:[(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Tariffa max:"})," €12,50/ora"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Durata max:"})," 2 ore per prenotazione"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Totale max:"})," €25,00 (< €25,82)"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Vantaggio:"})," Nessuna ritenuta d'acconto"]})]}),(0,x.jsxs)("p",{className:"text-xs text-green-600 mt-2 italic",children:["Fonte:"," ",(0,x.jsx)("a",{href:"https://www.agenziaentrate.gov.it/portale/schede/pagamenti/versamento-modello-f24-ritenute-su-reddito-di-lavoro-autonomo-f24_rit_red_lav_aut/redditi-soggetti-a-ritenuta-f24_rit_red_lav_aut",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-green-800",children:"Agenzia delle Entrate - Ritenute Lavoro Autonomo"})]})]})]})]})})}var q=s(2369),V=s(3774);let H=(0,j.Z)("Calculator",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",key:"1nb95v"}],["line",{x1:"8",x2:"16",y1:"6",y2:"6",key:"x4nwl0"}],["line",{x1:"16",x2:"16",y1:"14",y2:"18",key:"wjye3r"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M8 14h.01",key:"6423bh"}],["path",{d:"M12 18h.01",key:"mhygvu"}],["path",{d:"M8 18h.01",key:"lrp35t"}]]);function Y(e){let{isOpen:r,onClose:s,riderId:t}=e,[a,i]=(0,h.useState)({first_name:"",last_name:"",fiscal_code:"",birth_place:"",birth_date:"",residence_address:"",residence_city:""}),[l,n]=(0,h.useState)(!1),[o,c]=(0,h.useState)(null);(0,h.useEffect)(()=>{r&&t&&d()},[r,t]);let d=async()=>{try{let{data:e,error:r}=await R.O.from("rider_tax_details").select("*").eq("rider_id",t).single();if(r&&"PGRST116"!==r.code){console.error("Error fetching fiscal data:",r);return}e&&i({first_name:e.first_name||"",last_name:e.last_name||"",fiscal_code:e.fiscal_code||"",birth_place:e.birth_place||"",birth_date:e.birth_date||"",residence_address:e.residence_address||"",residence_city:e.residence_city||""})}catch(e){console.error("Error fetching fiscal data:",e)}},u=e=>/^[A-Z]{6}[0-9]{2}[A-Z][0-9]{2}[A-Z][0-9]{3}[A-Z]$/.test(e.toUpperCase()),m=e=>e.replace(/[AEIOU]/g,""),p=e=>e.replace(/[^AEIOU]/g,""),j=e=>["A","B","C","D","E","H","L","M","P","R","S","T"][e-1]||"A",b=e=>{for(let[r,s]of Object.entries({PALERMO:"G273",ROMA:"H501",MILANO:"F205",NAPOLI:"F839",TORINO:"L219",GENOVA:"D969",BOLOGNA:"A944",FIRENZE:"D612",VENEZIA:"L736",BARI:"A662",CATANIA:"C351",VERONA:"L781",MESSINA:"F158",PADOVA:"G224",TRIESTE:"L424",BRESCIA:"B157",PARMA:"G337",PRATO:"G999",MODENA:"F257","REGGIO CALABRIA":"H224","REGGIO EMILIA":"H223",PERUGIA:"G478",LIVORNO:"E625",RAVENNA:"H199",CAGLIARI:"B354",FOGGIA:"D643",RIMINI:"H294",SALERNO:"H703",FERRARA:"D548",SASSARI:"I452",LATINA:"E472","GIUGLIANO IN CAMPANIA":"E058",MONZA:"F704",SYRACUSA:"I754",PESCARA:"G482",BERGAMO:"A794",FORLÌ:"D704",TRENTO:"L378",VICENZA:"L840",TERNI:"L112",BOLZANO:"A952",NOVARA:"F952",PIACENZA:"G535",ANCONA:"A271",ANDRIA:"A285",AREZZO:"A390",UDINE:"L483",CESENA:"C514",LECCE:"E506",PESARO:"G479"}))if(e.includes(r))return s;let r=e.match(/\(([^)]+)\)/);if(r){let e=r[1],s={PA:"G273",RM:"H501",MI:"F205",NA:"F839",TO:"L219",GE:"D969",BO:"A944",FI:"D612",VE:"L736",BA:"A662",CT:"C351",VR:"L781",ME:"F158"};if(s[e])return s[e]}return"H501"},v=e=>{let r={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23},s={0:1,1:0,2:5,3:7,4:9,5:13,6:15,7:17,8:19,9:21},t={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},a={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},i=0;for(let l=0;l<15;l++){let n=e[l].toUpperCase();l%2==0?isNaN(parseInt(n))?i+=r[n]||0:i+=s[n]||0:isNaN(parseInt(n))?i+=t[n]||0:i+=a[n]||0}return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[i%26]},N=(e,r)=>{if(i(s=>({...s,[e]:r})),(null==o?void 0:o.type)==="error"&&c(null),"fiscal_code"===e&&r.length>0){let e=r.toUpperCase();16!==r.length||u(e)||c({type:"error",text:"⚠️ Codice fiscale non valido. Controlla il formato (16 caratteri)"})}},_=async e=>{e.preventDefault(),n(!0),c(null);try{if(!a.first_name.trim())throw Error("⚠️ Il nome \xe8 obbligatorio");if(!a.last_name.trim())throw Error("⚠️ Il cognome \xe8 obbligatorio");if(!a.fiscal_code.trim())throw Error("⚠️ Il codice fiscale \xe8 obbligatorio");if(!u(a.fiscal_code.toUpperCase()))throw Error("⚠️ Codice fiscale non valido. Deve essere di 16 caratteri nel formato corretto");if(!a.birth_place.trim())throw Error("⚠️ Il luogo di nascita \xe8 obbligatorio");if(!a.birth_date.trim())throw Error("⚠️ La data di nascita \xe8 obbligatoria");if(!a.residence_address.trim())throw Error("⚠️ L'indirizzo di residenza \xe8 obbligatorio");if(!a.residence_city.trim())throw Error("⚠️ La citt\xe0 di residenza \xe8 obbligatoria");let e={rider_id:t,first_name:a.first_name.trim(),last_name:a.last_name.trim(),fiscal_code:a.fiscal_code.toUpperCase(),birth_place:a.birth_place.trim(),birth_date:a.birth_date,residence_address:a.residence_address.trim(),residence_city:a.residence_city.trim()},{error:r}=await R.O.from("rider_tax_details").upsert(e,{onConflict:"rider_id"});if(r)throw console.error("Error saving fiscal data:",r),Error("❌ Errore durante il salvataggio. Riprova.");c({type:"success",text:"✅ Dati fiscali salvati con successo!"}),setTimeout(()=>{s()},1500)}catch(e){console.error("Error saving fiscal data:",e),c({type:"error",text:e.message||"❌ Errore durante il salvataggio. Riprova."})}finally{n(!1)}},w=()=>{c(null),s()};return r?(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,x.jsxs)(f.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(A.Z,{className:"h-5 w-5"}),"Dati Fiscali"]}),(0,x.jsx)(f.SZ,{children:"Inserisci i tuoi dati fiscali per la fatturazione e la compliance"})]}),(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:w,disabled:l,children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]}),(0,x.jsxs)(f.aY,{children:[o&&(0,x.jsx)("div",{className:"mb-4 p-3 rounded-lg ".concat("success"===o.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:o.text}),(0,x.jsxs)("form",{onSubmit:_,className:"space-y-4",noValidate:!0,children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"firstName",className:"flex items-center gap-2",children:[(0,x.jsx)(q.Z,{className:"h-4 w-4"}),"Nome *"]}),(0,x.jsx)(k.I,{id:"firstName",type:"text",value:a.first_name,onChange:e=>N("first_name",e.target.value),placeholder:"Es. Mario",disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"lastName",className:"flex items-center gap-2",children:[(0,x.jsx)(q.Z,{className:"h-4 w-4"}),"Cognome *"]}),(0,x.jsx)(k.I,{id:"lastName",type:"text",value:a.last_name,onChange:e=>N("last_name",e.target.value),placeholder:"Es. Rossi",disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"birthPlace",className:"flex items-center gap-2",children:[(0,x.jsx)(V.Z,{className:"h-4 w-4"}),"Luogo di Nascita *"]}),(0,x.jsx)(k.I,{id:"birthPlace",type:"text",value:a.birth_place,onChange:e=>N("birth_place",e.target.value),placeholder:"Es. Roma (RM)",disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"birthDate",className:"flex items-center gap-2",children:[(0,x.jsx)(y.Z,{className:"h-4 w-4"}),"Data di Nascita *"]}),(0,x.jsx)(k.I,{id:"birthDate",type:"date",value:a.birth_date,onChange:e=>N("birth_date",e.target.value),disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"fiscalCode",className:"flex items-center gap-2",children:[(0,x.jsx)(q.Z,{className:"h-4 w-4"}),"Codice Fiscale *"]}),(0,x.jsxs)("div",{className:"flex gap-2",children:[(0,x.jsx)(k.I,{id:"fiscalCode",type:"text",maxLength:16,value:a.fiscal_code,onChange:e=>N("fiscal_code",e.target.value.toUpperCase()),placeholder:"Es. RSSMRA85M01H501X",className:"uppercase flex-1",disabled:l,required:!0}),(0,x.jsxs)(g.z,{type:"button",variant:"outline",onClick:()=>{let{first_name:e,last_name:r,birth_date:s,birth_place:t}=a;if(!e.trim()||!r.trim()||!s||!t.trim()){c({type:"error",text:"⚠️ Compila tutti i campi (nome, cognome, data e luogo di nascita) per calcolare il codice fiscale"});return}try{let a=r.toUpperCase().replace(/\s/g,""),l=m(a),n=p(a),o="";o=l.length>=3?l.substring(0,3):(l+n+"XXX").substring(0,3);let d=e.toUpperCase().replace(/\s/g,""),u=m(d),x=p(d),h="";h=u.length>=4?u[0]+u[2]+u[3]:u.length>=3?u.substring(0,3):(u+x+"XXX").substring(0,3);let g=s.substring(2,4),f=j(parseInt(s.substring(5,7))),N=s.substring(8,10),y=b(t.toUpperCase()),_=o+h+g+f+N+y,w=v(_),D=_+w;i(e=>({...e,fiscal_code:D})),c({type:"success",text:"✅ Codice fiscale calcolato: ".concat(D,". Verifica che sia corretto.")})}catch(e){c({type:"error",text:"❌ Errore nel calcolo del codice fiscale. Inseriscilo manualmente."})}},disabled:l,className:"shrink-0",children:[(0,x.jsx)(H,{className:"h-4 w-4 mr-1"}),"Calcola"]})]}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"16 caratteri alfanumerici (lettere maiuscole e numeri)"})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"residenceAddress",className:"flex items-center gap-2",children:[(0,x.jsx)(V.Z,{className:"h-4 w-4"}),"Indirizzo di Residenza *"]}),(0,x.jsx)(k.I,{id:"residenceAddress",type:"text",value:a.residence_address,onChange:e=>N("residence_address",e.target.value),placeholder:"Es. Via Roma, 123",disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"residenceCity",className:"flex items-center gap-2",children:[(0,x.jsx)(V.Z,{className:"h-4 w-4"}),"Citt\xe0 di Residenza *"]}),(0,x.jsx)(k.I,{id:"residenceCity",type:"text",value:a.residence_city,onChange:e=>N("residence_city",e.target.value),placeholder:"Es. Milano (MI)",disabled:l,required:!0})]}),(0,x.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,x.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[(0,x.jsx)(U.Z,{className:"h-4 w-4"}),"Informazioni Importanti"]}),(0,x.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Privacy:"})," I dati sono protetti secondo il GDPR"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Uso:"})," Utilizzati solo per fatturazione e compliance fiscale"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Sicurezza:"})," Trasmissione e archiviazione crittografate"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Modifiche:"})," Puoi aggiornare i dati in qualsiasi momento"]})]})]}),(0,x.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,x.jsx)(g.z,{type:"button",variant:"outline",onClick:w,disabled:l,className:"flex-1",children:"Annulla"}),(0,x.jsx)(g.z,{type:"submit",disabled:l,className:"flex-1",children:l?(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(M.Z,{className:"h-4 w-4"}),"Salva Dati Fiscali"]})})]})]})]})]})}):null}var K=s(3417),X=s(421);let J=(0,j.Z)("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);(t=o||(o={})).AVAILABLE="available",t.BUSY="busy",t.OFFLINE="offline",(a=c||(c={})).PENDING="pending",a.CONFIRMED="confirmed",a.COMPLETED="completed",a.CANCELLED="cancelled",(i=d||(d={})).RIDER="rider",i.MERCHANT="merchant",(l=u||(u={})).BIKE="bike",l.SCOOTER="scooter",l.CAR="car",l.MOTORBIKE="motorbike",l.WALKING="walking",(n=m||(m={})).BICI="bici",n.E_BIKE="e_bike",n.SCOOTER="scooter",n.AUTO="auto";let W={bici:"\uD83D\uDEB2 Bicicletta",e_bike:"\uD83D\uDEB4‍♂️ E-Bike",scooter:"\uD83D\uDEF5 Scooter",auto:"\uD83D\uDE97 Auto"},Q=e=>{var r;return(null==e?void 0:e.code)==="PGRST301"||(null==e?void 0:e.code)==="PGRST302"||(null==e?void 0:e.status)===401||(null==e?void 0:e.status)===403||(null==e?void 0:null===(r=e.message)||void 0===r?void 0:r.includes("JWT"))},$=async()=>{try{console.log("\uD83D\uDD04 Refreshing session...");let{data:e,error:r}=await R.O.auth.refreshSession();if(r)return console.error("❌ Failed to refresh session:",r),!1;if(e.session)return console.log("✅ Session refreshed successfully"),!0;return console.warn("⚠️ No session returned after refresh"),!1}catch(e){return console.error("❌ Error during session refresh:",e),!1}},ee=async function(e){let r,s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let t=0;t<=s;t++)try{let{data:{user:r},error:s}=await R.O.auth.getUser();if(s||!r)throw Error("User not authenticated");return await e()}catch(e){if(r=e,Q(e)&&t<s){if(console.log("\uD83D\uDD04 Auth error detected, attempting refresh (attempt ".concat(t+1,"/").concat(s+1,")")),!await $())throw Error("Failed to refresh session");await new Promise(e=>setTimeout(e,1e3));continue}throw e}throw r},er=(e,r)=>!!Q(e)&&(console.log("\uD83D\uDEAB Authentication error detected, redirecting to login"),r.push("/auth/login"),!0),es=Object.values(m).map(e=>({value:e,label:W[e]}));function et(e){let{isOpen:r,onClose:s,riderId:t,onProfileUpdate:a}=e,i=(0,p.useRouter)(),[l,n]=(0,h.useState)({full_name:"",bio:"",hourly_rate:"",vehicle_type:"",profile_picture_url:"",active_location:""}),[o,c]=(0,h.useState)(!1),[d,u]=(0,h.useState)(null);(0,h.useEffect)(()=>{r&&t&&m()},[r,t]);let m=async()=>{try{let{data:e,error:r}=await R.O.from("profiles").select("\n          full_name,\n          riders_details (\n            bio,\n            hourly_rate,\n            vehicle_type,\n            profile_picture_url,\n            active_location\n          )\n        ").eq("id",t).single();if(r){console.error("Error fetching profile data:",r);return}if(e){let r=Array.isArray(e.riders_details)?e.riders_details[0]:e.riders_details;n({full_name:e.full_name||"",bio:(null==r?void 0:r.bio)||"",hourly_rate:(null==r?void 0:r.hourly_rate)?r.hourly_rate.toString():"",vehicle_type:(null==r?void 0:r.vehicle_type)||"",profile_picture_url:(null==r?void 0:r.profile_picture_url)||"",active_location:(null==r?void 0:r.active_location)||""})}}catch(e){console.error("Error fetching profile data:",e)}},j=e=>{let r=parseFloat(e);return!isNaN(r)&&r>0&&r<=12.5},b=(e,r)=>{if(n(s=>({...s,[e]:r})),(null==d?void 0:d.type)==="error"&&u(null),"hourly_rate"===e&&r.length>0){let e=parseFloat(r);isNaN(e)?u({type:"error",text:"⚠️ Inserisci un numero valido per la tariffa"}):e<=0?u({type:"error",text:"⚠️ La tariffa deve essere maggiore di €0"}):e>12.5&&u({type:"error",text:"⚠️ Tariffa massima consentita: €12.50/h (per evitare ritenuta d'acconto)"})}},v=async e=>{e.preventDefault(),c(!0),u(null);try{if(!l.full_name.trim())throw Error("⚠️ Il nome completo \xe8 obbligatorio");if(l.hourly_rate&&!j(l.hourly_rate))throw Error("⚠️ La tariffa oraria deve essere tra €0.01 e €12.50");await ee(async()=>{let{error:e}=await R.O.from("profiles").update({full_name:l.full_name.trim()||null,updated_at:new Date().toISOString()}).eq("id",t);if(e)throw console.error("Error updating profile:",e),e;let r={bio:l.bio.trim()||null,vehicle_type:l.vehicle_type||null,profile_picture_url:l.profile_picture_url.trim()||null,active_location:l.active_location.trim()||null,updated_at:new Date().toISOString()};l.hourly_rate.trim()&&(r.hourly_rate=parseFloat(l.hourly_rate));let{error:s}=await R.O.from("riders_details").update(r).eq("profile_id",t);if(s)throw console.error("Error updating rider details:",s),s},2),u({type:"success",text:"✅ Profilo aggiornato con successo!"}),a&&a(),setTimeout(()=>{s()},1500)}catch(e){if(console.error("Profile update error:",e),er(e,i)){u({type:"error",text:"\uD83D\uDD12 Sessione scaduta. Stai per essere reindirizzato al login..."}),setTimeout(()=>{s()},2e3);return}u({type:"error",text:e.message||"❌ Errore durante l'aggiornamento del profilo. Riprova."})}finally{c(!1)}},N=()=>{u(null),s()};return r?(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,x.jsxs)(f.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,x.jsxs)("div",{children:[(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(q.Z,{className:"h-5 w-5"}),"Modifica Profilo"]}),(0,x.jsx)(f.SZ,{children:"Aggiorna le tue informazioni di profilo rider"})]}),(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:N,disabled:o,children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]}),(0,x.jsxs)(f.aY,{children:[d&&(0,x.jsx)("div",{className:"mb-4 p-3 rounded-lg ".concat("success"===d.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:d.text}),(0,x.jsxs)("form",{onSubmit:v,className:"space-y-4",noValidate:!0,children:[(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"fullName",className:"flex items-center gap-2",children:[(0,x.jsx)(q.Z,{className:"h-4 w-4"}),"Nome Completo"]}),(0,x.jsx)(k.I,{id:"fullName",type:"text",value:l.full_name,onChange:e=>b("full_name",e.target.value),placeholder:"Inserisci il tuo nome completo",disabled:o,required:!0}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"Il nome che verr\xe0 mostrato ai clienti"})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"bio",className:"flex items-center gap-2",children:[(0,x.jsx)(K.Z,{className:"h-4 w-4"}),"Bio / Descrizione"]}),(0,x.jsx)("textarea",{id:"bio",value:l.bio,onChange:e=>b("bio",e.target.value),placeholder:"Descrivi brevemente te stesso e la tua esperienza come rider...",className:"w-full p-2 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500,disabled:o}),(0,x.jsxs)("p",{className:"text-xs text-gray-500",children:["Massimo 500 caratteri (",500-l.bio.length," rimanenti)"]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"vehicleType",className:"flex items-center gap-2",children:[(0,x.jsx)(X.Z,{className:"h-4 w-4"}),"Tipo di Veicolo"]}),(0,x.jsxs)("select",{id:"vehicleType",value:l.vehicle_type,onChange:e=>b("vehicle_type",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:o,children:[(0,x.jsx)("option",{value:"",children:"Seleziona veicolo"}),es.map(e=>(0,x.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"activeLocation",className:"flex items-center gap-2",children:[(0,x.jsx)(V.Z,{className:"h-4 w-4"}),"Localit\xe0 Attiva"]}),(0,x.jsx)(k.I,{id:"activeLocation",type:"text",value:l.active_location,onChange:e=>b("active_location",e.target.value),placeholder:"Milano, Roma, Torino, ecc...",disabled:o,maxLength:100}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"La citt\xe0 o zona dove sei attivo per le consegne (massimo 100 caratteri)"})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"hourlyRate",className:"flex items-center gap-2",children:[(0,x.jsx)(E.Z,{className:"h-4 w-4"}),"Tariffa Oraria (€/h)"]}),(0,x.jsx)(k.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:l.hourly_rate,onChange:e=>b("hourly_rate",e.target.value),placeholder:"Es. 10.00",disabled:o}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"Tariffa massima: €12.50/h per evitare ritenuta d'acconto su prestazioni occasionali"})]}),(0,x.jsxs)("div",{className:"space-y-2",children:[(0,x.jsxs)(Z._,{htmlFor:"profilePictureUrl",className:"flex items-center gap-2",children:[(0,x.jsx)(J,{className:"h-4 w-4"}),"URL Immagine Profilo"]}),(0,x.jsx)(k.I,{id:"profilePictureUrl",type:"url",value:l.profile_picture_url,onChange:e=>b("profile_picture_url",e.target.value),placeholder:"https://esempio.com/mia-foto.jpg",disabled:o}),l.profile_picture_url&&(0,x.jsxs)("div",{className:"mt-3",children:[(0,x.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Anteprima:"}),(0,x.jsx)("div",{className:"flex justify-center",children:(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(I.default,{src:l.profile_picture_url,alt:"Anteprima foto profilo",width:96,height:96,className:"w-24 h-24 rounded-full object-cover border-3 border-blue-200 shadow-md",onError:e=>{e.currentTarget.style.display="none"}}),(0,x.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]})}),(0,x.jsx)("p",{className:"text-xs text-green-600 text-center mt-2",children:"✓ Immagine caricata correttamente"})]}),(0,x.jsx)("p",{className:"text-xs text-gray-500",children:"Inserisci l'URL di un'immagine (JPG, PNG, WEBP)"})]}),(0,x.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,x.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[(0,x.jsx)(U.Z,{className:"h-4 w-4"}),"Informazioni"]}),(0,x.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Nome:"})," Mostrato ai clienti nelle prenotazioni"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Bio:"})," Aiuta i clienti a conoscerti meglio"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Veicolo:"})," Influenza i tipi di consegne disponibili"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Localit\xe0:"})," Determina la tua visibilit\xe0 nelle ricerche geografiche"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Tariffa:"})," Pu\xf2 essere aggiornata in qualsiasi momento"]}),(0,x.jsxs)("li",{children:["• ",(0,x.jsx)("strong",{children:"Foto profilo:"})," Aumenta la fiducia dei clienti"]})]})]}),(0,x.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,x.jsx)(g.z,{type:"button",variant:"outline",onClick:N,disabled:o,className:"flex-1",children:"Annulla"}),(0,x.jsx)(g.z,{type:"submit",disabled:o,className:"flex-1",children:o?(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,x.jsxs)("div",{className:"flex items-center gap-2",children:[(0,x.jsx)(M.Z,{className:"h-4 w-4"}),"Salva Modifiche"]})})]})]})]})]})}):null}var ea=s(4508);let ei=h.forwardRef((e,r)=>{let{className:s,...t}=e;return(0,x.jsx)("textarea",{className:(0,ea.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",s),ref:r,...t})});ei.displayName="Textarea";var el=s(7992);function en(e){var r;let{isOpen:s,onClose:t,request:a,riderHourlyRate:i,onRespond:l}=e,{toast:n}=(0,el.pm)(),[o,c]=(0,h.useState)(!1),[d,u]=(0,h.useState)(null),[m,p]=(0,h.useState)(""),j=async e=>{if(e.preventDefault(),a&&d){c(!0);try{await l(a.id,d,m.trim()||void 0),console.log("\uD83C\uDF89 Risposta inviata con successo, mostrando toast..."),t(),setTimeout(()=>{console.log("\uD83C\uDF5E Mostrando toast dopo chiusura modal..."),console.log("\uD83D\uDCDD Toast data:",{title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});let e=n({title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});console.log("\uD83C\uDFAF Toast result:",e),console.log("✅ Toast chiamato con successo - dovrebbe apparire ora!")},100)}catch(e){console.error("❌ Error responding to request:",e),console.log("\uD83D\uDEA8 Mostrando toast di errore..."),n({title:"Errore",description:"Errore durante la risposta alla richiesta"}),setTimeout(()=>{console.log("\uD83D\uDD12 Chiudendo modal dopo errore..."),t()},1e3)}finally{c(!1)}}};return s&&a?(0,x.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,x.jsxs)(f.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,x.jsxs)(f.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(f.ll,{className:"text-xl",children:"Rispondi alla Richiesta di Servizio"}),(0,x.jsx)(f.SZ,{children:(null===(r=a.merchant.esercenti)||void 0===r?void 0:r.business_name)||a.merchant.full_name})]}),(0,x.jsx)(g.z,{variant:"ghost",size:"sm",onClick:t,children:(0,x.jsx)(T.Z,{className:"h-4 w-4"})})]}),(0,x.jsxs)(f.aY,{children:[(0,x.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 space-y-3",children:[(0,x.jsx)("h4",{className:"font-medium text-gray-900",children:"Dettagli della Richiesta"}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(y.Z,{className:"h-4 w-4 text-gray-500"}),(0,x.jsx)("span",{children:new Date(a.requested_date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(C.Z,{className:"h-4 w-4 text-gray-500"}),(0,x.jsxs)("span",{children:[a.start_time.substring(0,5)," - ",a.duration_hours,"h di servizio"]})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(V.Z,{className:"h-4 w-4 text-gray-500"}),(0,x.jsx)("span",{className:"truncate",title:a.merchant_address,children:a.merchant_address})]}),(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(E.Z,{className:"h-4 w-4 text-gray-500"}),(0,x.jsxs)("span",{children:["€",(a.duration_hours*(i||15)).toFixed(2)," ","(stimato)"]})]})]}),a.description&&(0,x.jsx)("div",{className:"mt-3 p-3 bg-white rounded border-l-4 border-blue-500",children:(0,x.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,x.jsx)(K.Z,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,x.jsxs)("div",{children:[(0,x.jsx)("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Istruzioni del merchant:"}),(0,x.jsx)("p",{className:"text-sm text-blue-700",children:a.description})]})]})})]}),(0,x.jsxs)("form",{onSubmit:j,className:"space-y-6",children:[(0,x.jsxs)("div",{children:[(0,x.jsx)(Z._,{className:"text-base font-medium",children:"La tua risposta *"}),(0,x.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[(0,x.jsxs)(g.z,{type:"button",variant:"accepted"===d?"default":"outline",className:"h-16 flex-col space-y-2 ".concat("accepted"===d?"bg-green-600 hover:bg-green-700":"hover:bg-green-50 hover:border-green-300"),onClick:()=>u("accepted"),children:[(0,x.jsx)(v.Z,{className:"h-6 w-6"}),(0,x.jsx)("span",{children:"Accetta"})]}),(0,x.jsxs)(g.z,{type:"button",variant:"rejected"===d?"default":"outline",className:"h-16 flex-col space-y-2 ".concat("rejected"===d?"bg-red-600 hover:bg-red-700":"hover:bg-red-50 hover:border-red-300"),onClick:()=>u("rejected"),children:[(0,x.jsx)(T.Z,{className:"h-6 w-6"}),(0,x.jsx)("span",{children:"Rifiuta"})]})]})]}),(0,x.jsxs)("div",{children:[(0,x.jsxs)(Z._,{htmlFor:"response_message",children:["Messaggio opzionale","rejected"===d&&(0,x.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,x.jsx)(ei,{id:"response_message",value:m,onChange:e=>p(e.target.value),placeholder:"accepted"===d?"Aggiungi eventuali note o conferme...":"Spiega il motivo del rifiuto...",className:"mt-1",rows:3,required:"rejected"===d}),(0,x.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"rejected"===d?"Campo obbligatorio per i rifiuti":"Campo opzionale per aggiungere dettagli"})]}),(0,x.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,x.jsx)(g.z,{type:"button",variant:"outline",onClick:t,className:"flex-1",disabled:o,children:"Annulla"}),(0,x.jsx)(g.z,{type:"submit",className:"flex-1 ".concat("accepted"===d?"bg-green-600 hover:bg-green-700":"rejected"===d?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"),disabled:o||!d||"rejected"===d&&!m.trim(),children:o?(0,x.jsxs)(x.Fragment,{children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Invio..."]}):"accepted"===d?"Accetta Richiesta":"rejected"===d?"Rifiuta Richiesta":"Seleziona risposta"})]})]})]})]})}):null}var eo=s(8205);function ec(){var e,r,s,t,a,i;let[l,n]=(0,h.useState)(null),[o,c]=(0,h.useState)(!1),[d,u]=(0,h.useState)(!1),[m,j]=(0,h.useState)(!1),[k,Z]=(0,h.useState)(!1),[T,L]=(0,h.useState)(!0),[M,F]=(0,h.useState)(null),[U,G]=(0,h.useState)(null),[q,V]=(0,h.useState)(!1),[H,K]=(0,h.useState)(!1),[X,J]=(0,h.useState)(!1),[W,Q]=(0,h.useState)([]),[$,ee]=(0,h.useState)(!1),[er,es]=(0,h.useState)(null),ea=(0,p.useRouter)(),ei=(0,p.useSearchParams)(),el=(0,h.useCallback)(async()=>{try{let{data:{user:r},error:s}=await R.O.auth.getUser();if(s||!r){console.error("\uD83D\uDEAB No authenticated user, redirecting to login"),ea.push("/auth/login");return}console.log("\uD83D\uDD0D Fetching profile for user:",r.id,"Email:",r.email),console.log("\uD83D\uDC64 User metadata:",r.user_metadata);let{data:t,error:a}=await R.O.from("profiles").select("\n          id,\n          full_name,\n          avatar_url,\n          role,\n          riders_details (\n            vehicle_type,\n            profile_picture_url,\n            bio,\n            hourly_rate,\n            stripe_account_id,\n            stripe_onboarding_complete\n          ),\n          rider_tax_details (\n            first_name,\n            last_name,\n            fiscal_code,\n            birth_place,\n            birth_date,\n            residence_address,\n            residence_city\n          )\n        ").eq("id",r.id).single();if(a){if("PGRST116"===a.code){var e;if(console.log("\uD83D\uDCDD No profile found, checking user metadata..."),(null===(e=r.user_metadata)||void 0===e?void 0:e.role)==="rider"){console.log("\uD83D\uDCDD Creating rider profile for user:",r.id);let{error:e}=await R.O.from("profiles").insert({id:r.id,full_name:r.user_metadata.full_name||"New Rider",role:"rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(e){console.error("❌ Error creating rider profile:",e),F("Errore nella creazione del profilo rider");return}let{error:s}=await R.O.from("riders_details").insert({profile_id:r.id,hourly_rate:15,bio:"New Rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(s){console.error("❌ Error creating rider details:",s),F("Errore nella creazione dei dettagli del rider");return}console.log("✅ Rider profile created successfully"),window.location.reload();return}console.log("\uD83D\uDEAB User metadata does not indicate rider role or missing role, redirecting to registration"),ea.push("/auth/register");return}console.error("❌ Error fetching profile:",a),F("Errore nel caricamento del profilo");return}if(t){if(console.log("\uD83D\uDCCB Profile found:",t),"rider"!==t.role){console.log("\uD83D\uDEAB ACCESSO NEGATO: User role is:",t.role,"- redirecting to appropriate dashboard"),"merchant"===t.role?(console.log("➡️ Redirecting to merchant dashboard"),ea.push("/dashboard/merchant")):(console.log("➡️ Unknown role, redirecting to login"),ea.push("/auth/login"));return}console.log("✅ ACCESSO AUTORIZZATO: Rider profile loaded successfully");let e=Array.isArray(t.riders_details)?t.riders_details[0]:t.riders_details;n({id:t.id,full_name:t.full_name,avatar_url:t.avatar_url,riders_details:e||null,rider_tax_details:Array.isArray(t.rider_tax_details)?t.rider_tax_details[0]||null:t.rider_tax_details||null}),em()}}catch(e){console.error("Error fetching profile:",e),F("Errore nel caricamento del profilo")}finally{L(!1)}},[ea]),ec=async()=>{var e,r,s;if(!(null==l?void 0:null===(e=l.riders_details)||void 0===e?void 0:e.stripe_account_id))return!1;V(!0);try{let e=await fetch("/api/stripe/onboarding",{method:"GET",credentials:"include"});if(e.ok){let r=await e.json();return console.log("\uD83D\uDD04 Onboarding status check result:",r),r.stripe_onboarding_complete!==(null===(s=l.riders_details)||void 0===s?void 0:s.stripe_onboarding_complete)&&(console.log("✅ Onboarding status changed, updating profile..."),await el()),r.stripe_onboarding_complete}}catch(e){console.error("Error checking onboarding status:",e)}finally{V(!1)}return(null===(r=l.riders_details)||void 0===r?void 0:r.stripe_onboarding_complete)||!1};(0,h.useEffect)(()=>{"true"===ei.get("onboarding_complete")&&(console.log("✅ Onboarding Stripe completato con successo!"),window.history.replaceState({},"","/dashboard/rider")),el()},[ei,el]);let ed=async()=>{L(!0),F(null);try{let e=await fetch("/api/stripe/onboarding",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok){let r=await e.json();throw Error(r.error||"Failed to start onboarding")}let r=await e.json();if(r.url)window.location.href=r.url;else throw Error("No URL returned from Stripe")}catch(e){console.error("Error starting Stripe onboarding:",e),F(e.message||"Si \xe8 verificato un errore durante l'attivazione dei pagamenti")}finally{L(!1)}},eu=async()=>{var e;let{data:{user:r}}=await R.O.auth.getUser();if(!r){F("Devi effettuare il login per utilizzare questa funzionalit\xe0");return}if(!(null==l?void 0:null===(e=l.riders_details)||void 0===e?void 0:e.stripe_account_id)){F("ID dell'account Stripe non trovato.");return}L(!0),F(null);try{let e=await fetch("/api/stripe/create-login-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:l.riders_details.stripe_account_id})}),{url:r,error:s}=await e.json();if(s)throw Error(s);r&&window.open(r,"_blank")}catch(e){console.error("Error creating Stripe login link:",e),F(e.message||"Failed to open Stripe Dashboard.")}finally{L(!1)}},em=(0,h.useCallback)(async()=>{if(!l){console.log("\uD83D\uDEAB No profile available, skipping fetchServiceRequests");return}try{console.log("\uD83D\uDD0D Fetching service requests for rider ID:",l.id);let{data:e,error:r}=await R.O.from("service_requests").select("\n          id,\n          requested_date,\n          start_time,\n          duration_hours,\n          merchant_address,\n          description,\n          status,\n          rider_response,\n          created_at,\n          updated_at,\n          merchant:profiles!merchant_id (\n            id,\n            full_name,\n            esercenti (\n              business_name,\n              address,\n              city\n            )\n          )\n        ").eq("rider_id",l.id).order("created_at",{ascending:!1});if(r)throw console.error("❌ Error fetching service requests:",r),r;console.log("\uD83D\uDCCA Raw data from DB:",e);let s=(e||[]).map(e=>{let r=Array.isArray(e.merchant)?e.merchant[0]:e.merchant;return{...e,merchant:{...r,esercenti:Array.isArray(null==r?void 0:r.esercenti)?r.esercenti[0]:null==r?void 0:r.esercenti}}}).filter(e=>e.merchant);console.log("\uD83D\uDD04 Transformed requests:",s),console.log("✅ Service requests fetched successfully:",s.length,"requests"),Q(s)}catch(e){console.error("❌ Error fetching service requests:",e),F("Errore nel caricamento delle richieste di servizio")}},[l]);(0,h.useEffect)(()=>{l&&(console.log("\uD83D\uDC64 Profile available, fetching service requests..."),em())},[l,em]);let ex=async(e,r,s)=>{try{console.log("\uD83D\uDCE4 Responding to service request:",e,r);let t=await fetch("/api/service-requests/"+e+"/respond",{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:r,riderResponse:s,userId:null==l?void 0:l.id})});if(!t.ok)throw Error("HTTP error! status: ".concat(t.status));let a=await t.json();if(!a.success)throw Error(a.error||"Failed to respond to request");console.log("✅ Response sent successfully"),em()}catch(e){throw console.error("❌ Error responding to request:",e),e}},eh=e=>{es(e),ee(!0)},ep=async()=>{try{K(!0),console.log("\uD83D\uDEAA Logging out rider..."),await R.O.auth.signOut(),console.log("✅ Logout successful, redirecting to home"),ea.push("/")}catch(e){console.error("❌ Error during logout:",e),F("Errore durante il logout"),K(!1)}};if(T&&!l)return(0,x.jsx)(eo.Iq,{});if(M)return(0,x.jsxs)("div",{children:["Error: ",M]});if(!l)return(0,x.jsx)("div",{children:"Could not load profile."});let eg=l.riders_details;return(0,x.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,x.jsx)(z.Z,{userRole:"rider",userName:(null==l?void 0:l.full_name)||"Rider",onLogout:ep,onDeleteAccount:()=>J(!0)}),(0,x.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,x.jsxs)("div",{className:"mb-8",children:[(0,x.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Benvenuto, ",l.full_name,"! \uD83D\uDEB4‍♂️"]}),(0,x.jsx)("p",{className:"text-gray-600",children:"Gestisci il tuo profilo, disponibilit\xe0 e ricevi pagamenti"})]}),M&&(0,x.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:M}),(0,x.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4 sm:gap-6",children:[(0,x.jsx)(f.Zb,{className:"relative overflow-hidden",children:(0,x.jsxs)(f.aY,{className:"relative px-6 pt-6 pb-6",children:[(0,x.jsx)("div",{className:"flex justify-center mb-4",children:(null==eg?void 0:eg.profile_picture_url)?(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)(I.default,{src:eg.profile_picture_url,alt:"Foto profilo",width:128,height:128,className:"w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl",onError:e=>{e.currentTarget.style.display="none"}}),(0,x.jsx)("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:(0,x.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]}):(0,x.jsxs)("div",{className:"relative",children:[(0,x.jsx)("div",{className:"w-32 h-32 rounded-full flex items-center justify-center shadow-xl border-4 border-white",style:{background:"linear-gradient(to bottom right, #333366, #4a4a7a)"},children:(0,x.jsx)("span",{className:"text-3xl font-bold text-white",children:l.full_name?l.full_name.charAt(0).toUpperCase():(null===(r=l.rider_tax_details)||void 0===r?void 0:null===(e=r.first_name)||void 0===e?void 0:e.charAt(0).toUpperCase())||"R"})}),(0,x.jsx)("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:(0,x.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]})}),(0,x.jsxs)("div",{className:"text-center mb-4",children:[(0,x.jsx)("h2",{className:"text-2xl font-bold text-gray-900 mb-1",children:(null===(s=l.rider_tax_details)||void 0===s?void 0:s.first_name)&&(null===(t=l.rider_tax_details)||void 0===t?void 0:t.last_name)?"".concat(l.rider_tax_details.first_name," ").concat(l.rider_tax_details.last_name):l.full_name||"Nome non impostato"}),(0,x.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-2",children:[[1,2,3,4,5].map(e=>(0,x.jsx)("svg",{className:"w-4 h-4 text-yellow-400 fill-current",viewBox:"0 0 20 20",children:(0,x.jsx)("path",{d:"M10 1l2.5 6.5h6.5l-5.25 4 2 6.5-5.75-4.25-5.75 4.25 2-6.5-5.25-4h6.5z"})},e)),(0,x.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"5.0 • Nuovo rider"})]}),(0,x.jsxs)("div",{className:"flex items-center justify-center gap-2 mb-3",children:[(null==eg?void 0:eg.vehicle_type)==="bici"&&(0,x.jsx)("span",{children:"\uD83D\uDEB2"}),(null==eg?void 0:eg.vehicle_type)==="e_bike"&&(0,x.jsx)("span",{children:"\uD83D\uDEB4‍♂️"}),(null==eg?void 0:eg.vehicle_type)==="scooter"&&(0,x.jsx)("span",{children:"\uD83D\uDEF5"}),(null==eg?void 0:eg.vehicle_type)==="auto"&&(0,x.jsx)("span",{children:"\uD83D\uDE97"}),(0,x.jsx)("span",{className:"text-sm font-medium text-gray-700 capitalize",children:(null==eg?void 0:eg.vehicle_type)==="bici"?"Bicicletta":(null==eg?void 0:eg.vehicle_type)==="e_bike"?"E-Bike":(null==eg?void 0:eg.vehicle_type)==="scooter"?"Scooter":(null==eg?void 0:eg.vehicle_type)==="auto"?"Auto":"Veicolo non specificato"})]})]}),(null==eg?void 0:eg.bio)&&(0,x.jsx)("div",{className:"mb-4",children:(0,x.jsxs)("p",{className:"text-gray-700 text-center italic",children:["“",eg.bio,"”"]})}),(0,x.jsxs)("div",{className:"grid grid-cols-2 sm:grid-cols-2 gap-3 sm:gap-4 mb-4",children:[(0,x.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,x.jsxs)("div",{className:"text-lg font-bold text-gray-900",children:["€",(null==eg?void 0:eg.hourly_rate)||0]}),(0,x.jsx)("div",{className:"text-xs text-gray-600",children:"per ora"})]}),(0,x.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,x.jsx)("div",{className:"text-lg font-bold text-green-600",children:"Disponibile"}),(0,x.jsx)("div",{className:"text-xs text-gray-600",children:"Aggiornato ieri"})]})]}),(0,x.jsxs)("div",{className:"flex flex-wrap gap-2 mb-4 justify-center",children:[(0,x.jsx)("span",{className:"px-2 py-1 text-xs rounded-full",style:{backgroundColor:"rgba(51, 51, 102, 0.1)",color:"#333366"},children:"⚡ Consegne veloci"}),(0,x.jsx)("span",{className:"px-2 py-1 bg-green-100 text-green-800 text-xs rounded-full",children:"✓ Verificato"}),(0,x.jsx)("span",{className:"px-2 py-1 bg-purple-100 text-purple-800 text-xs rounded-full",children:"\uD83C\uDFC6 Rider professionale"})]}),(0,x.jsx)(g.z,{className:"w-full text-white font-medium",style:{backgroundColor:"#333366"},onMouseEnter:e=>e.currentTarget.style.backgroundColor="#4a4a7a",onMouseLeave:e=>e.currentTarget.style.backgroundColor="#333366",onClick:()=>Z(!0),children:"Modifica Profilo"})]})}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsx)(f.Ol,{children:(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(b,{className:"h-5 w-5"})," Pagamenti"]})}),(0,x.jsx)(f.aY,{children:(null==eg?void 0:eg.stripe_onboarding_complete)?(0,x.jsxs)("div",{className:"text-center text-green-600",children:[(0,x.jsx)(v.Z,{className:"h-8 w-8 mx-auto mb-2"}),(0,x.jsx)("p",{children:"Onboarding Stripe Completato"}),(0,x.jsx)(g.z,{variant:"outline",className:"mt-4 w-full",onClick:eu,disabled:T,children:T?"Caricamento...":"Gestisci Pagamenti"})]}):(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsxs)("p",{className:"text-yellow-600 mb-2",children:[(0,x.jsx)(N.Z,{className:"inline h-5 w-5 mr-1"}),"Account Stripe Richiesto"]}),(0,x.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Completa l'onboarding Stripe per ricevere pagamenti"}),(0,x.jsx)(g.z,{onClick:ed,disabled:T,className:"w-full bg-green-600 hover:bg-green-700",children:T?"Caricamento...":"Attiva Pagamenti"}),(null==eg?void 0:eg.stripe_account_id)&&(0,x.jsx)("div",{className:"mt-2",children:(0,x.jsx)(g.z,{variant:"outline",size:"sm",onClick:ec,disabled:q,children:q?"Verificando...":"Verifica Stato"})})]})})]}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsx)(f.Ol,{children:(0,x.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,x.jsx)(y.Z,{className:"h-5 w-5 text-purple-600"}),(0,x.jsx)(f.ll,{children:"Disponibilit\xe0"})]})}),(0,x.jsxs)(f.aY,{className:"text-center",children:[(0,x.jsx)(g.z,{variant:"outline",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),onClick:()=>c(!0),children:"Gestisci Calendario"}),!(null==eg?void 0:eg.stripe_onboarding_complete)&&(0,x.jsx)("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsx)(f.Ol,{children:(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(_.Z,{className:"h-5 w-5"})," Prenotazioni"]})}),(0,x.jsxs)(f.aY,{className:"text-center",children:[(0,x.jsx)("p",{className:"text-3xl font-bold",children:"0"}),(0,x.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Prenotazioni Attive"}),(0,x.jsx)(g.z,{variant:"outline",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),children:"Visualizza Tutte"}),!(null==eg?void 0:eg.stripe_onboarding_complete)&&(0,x.jsx)("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsx)(f.Ol,{children:(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(w,{className:"h-5 w-5"})," Guadagni"]})}),(0,x.jsxs)(f.aY,{className:"text-center",children:[(0,x.jsx)("p",{className:"text-3xl font-bold",children:"€0"}),(0,x.jsx)("p",{className:"text-sm text-gray-500 mb-4",children:"Questo mese"}),(0,x.jsx)(g.z,{variant:"outline",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),children:"Visualizza Storico"}),!(null==eg?void 0:eg.stripe_onboarding_complete)&&(0,x.jsx)("p",{className:"text-xs text-orange-500 mt-2",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsx)(f.Ol,{children:(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(D.Z,{className:"h-5 w-5"})," Azioni Rapide"]})}),(0,x.jsxs)(f.aY,{className:"space-y-2",children:[(0,x.jsxs)(g.z,{variant:"outline",className:"w-full justify-start",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),onClick:()=>u(!0),children:[(0,x.jsx)(E.Z,{className:"mr-2 h-4 w-4"})," Aggiorna Tariffa"]}),(0,x.jsxs)(g.z,{variant:"outline",className:"w-full justify-start",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),onClick:()=>j(!0),children:[(0,x.jsx)(A.Z,{className:"mr-2 h-4 w-4"})," Dati Fiscali"]}),(0,x.jsxs)(g.z,{variant:"outline",className:"w-full justify-start",disabled:!(null==eg?void 0:eg.stripe_onboarding_complete),children:[(0,x.jsx)(C.Z,{className:"mr-2 h-4 w-4"})," Cronologia"]}),!(null==eg?void 0:eg.stripe_onboarding_complete)&&(0,x.jsx)("p",{className:"text-xs text-orange-500 mt-2 text-center",children:"Completa l'onboarding Stripe per abilitare questa funzione"})]})]}),(0,x.jsxs)(f.Zb,{children:[(0,x.jsxs)(f.Ol,{children:[(0,x.jsxs)(f.ll,{className:"flex items-center gap-2",children:[(0,x.jsx)(S,{className:"h-5 w-5"})," Richieste di Servizio"]}),(0,x.jsx)(f.SZ,{children:"Gestisci le richieste di servizio ricevute"})]}),(0,x.jsx)(f.aY,{children:0===W.length?(0,x.jsxs)("div",{className:"text-center py-8",children:[(0,x.jsx)(S,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,x.jsx)("p",{className:"text-gray-500 mb-2",children:"Nessuna richiesta ricevuta"}),(0,x.jsx)("p",{className:"text-sm text-gray-400",children:"Le nuove richieste appariranno qui"})]}):(0,x.jsxs)("div",{className:"space-y-3",children:[(0,x.jsxs)("div",{className:"grid grid-cols-3 gap-1 sm:gap-2 mb-4",children:[(0,x.jsxs)("div",{className:"text-center p-2 bg-yellow-50 rounded-lg",children:[(0,x.jsx)("p",{className:"text-lg font-bold text-yellow-600",children:W.filter(e=>"pending"===e.status).length}),(0,x.jsx)("p",{className:"text-xs text-yellow-700",children:"In Attesa"})]}),(0,x.jsxs)("div",{className:"text-center p-2 bg-green-50 rounded-lg",children:[(0,x.jsx)("p",{className:"text-lg font-bold text-green-600",children:W.filter(e=>"accepted"===e.status).length}),(0,x.jsx)("p",{className:"text-xs text-green-700",children:"Accettate"})]}),(0,x.jsxs)("div",{className:"text-center p-2 bg-red-50 rounded-lg",children:[(0,x.jsx)("p",{className:"text-lg font-bold text-red-600",children:W.filter(e=>"rejected"===e.status).length}),(0,x.jsx)("p",{className:"text-xs text-red-700",children:"Rifiutate"})]})]}),(0,x.jsx)("div",{className:"space-y-2 max-h-60 overflow-y-auto",children:W.slice(0,3).map(e=>{var r;return(0,x.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between p-3 bg-gray-50 rounded-lg gap-2 sm:gap-0",children:[(0,x.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,x.jsx)("p",{className:"font-medium text-sm truncate",children:(null===(r=e.merchant.esercenti)||void 0===r?void 0:r.business_name)||e.merchant.full_name}),(0,x.jsxs)("p",{className:"text-xs text-gray-500",children:[new Date(e.requested_date).toLocaleDateString("it-IT")," ","• ",e.start_time.substring(0,5)," •",e.duration_hours,"h"]})]}),(0,x.jsx)("div",{className:"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-2",children:"pending"===e.status?(0,x.jsx)(g.z,{size:"sm",onClick:()=>eh(e),className:"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto",children:"Rispondi"}):(0,x.jsx)("span",{className:"px-2 py-1 text-xs rounded-full whitespace-nowrap ".concat("accepted"===e.status?"bg-green-100 text-green-800":"bg-red-100 text-red-800"),children:"accepted"===e.status?"Accettata":"Rifiutata"})})]},e.id)})}),W.length>3&&(0,x.jsxs)(g.z,{variant:"outline",className:"w-full min-h-[44px] touch-manipulation",size:"lg",children:["Visualizza Tutte (",W.length,")"]})]})})]})]})]}),(0,x.jsx)(O.Z,{isOpen:X,onClose:()=>J(!1),userRole:"rider"}),o&&l&&(0,x.jsx)(P,{riderId:l.id,onClose:()=>c(!1)}),d&&l&&(0,x.jsx)(B,{riderId:l.id,currentRate:(null===(a=l.riders_details)||void 0===a?void 0:a.hourly_rate)||null,onClose:()=>u(!1)}),m&&l&&(0,x.jsx)(Y,{isOpen:m,riderId:l.id,onClose:()=>j(!1)}),k&&l&&(0,x.jsx)(et,{isOpen:k,onClose:()=>Z(!1),riderId:l.id,onProfileUpdate:el}),(0,x.jsx)(en,{isOpen:$,onClose:()=>{ee(!1),es(null)},request:er,riderHourlyRate:(null==l?void 0:null===(i=l.riders_details)||void 0===i?void 0:i.hourly_rate)||null,onRespond:ex})]})}function ed(){return(0,x.jsx)(h.Suspense,{fallback:(0,x.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,x.jsxs)("div",{className:"text-center",children:[(0,x.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 mx-auto",style:{borderBottomColor:"#333366"}}),(0,x.jsx)("p",{className:"mt-4 text-gray-600",children:"Caricamento dashboard..."})]})}),children:(0,x.jsx)(ec,{})})}},8685:function(e,r,s){"use strict";s.d(r,{P0:function(){return a},Pz:function(){return i},RZ:function(){return l},SI:function(){return t}});let t={MAX_RIDER_HOURLY_RATE:12.5,MAX_BOOKING_HOURS:2,MIN_RIDER_HOURLY_RATE:5,MIN_BOOKING_HOURS:1},a=e=>e>=t.MIN_RIDER_HOURLY_RATE&&e<=t.MAX_RIDER_HOURLY_RATE,i=e=>e>=t.MIN_BOOKING_HOURS&&e<=t.MAX_BOOKING_HOURS,l={INVALID_RIDER_RATE:"La tariffa oraria deve essere compresa tra €".concat(t.MIN_RIDER_HOURLY_RATE," e €").concat(t.MAX_RIDER_HOURLY_RATE),INVALID_BOOKING_HOURS:"Le ore di prenotazione devono essere comprese tra ".concat(t.MIN_BOOKING_HOURS," e ").concat(t.MAX_BOOKING_HOURS)}},421:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});let t=(0,s(9763).Z)("Bike",[["circle",{cx:"18.5",cy:"17.5",r:"3.5",key:"15x4ox"}],["circle",{cx:"5.5",cy:"17.5",r:"3.5",key:"1noe27"}],["circle",{cx:"15",cy:"5",r:"1",key:"19l28e"}],["path",{d:"M12 17.5V14l-3-3 4-3 2 3h2",key:"1npguv"}]])},3417:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});let t=(0,s(9763).Z)("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]])},1239:function(e,r,s){"use strict";s.d(r,{Z:function(){return t}});let t=(0,s(9763).Z)("Zap",[["polygon",{points:"13 2 3 14 12 14 11 22 21 10 12 10 13 2",key:"45s27k"}]])}},function(e){e.O(0,[214,569,818,290,996,971,117,744],function(){return e(e.s=6022)}),_N_E=e.O()}]);