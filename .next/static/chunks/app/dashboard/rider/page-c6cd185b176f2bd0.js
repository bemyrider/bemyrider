(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[613],{6022:function(e,s,t){Promise.resolve().then(t.bind(t,4784))},4784:function(e,s,t){"use strict";t.r(s),t.d(s,{default:function(){return eI}});var a,r,i,l,o,n,c,d,m,x,u,h,p=t(7437),g=t(2265),f=t(9376),j=t(2141),v=t(9651),b=t(2321),N=t(2869),y=t(4508),w=t(2489);function _(e){let{items:s,onItemClick:t,className:a,isMobile:r=!1,isOpen:i=!0,onToggle:l}=e,[o,n]=(0,g.useState)(""),c=e=>{n(e),t(e),r&&l&&l()},d=(0,p.jsxs)("div",{className:(0,y.cn)("flex flex-col h-full",a),children:[r&&(0,p.jsxs)("div",{className:"flex items-center justify-between p-4 border-b",children:[(0,p.jsx)("h2",{className:"text-lg font-semibold",children:"Menu"}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:l,className:"p-2",children:(0,p.jsx)(w.Z,{className:"h-5 w-5"})})]}),(0,p.jsx)("nav",{className:"flex-1 p-4",children:(0,p.jsx)("ul",{className:"space-y-2",children:s.map(e=>(0,p.jsx)("li",{children:(0,p.jsxs)(N.z,{variant:o===e.id?"default":"ghost",className:(0,y.cn)("w-full justify-start text-left",o===e.id?"bg-[#333366] hover:bg-[#333366]/90 text-white":"hover:bg-gray-100 text-gray-700 hover:text-gray-900"),onClick:()=>c(e.id),children:[(0,p.jsx)("span",{className:"mr-3",children:e.icon&&"function"==typeof e.icon?g.createElement(e.icon,{className:"h-5 w-5"}):e.icon}),(0,p.jsx)("span",{className:"truncate",children:e.label})]})},e.id))})}),(0,p.jsx)("div",{className:"p-4 border-t",children:(0,p.jsx)("div",{className:"text-xs text-gray-500 text-center",children:"Dashboard Rider"})})]});return r?(0,p.jsx)("div",{className:(0,y.cn)("fixed inset-0 z-50 bg-black/50 transition-opacity lg:hidden",i?"opacity-100":"opacity-0 pointer-events-none"),onClick:l,children:(0,p.jsx)("div",{className:(0,y.cn)("fixed left-0 top-0 h-full w-64 bg-white shadow-lg transform transition-transform",i?"translate-x-0":"-translate-x-full"),onClick:e=>e.stopPropagation(),children:d})}):(0,p.jsx)("div",{className:"hidden lg:block fixed left-0 top-16 h-[calc(100vh-4rem)] w-64 bg-white border-r border-gray-200 shadow-sm z-30",children:d})}var D=t(6070),E=t(5186),A=t(6815),S=t(1047),C=t(5302),z=t(9397),I=t(1723),R=t(3229);let Z=[{key:"Lun",label:"Luned\xec",short:"Lun"},{key:"Mar",label:"Marted\xec",short:"Mar"},{key:"Mer",label:"Mercoled\xec",short:"Mer"},{key:"Gio",label:"Gioved\xec",short:"Gio"},{key:"Ven",label:"Venerd\xec",short:"Ven"},{key:"Sab",label:"Sabato",short:"Sab"},{key:"Dom",label:"Domenica",short:"Dom"}];function O(e){let{riderId:s,onClose:t}=e,[a,r]=(0,g.useState)(Z.map(e=>({day:e.key,isAvailable:!1,timeSlots:[]}))),[i,l]=(0,g.useState)(!1),[o,n]=(0,g.useState)(!1),[c,d]=(0,g.useState)(null);(0,g.useEffect)(()=>{m()},[s]);let m=async()=>{try{l(!0);let{data:e,error:t}=await j.O.from("disponibilita_riders").select("*").eq("rider_id",s);if(t){console.error("Error fetching availability:",t);return}let a=new Map;null==e||e.forEach(e=>{a.set(e.day_of_week,{start_time:e.start_time,end_time:e.end_time})}),r(e=>e.map(e=>{let s=a.get(e.day);return{...e,isAvailable:!!s,timeSlots:s?[s]:[]}}))}catch(e){console.error("Error:",e)}finally{l(!1)}},x=e=>{r(s=>s.map(s=>s.day===e?{...s,isAvailable:!s.isAvailable,timeSlots:s.isAvailable?[]:[{start_time:"09:00",end_time:"17:00"}]}:s))},u=e=>{r(s=>s.map(s=>s.day===e?{...s,timeSlots:[...s.timeSlots,{start_time:"09:00",end_time:"17:00"}]}:s))},h=(e,s)=>{r(t=>t.map(t=>t.day===e?{...t,timeSlots:t.timeSlots.filter((e,t)=>t!==s)}:t))},f=(e,s,t,a)=>{r(r=>r.map(r=>r.day===e?{...r,timeSlots:r.timeSlots.map((e,r)=>r===s?{...e,[t]:a}:e)}:r))},v=async()=>{try{n(!0),d(null),await j.O.from("disponibilita_riders").delete().eq("rider_id",s);let e=[];for(let t of a)if(t.isAvailable)for(let a of t.timeSlots)e.push({rider_id:s,day_of_week:t.day,start_time:a.start_time,end_time:a.end_time});if(e.length>0){let{error:s}=await j.O.from("disponibilita_riders").insert(e);if(s)throw s}d({type:"success",text:"Disponibilit\xe0 salvata con successo!"}),setTimeout(()=>{t()},1500)}catch(e){console.error("Error saving availability:",e),d({type:"error",text:e.message||"Errore nel salvataggio"})}finally{n(!1)}};return i?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50",children:(0,p.jsx)(D.Zb,{className:"w-full max-w-md",children:(0,p.jsxs)(D.aY,{className:"p-6 text-center",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto mb-4"}),(0,p.jsx)("p",{children:"Caricamento disponibilit\xe0..."})]})})}):(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,p.jsxs)(D.Zb,{className:"w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(S.Z,{className:"h-5 w-5 text-purple-600"}),(0,p.jsx)(D.ll,{children:"Gestisci Disponibilit\xe0"})]}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:t,children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,p.jsx)(D.SZ,{children:"Imposta i tuoi orari di disponibilit\xe0 per ogni giorno della settimana"})]}),(0,p.jsxs)(D.aY,{className:"space-y-6",children:[c&&(0,p.jsxs)("div",{className:"p-3 rounded-lg flex items-center space-x-2 ".concat("success"===c.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===c.type&&(0,p.jsx)(C.Z,{className:"h-4 w-4"}),(0,p.jsx)("span",{children:c.text})]}),(0,p.jsx)("div",{className:"space-y-4",children:Z.map(e=>{let{key:s,label:t,short:r}=e,i=a.find(e=>e.day===s);return(0,p.jsx)(D.Zb,{className:"border-l-4 border-purple-500",children:(0,p.jsxs)(D.aY,{className:"p-4",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-3",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-3",children:[(0,p.jsx)(N.z,{variant:i.isAvailable?"default":"outline",size:"sm",onClick:()=>x(s),className:"w-16",children:r}),(0,p.jsx)("span",{className:"font-medium",children:t})]}),i.isAvailable&&(0,p.jsxs)(N.z,{variant:"outline",size:"sm",onClick:()=>u(s),children:[(0,p.jsx)(z.Z,{className:"h-4 w-4 mr-1"}),"Aggiungi Fascia"]})]}),i.isAvailable&&(0,p.jsxs)("div",{className:"space-y-2",children:[i.timeSlots.map((e,t)=>(0,p.jsxs)("div",{className:"flex items-center space-x-2 bg-gray-50 p-2 rounded",children:[(0,p.jsx)(I.Z,{className:"h-4 w-4 text-gray-500"}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(A._,{htmlFor:"start-".concat(s,"-").concat(t),className:"text-sm",children:"Da:"}),(0,p.jsx)(E.I,{id:"start-".concat(s,"-").concat(t),type:"time",value:e.start_time,onChange:e=>f(s,t,"start_time",e.target.value),className:"w-32"})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(A._,{htmlFor:"end-".concat(s,"-").concat(t),className:"text-sm",children:"A:"}),(0,p.jsx)(E.I,{id:"end-".concat(s,"-").concat(t),type:"time",value:e.end_time,onChange:e=>f(s,t,"end_time",e.target.value),className:"w-32"})]}),i.timeSlots.length>1&&(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:()=>h(s,t),className:"text-red-500 hover:text-red-700",children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]},t)),0===i.timeSlots.length&&(0,p.jsx)("p",{className:"text-sm text-gray-500 italic",children:"Nessuna fascia oraria impostata"})]})]})},s)})}),(0,p.jsxs)("div",{className:"flex justify-end space-x-3 pt-4 border-t",children:[(0,p.jsx)(N.z,{variant:"outline",onClick:t,disabled:o,children:"Annulla"}),(0,p.jsx)(N.z,{onClick:v,disabled:o,children:o?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Salvando..."]}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(R.Z,{className:"h-4 w-4 mr-2"}),"Salva Disponibilit\xe0"]})})]})]})]})})}var P=t(1477),k=t(2252),L=t(8685);function F(e){let{riderId:s,currentRate:t,onClose:a}=e,[r,i]=(0,g.useState)(t?t.toString():""),[l,o]=(0,g.useState)(!1),[n,c]=(0,g.useState)(null),d=async e=>{e.preventDefault(),o(!0),c(null);try{e.target.checkValidity()||e.stopPropagation();let t=parseFloat(r.replace(",","."));if(isNaN(t)||t<=0)throw Error("⚠️ Inserisci una tariffa valida maggiore di €0,01");if(!(0,L.P0)(t))throw Error(L.RZ.INVALID_RIDER_RATE);console.log("\uD83D\uDD04 Updating rider rate...",{riderId:s,rate:t});let{error:i}=await j.O.from("riders_details").update({hourly_rate:t,updated_at:new Date().toISOString()}).eq("profile_id",s);if(i)throw console.error("❌ Error updating rate:",i),i;console.log("✅ Rate updated successfully"),c({type:"success",text:"✅ Tariffa aggiornata con successo a €".concat(t.toFixed(2),"/ora")}),setTimeout(()=>{a(),window.location.reload()},1500)}catch(e){console.error("❌ Error:",e),c({type:"error",text:e.message||"Errore durante l'aggiornamento"})}finally{o(!1)}};return(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,p.jsxs)(D.Zb,{className:"w-full max-w-md bg-white",children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(P.Z,{className:"h-5 w-5"}),"Aggiorna Tariffa"]}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:a,disabled:l,children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,p.jsx)(D.SZ,{children:"Imposta la tua tariffa oraria per i servizi di delivery"})]}),(0,p.jsxs)(D.aY,{children:[(0,p.jsxs)("form",{onSubmit:d,className:"space-y-4",noValidate:!0,children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsx)(A._,{htmlFor:"hourlyRate",children:"Tariffa Oraria (€/ora)"}),(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)(P.Z,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),(0,p.jsx)(E.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]+([.,][0-9]+)?",value:r,onChange:e=>{let s=e.target.value;if(i(s=s.replace(/[^0-9.,]/g,"").replace(",",".")),(null==n?void 0:n.type)==="error"&&c(null),s&&!isNaN(parseFloat(s))){let e=parseFloat(s);e>12.5?c({type:"error",text:"⚠️ La tariffa non pu\xf2 superare €12,50/ora per rispettare i limiti fiscali"}):e<=0&&c({type:"error",text:"⚠️ Inserisci una tariffa valida maggiore di €0,01"})}},onKeyDown:e=>{-1===[46,8,9,27,13,190,188].indexOf(e.keyCode)&&(65!==e.keyCode||!0!==e.ctrlKey)&&(67!==e.keyCode||!0!==e.ctrlKey)&&(86!==e.keyCode||!0!==e.ctrlKey)&&(88!==e.keyCode||!0!==e.ctrlKey)&&(e.shiftKey||e.keyCode<48||e.keyCode>57)&&(e.keyCode<96||e.keyCode>105)&&e.preventDefault()},placeholder:"Es. 12.00",className:"pl-10",disabled:l})]}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"Max €12,50/ora per rimanere sotto la soglia fiscale di €25,82 (2 ore max)"})]}),t&&(0,p.jsx)("div",{className:"bg-blue-50 p-3 rounded-lg",children:(0,p.jsxs)("p",{className:"text-sm text-blue-700",children:[(0,p.jsx)("strong",{children:"Tariffa attuale:"})," €",t,"/ora"]})}),n&&(0,p.jsxs)("div",{className:"p-3 rounded-lg flex items-center gap-2 ".concat("success"===n.type?"bg-green-50 text-green-700":"bg-red-50 text-red-700"),children:["success"===n.type?(0,p.jsx)(C.Z,{className:"h-4 w-4"}):(0,p.jsx)(k.Z,{className:"h-4 w-4"}),(0,p.jsx)("span",{className:"text-sm",children:n.text})]}),(0,p.jsxs)("div",{className:"flex gap-2 pt-4",children:[(0,p.jsx)(N.z,{type:"button",variant:"outline",onClick:a,disabled:l,className:"flex-1",children:"Annulla"}),(0,p.jsx)(N.z,{type:"submit",disabled:l||!r,className:"flex-1",children:l?(0,p.jsx)(p.Fragment,{children:"Aggiornamento..."}):(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)(R.Z,{className:"mr-2 h-4 w-4"}),"Salva"]})})]})]}),(0,p.jsxs)("div",{className:"mt-6 bg-green-50 p-3 rounded-lg",children:[(0,p.jsx)("h4",{className:"text-sm font-medium text-green-700 mb-2",children:"\uD83D\uDCCB Informazioni Fiscali"}),(0,p.jsxs)("ul",{className:"text-xs text-green-600 space-y-1",children:[(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Tariffa max:"})," €12,50/ora"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Durata max:"})," 2 ore per prenotazione"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Totale max:"})," €25,00 (< €25,82)"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Vantaggio:"})," Nessuna ritenuta d'acconto"]})]}),(0,p.jsxs)("p",{className:"text-xs text-green-600 mt-2 italic",children:["Fonte:"," ",(0,p.jsx)("a",{href:"https://www.agenziaentrate.gov.it/portale/schede/pagamenti/versamento-modello-f24-ritenute-su-reddito-di-lavoro-autonomo-f24_rit_red_lav_aut/redditi-soggetti-a-ritenuta-f24_rit_red_lav_aut",target:"_blank",rel:"noopener noreferrer",className:"underline hover:text-green-800",children:"Agenzia delle Entrate - Ritenute Lavoro Autonomo"})]})]})]})]})})}var T=t(8736),M=t(2369),G=t(3774),q=t(3618);function B(e){let{isOpen:s,onClose:t,riderId:a}=e,[r,i]=(0,g.useState)({first_name:"",last_name:"",fiscal_code:"",birth_place:"",birth_date:"",residence_address:"",residence_city:""}),[l,o]=(0,g.useState)(!1),[n,c]=(0,g.useState)(null);(0,g.useEffect)(()=>{s&&a&&d()},[s,a]);let d=async()=>{try{let{data:e,error:s}=await j.O.from("rider_tax_details").select("*").eq("rider_id",a).single();if(s&&"PGRST116"!==s.code){console.error("Error fetching fiscal data:",s);return}e&&i({first_name:e.first_name||"",last_name:e.last_name||"",fiscal_code:e.fiscal_code||"",birth_place:e.birth_place||"",birth_date:e.birth_date||"",residence_address:e.residence_address||"",residence_city:e.residence_city||""})}catch(e){console.error("Error fetching fiscal data:",e)}},m=e=>/^[A-Z]{6}[0-9]{2}[A-Z][0-9]{2}[A-Z][0-9]{3}[A-Z]$/.test(e.toUpperCase()),x=e=>e.replace(/[AEIOU]/g,""),u=e=>e.replace(/[^AEIOU]/g,""),h=e=>["A","B","C","D","E","H","L","M","P","R","S","T"][e-1]||"A",f=e=>{for(let[s,t]of Object.entries({PALERMO:"G273",ROMA:"H501",MILANO:"F205",NAPOLI:"F839",TORINO:"L219",GENOVA:"D969",BOLOGNA:"A944",FIRENZE:"D612",VENEZIA:"L736",BARI:"A662",CATANIA:"C351",VERONA:"L781",MESSINA:"F158",PADOVA:"G224",TRIESTE:"L424",BRESCIA:"B157",PARMA:"G337",PRATO:"G999",MODENA:"F257","REGGIO CALABRIA":"H224","REGGIO EMILIA":"H223",PERUGIA:"G478",LIVORNO:"E625",RAVENNA:"H199",CAGLIARI:"B354",FOGGIA:"D643",RIMINI:"H294",SALERNO:"H703",FERRARA:"D548",SASSARI:"I452",LATINA:"E472","GIUGLIANO IN CAMPANIA":"E058",MONZA:"F704",SYRACUSA:"I754",PESCARA:"G482",BERGAMO:"A794",FORLÌ:"D704",TRENTO:"L378",VICENZA:"L840",TERNI:"L112",BOLZANO:"A952",NOVARA:"F952",PIACENZA:"G535",ANCONA:"A271",ANDRIA:"A285",AREZZO:"A390",UDINE:"L483",CESENA:"C514",LECCE:"E506",PESARO:"G479"}))if(e.includes(s))return t;let s=e.match(/\(([^)]+)\)/);if(s){let e=s[1],t={PA:"G273",RM:"H501",MI:"F205",NA:"F839",TO:"L219",GE:"D969",BO:"A944",FI:"D612",VE:"L736",BA:"A662",CT:"C351",VR:"L781",ME:"F158"};if(t[e])return t[e]}return"H501"},v=e=>{let s={A:1,B:0,C:5,D:7,E:9,F:13,G:15,H:17,I:19,J:21,K:2,L:4,M:18,N:20,O:11,P:3,Q:6,R:8,S:12,T:14,U:16,V:10,W:22,X:25,Y:24,Z:23},t={0:1,1:0,2:5,3:7,4:9,5:13,6:15,7:17,8:19,9:21},a={A:0,B:1,C:2,D:3,E:4,F:5,G:6,H:7,I:8,J:9,K:10,L:11,M:12,N:13,O:14,P:15,Q:16,R:17,S:18,T:19,U:20,V:21,W:22,X:23,Y:24,Z:25},r={0:0,1:1,2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9},i=0;for(let l=0;l<15;l++){let o=e[l].toUpperCase();l%2==0?isNaN(parseInt(o))?i+=s[o]||0:i+=t[o]||0:isNaN(parseInt(o))?i+=a[o]||0:i+=r[o]||0}return"ABCDEFGHIJKLMNOPQRSTUVWXYZ"[i%26]},b=(e,s)=>{if(i(t=>({...t,[e]:s})),(null==n?void 0:n.type)==="error"&&c(null),"fiscal_code"===e&&s.length>0){let e=s.toUpperCase();16!==s.length||m(e)||c({type:"error",text:"⚠️ Codice fiscale non valido. Controlla il formato (16 caratteri)"})}},y=async e=>{e.preventDefault(),o(!0),c(null);try{if(!r.first_name.trim())throw Error("⚠️ Il nome \xe8 obbligatorio");if(!r.last_name.trim())throw Error("⚠️ Il cognome \xe8 obbligatorio");if(!r.fiscal_code.trim())throw Error("⚠️ Il codice fiscale \xe8 obbligatorio");if(!m(r.fiscal_code.toUpperCase()))throw Error("⚠️ Codice fiscale non valido. Deve essere di 16 caratteri nel formato corretto");if(!r.birth_place.trim())throw Error("⚠️ Il luogo di nascita \xe8 obbligatorio");if(!r.birth_date.trim())throw Error("⚠️ La data di nascita \xe8 obbligatoria");if(!r.residence_address.trim())throw Error("⚠️ L'indirizzo di residenza \xe8 obbligatorio");if(!r.residence_city.trim())throw Error("⚠️ La citt\xe0 di residenza \xe8 obbligatoria");let e={rider_id:a,first_name:r.first_name.trim(),last_name:r.last_name.trim(),fiscal_code:r.fiscal_code.toUpperCase(),birth_place:r.birth_place.trim(),birth_date:r.birth_date,residence_address:r.residence_address.trim(),residence_city:r.residence_city.trim()},{error:s}=await j.O.from("rider_tax_details").upsert(e,{onConflict:"rider_id"});if(s)throw console.error("Error saving fiscal data:",s),Error("❌ Errore durante il salvataggio. Riprova.");c({type:"success",text:"✅ Dati fiscali salvati con successo!"}),setTimeout(()=>{t()},1500)}catch(e){console.error("Error saving fiscal data:",e),c({type:"error",text:e.message||"❌ Errore durante il salvataggio. Riprova."})}finally{o(!1)}},_=()=>{c(null),t()};return s?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,p.jsxs)(D.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,p.jsxs)(D.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(T.Z,{className:"h-5 w-5"}),"Dati Fiscali"]}),(0,p.jsx)(D.SZ,{children:"Inserisci i tuoi dati fiscali per la fatturazione e la compliance"})]}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:_,disabled:l,children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,p.jsxs)(D.aY,{children:[n&&(0,p.jsx)("div",{className:"mb-4 p-3 rounded-lg ".concat("success"===n.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:n.text}),(0,p.jsxs)("form",{onSubmit:y,className:"space-y-4",noValidate:!0,children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"firstName",className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-4 w-4"}),"Nome *"]}),(0,p.jsx)(E.I,{id:"firstName",type:"text",value:r.first_name,onChange:e=>b("first_name",e.target.value),placeholder:"Es. Mario",disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"lastName",className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-4 w-4"}),"Cognome *"]}),(0,p.jsx)(E.I,{id:"lastName",type:"text",value:r.last_name,onChange:e=>b("last_name",e.target.value),placeholder:"Es. Rossi",disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"birthPlace",className:"flex items-center gap-2",children:[(0,p.jsx)(G.Z,{className:"h-4 w-4"}),"Luogo di Nascita *"]}),(0,p.jsx)(E.I,{id:"birthPlace",type:"text",value:r.birth_place,onChange:e=>b("birth_place",e.target.value),placeholder:"Es. Roma (RM)",disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"birthDate",className:"flex items-center gap-2",children:[(0,p.jsx)(S.Z,{className:"h-4 w-4"}),"Data di Nascita *"]}),(0,p.jsx)(E.I,{id:"birthDate",type:"date",value:r.birth_date,onChange:e=>b("birth_date",e.target.value),disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"fiscalCode",className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-4 w-4"}),"Codice Fiscale *"]}),(0,p.jsxs)("div",{className:"flex gap-2",children:[(0,p.jsx)(E.I,{id:"fiscalCode",type:"text",maxLength:16,value:r.fiscal_code,onChange:e=>b("fiscal_code",e.target.value.toUpperCase()),placeholder:"Es. RSSMRA85M01H501X",className:"uppercase flex-1",disabled:l,required:!0}),(0,p.jsxs)(N.z,{type:"button",variant:"outline",onClick:()=>{let{first_name:e,last_name:s,birth_date:t,birth_place:a}=r;if(!e.trim()||!s.trim()||!t||!a.trim()){c({type:"error",text:"⚠️ Compila tutti i campi (nome, cognome, data e luogo di nascita) per calcolare il codice fiscale"});return}try{let r=s.toUpperCase().replace(/\s/g,""),l=x(r),o=u(r),n="";n=l.length>=3?l.substring(0,3):(l+o+"XXX").substring(0,3);let d=e.toUpperCase().replace(/\s/g,""),m=x(d),p=u(d),g="";g=m.length>=4?m[0]+m[2]+m[3]:m.length>=3?m.substring(0,3):(m+p+"XXX").substring(0,3);let j=t.substring(2,4),b=h(parseInt(t.substring(5,7))),N=t.substring(8,10),y=f(a.toUpperCase()),w=n+g+j+b+N+y,_=v(w),D=w+_;i(e=>({...e,fiscal_code:D})),c({type:"success",text:"✅ Codice fiscale calcolato: ".concat(D,". Verifica che sia corretto.")})}catch(e){c({type:"error",text:"❌ Errore nel calcolo del codice fiscale. Inseriscilo manualmente."})}},disabled:l,className:"shrink-0",children:[(0,p.jsx)(q.Z,{className:"h-4 w-4 mr-1"}),"Calcola"]})]}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"16 caratteri alfanumerici (lettere maiuscole e numeri)"})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"residenceAddress",className:"flex items-center gap-2",children:[(0,p.jsx)(G.Z,{className:"h-4 w-4"}),"Indirizzo di Residenza *"]}),(0,p.jsx)(E.I,{id:"residenceAddress",type:"text",value:r.residence_address,onChange:e=>b("residence_address",e.target.value),placeholder:"Es. Via Roma, 123",disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"residenceCity",className:"flex items-center gap-2",children:[(0,p.jsx)(G.Z,{className:"h-4 w-4"}),"Citt\xe0 di Residenza *"]}),(0,p.jsx)(E.I,{id:"residenceCity",type:"text",value:r.residence_city,onChange:e=>b("residence_city",e.target.value),placeholder:"Es. Milano (MI)",disabled:l,required:!0})]}),(0,p.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,p.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[(0,p.jsx)(k.Z,{className:"h-4 w-4"}),"Informazioni Importanti"]}),(0,p.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Privacy:"})," I dati sono protetti secondo il GDPR"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Uso:"})," Utilizzati solo per fatturazione e compliance fiscale"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Sicurezza:"})," Trasmissione e archiviazione crittografate"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Modifiche:"})," Puoi aggiornare i dati in qualsiasi momento"]})]})]}),(0,p.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,p.jsx)(N.z,{type:"button",variant:"outline",onClick:_,disabled:l,className:"flex-1",children:"Annulla"}),(0,p.jsx)(N.z,{type:"submit",disabled:l,className:"flex-1",children:l?(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)(R.Z,{className:"h-4 w-4"}),"Salva Dati Fiscali"]})})]})]})]})]})}):null}var U=t(3417),V=t(421),Y=t(3581),H=t(3145);(a=c||(c={})).AVAILABLE="available",a.BUSY="busy",a.OFFLINE="offline",(r=d||(d={})).PENDING="pending",r.CONFIRMED="confirmed",r.COMPLETED="completed",r.CANCELLED="cancelled",(i=m||(m={})).RIDER="rider",i.MERCHANT="merchant",(l=x||(x={})).BIKE="bike",l.SCOOTER="scooter",l.CAR="car",l.MOTORBIKE="motorbike",l.WALKING="walking",(o=u||(u={})).BICI="bici",o.E_BIKE="e_bike",o.SCOOTER="scooter",o.AUTO="auto";let K={bici:"\uD83D\uDEB2 Bicicletta",e_bike:"\uD83D\uDEB4‍♂️ E-Bike",scooter:"\uD83D\uDEF5 Scooter",auto:"\uD83D\uDE97 Auto"},X=e=>{var s;return(null==e?void 0:e.code)==="PGRST301"||(null==e?void 0:e.code)==="PGRST302"||(null==e?void 0:e.status)===401||(null==e?void 0:e.status)===403||(null==e?void 0:null===(s=e.message)||void 0===s?void 0:s.includes("JWT"))},J=async()=>{try{console.log("\uD83D\uDD04 Refreshing session...");let{data:e,error:s}=await j.O.auth.refreshSession();if(s)return console.error("❌ Failed to refresh session:",s),!1;if(e.session)return console.log("✅ Session refreshed successfully"),!0;return console.warn("⚠️ No session returned after refresh"),!1}catch(e){return console.error("❌ Error during session refresh:",e),!1}},W=async function(e){let s,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;for(let a=0;a<=t;a++)try{let{data:{user:s},error:t}=await j.O.auth.getUser();if(t||!s)throw Error("User not authenticated");return await e()}catch(e){if(s=e,X(e)&&a<t){if(console.log("\uD83D\uDD04 Auth error detected, attempting refresh (attempt ".concat(a+1,"/").concat(t+1,")")),!await J())throw Error("Failed to refresh session");await new Promise(e=>setTimeout(e,1e3));continue}throw e}throw s},Q=(e,s)=>!!X(e)&&(console.log("\uD83D\uDEAB Authentication error detected, redirecting to login"),s.push("/auth/login"),!0),$=Object.values(u).map(e=>({value:e,label:K[e]}));function ee(e){let{isOpen:s,onClose:t,riderId:a,onProfileUpdate:r}=e,i=(0,f.useRouter)(),[l,o]=(0,g.useState)({full_name:"",bio:"",hourly_rate:"",vehicle_type:"",profile_picture_url:"",active_location:""}),[n,c]=(0,g.useState)(!1),[d,m]=(0,g.useState)(null);(0,g.useEffect)(()=>{s&&a&&x()},[s,a]);let x=async()=>{try{let{data:e,error:s}=await j.O.from("profiles").select("\n          full_name,\n          riders_details (\n            bio,\n            hourly_rate,\n            vehicle_type,\n            profile_picture_url,\n            active_location\n          )\n        ").eq("id",a).single();if(s){console.error("Error fetching profile data:",s);return}if(e){let s=Array.isArray(e.riders_details)?e.riders_details[0]:e.riders_details;o({full_name:e.full_name||"",bio:(null==s?void 0:s.bio)||"",hourly_rate:(null==s?void 0:s.hourly_rate)?s.hourly_rate.toString():"",vehicle_type:(null==s?void 0:s.vehicle_type)||"",profile_picture_url:(null==s?void 0:s.profile_picture_url)||"",active_location:(null==s?void 0:s.active_location)||""})}}catch(e){console.error("Error fetching profile data:",e)}},u=e=>{let s=parseFloat(e);return!isNaN(s)&&s>0&&s<=12.5},h=(e,s)=>{if(o(t=>({...t,[e]:s})),(null==d?void 0:d.type)==="error"&&m(null),"hourly_rate"===e&&s.length>0){let e=parseFloat(s);isNaN(e)?m({type:"error",text:"⚠️ Inserisci un numero valido per la tariffa"}):e<=0?m({type:"error",text:"⚠️ La tariffa deve essere maggiore di €0"}):e>12.5&&m({type:"error",text:"⚠️ Tariffa massima consentita: €12.50/h (per evitare ritenuta d'acconto)"})}},v=async e=>{e.preventDefault(),c(!0),m(null);try{if(!l.full_name.trim())throw Error("⚠️ Il nome completo \xe8 obbligatorio");if(l.hourly_rate&&!u(l.hourly_rate))throw Error("⚠️ La tariffa oraria deve essere tra €0.01 e €12.50");await W(async()=>{let{error:e}=await j.O.from("profiles").update({full_name:l.full_name.trim()||null,updated_at:new Date().toISOString()}).eq("id",a);if(e)throw console.error("Error updating profile:",e),e;let s={bio:l.bio.trim()||null,vehicle_type:l.vehicle_type||null,profile_picture_url:l.profile_picture_url.trim()||null,active_location:l.active_location.trim()||null,updated_at:new Date().toISOString()};l.hourly_rate.trim()&&(s.hourly_rate=parseFloat(l.hourly_rate));let{error:t}=await j.O.from("riders_details").update(s).eq("profile_id",a);if(t)throw console.error("Error updating rider details:",t),t},2),m({type:"success",text:"✅ Profilo aggiornato con successo!"}),r&&r(),setTimeout(()=>{t()},1500)}catch(e){if(console.error("Profile update error:",e),Q(e,i)){m({type:"error",text:"\uD83D\uDD12 Sessione scaduta. Stai per essere reindirizzato al login..."}),setTimeout(()=>{t()},2e3);return}m({type:"error",text:e.message||"❌ Errore durante l'aggiornamento del profilo. Riprova."})}finally{c(!1)}},b=()=>{m(null),t()};return s?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,p.jsxs)(D.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,p.jsxs)(D.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-5 w-5"}),"Modifica Profilo"]}),(0,p.jsx)(D.SZ,{children:"Aggiorna le tue informazioni di profilo rider"})]}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:b,disabled:n,children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,p.jsxs)(D.aY,{children:[d&&(0,p.jsx)("div",{className:"mb-4 p-3 rounded-lg ".concat("success"===d.type?"bg-green-50 text-green-700 border border-green-200":"bg-red-50 text-red-700 border border-red-200"),children:d.text}),(0,p.jsxs)("form",{onSubmit:v,className:"space-y-4",noValidate:!0,children:[(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"fullName",className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-4 w-4"}),"Nome Completo"]}),(0,p.jsx)(E.I,{id:"fullName",type:"text",value:l.full_name,onChange:e=>h("full_name",e.target.value),placeholder:"Inserisci il tuo nome completo",disabled:n,required:!0}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"Il nome che verr\xe0 mostrato ai clienti"})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"bio",className:"flex items-center gap-2",children:[(0,p.jsx)(U.Z,{className:"h-4 w-4"}),"Bio / Descrizione"]}),(0,p.jsx)("textarea",{id:"bio",value:l.bio,onChange:e=>h("bio",e.target.value),placeholder:"Descrivi brevemente te stesso e la tua esperienza come rider...",className:"w-full p-2 border border-gray-300 rounded-md resize-none focus:ring-2 focus:ring-blue-500 focus:border-transparent",rows:3,maxLength:500,disabled:n}),(0,p.jsxs)("p",{className:"text-xs text-gray-500",children:["Massimo 500 caratteri (",500-l.bio.length," rimanenti)"]})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"vehicleType",className:"flex items-center gap-2",children:[(0,p.jsx)(V.Z,{className:"h-4 w-4"}),"Tipo di Veicolo"]}),(0,p.jsxs)("select",{id:"vehicleType",value:l.vehicle_type,onChange:e=>h("vehicle_type",e.target.value),className:"w-full p-2 border border-gray-300 rounded-md focus:ring-2 focus:ring-blue-500 focus:border-transparent",disabled:n,children:[(0,p.jsx)("option",{value:"",children:"Seleziona veicolo"}),$.map(e=>(0,p.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"activeLocation",className:"flex items-center gap-2",children:[(0,p.jsx)(G.Z,{className:"h-4 w-4"}),"Localit\xe0 Attiva"]}),(0,p.jsx)(E.I,{id:"activeLocation",type:"text",value:l.active_location,onChange:e=>h("active_location",e.target.value),placeholder:"Milano, Roma, Torino, ecc...",disabled:n,maxLength:100}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"La citt\xe0 o zona dove sei attivo per le consegne (massimo 100 caratteri)"})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"hourlyRate",className:"flex items-center gap-2",children:[(0,p.jsx)(P.Z,{className:"h-4 w-4"}),"Tariffa Oraria (€/h)"]}),(0,p.jsx)(E.I,{id:"hourlyRate",type:"text",inputMode:"decimal",pattern:"[0-9]*[.,]?[0-9]*",value:l.hourly_rate,onChange:e=>h("hourly_rate",e.target.value),placeholder:"Es. 10.00",disabled:n}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"Tariffa massima: €12.50/h per evitare ritenuta d'acconto su prestazioni occasionali"})]}),(0,p.jsxs)("div",{className:"space-y-2",children:[(0,p.jsxs)(A._,{htmlFor:"profilePictureUrl",className:"flex items-center gap-2",children:[(0,p.jsx)(Y.Z,{className:"h-4 w-4"}),"URL Immagine Profilo"]}),(0,p.jsx)(E.I,{id:"profilePictureUrl",type:"url",value:l.profile_picture_url,onChange:e=>h("profile_picture_url",e.target.value),placeholder:"https://esempio.com/mia-foto.jpg",disabled:n}),l.profile_picture_url&&(0,p.jsxs)("div",{className:"mt-3",children:[(0,p.jsx)("p",{className:"text-xs text-gray-600 mb-3",children:"Anteprima:"}),(0,p.jsx)("div",{className:"flex justify-center",children:(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)(H.default,{src:l.profile_picture_url,alt:"Anteprima foto profilo",width:96,height:96,className:"w-24 h-24 rounded-full object-cover border-3 border-blue-200 shadow-md",onError:e=>{e.currentTarget.style.display="none"}}),(0,p.jsx)("div",{className:"absolute bottom-0 right-0 w-4 h-4 bg-green-500 border-2 border-white rounded-full"})]})}),(0,p.jsx)("p",{className:"text-xs text-green-600 text-center mt-2",children:"✓ Immagine caricata correttamente"})]}),(0,p.jsx)("p",{className:"text-xs text-gray-500",children:"Inserisci l'URL di un'immagine (JPG, PNG, WEBP)"})]}),(0,p.jsxs)("div",{className:"mt-6 bg-blue-50 p-3 rounded-lg",children:[(0,p.jsxs)("h4",{className:"text-sm font-medium text-blue-700 mb-2 flex items-center gap-2",children:[(0,p.jsx)(k.Z,{className:"h-4 w-4"}),"Informazioni"]}),(0,p.jsxs)("ul",{className:"text-xs text-blue-600 space-y-1",children:[(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Nome:"})," Mostrato ai clienti nelle prenotazioni"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Bio:"})," Aiuta i clienti a conoscerti meglio"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Veicolo:"})," Influenza i tipi di consegne disponibili"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Localit\xe0:"})," Determina la tua visibilit\xe0 nelle ricerche geografiche"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Tariffa:"})," Pu\xf2 essere aggiornata in qualsiasi momento"]}),(0,p.jsxs)("li",{children:["• ",(0,p.jsx)("strong",{children:"Foto profilo:"})," Aumenta la fiducia dei clienti"]})]})]}),(0,p.jsxs)("div",{className:"flex gap-3 pt-4",children:[(0,p.jsx)(N.z,{type:"button",variant:"outline",onClick:b,disabled:n,className:"flex-1",children:"Annulla"}),(0,p.jsx)(N.z,{type:"submit",disabled:n,className:"flex-1",children:n?(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-2 border-white border-t-transparent"}),"Salvataggio..."]}):(0,p.jsxs)("div",{className:"flex items-center gap-2",children:[(0,p.jsx)(R.Z,{className:"h-4 w-4"}),"Salva Modifiche"]})})]})]})]})]})}):null}var es=t(6818),et=t(7992);function ea(e){var s;let{isOpen:t,onClose:a,request:r,riderHourlyRate:i,onRespond:l}=e,{toast:o}=(0,et.pm)(),[n,c]=(0,g.useState)(!1),[d,m]=(0,g.useState)(null),[x,u]=(0,g.useState)(""),h=async e=>{if(e.preventDefault(),r&&d){c(!0);try{await l(r.id,d,x.trim()||void 0),console.log("\uD83C\uDF89 Risposta inviata con successo, mostrando toast..."),a(),setTimeout(()=>{console.log("\uD83C\uDF5E Mostrando toast dopo chiusura modal..."),console.log("\uD83D\uDCDD Toast data:",{title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});let e=o({title:"accepted"===d?"Richiesta accettata":"Richiesta rifiutata",description:"La risposta \xe8 stata inviata con successo"});console.log("\uD83C\uDFAF Toast result:",e),console.log("✅ Toast chiamato con successo - dovrebbe apparire ora!")},100)}catch(e){console.error("❌ Error responding to request:",e),console.log("\uD83D\uDEA8 Mostrando toast di errore..."),o({title:"Errore",description:"Errore durante la risposta alla richiesta"}),setTimeout(()=>{console.log("\uD83D\uDD12 Chiudendo modal dopo errore..."),a()},1e3)}finally{c(!1)}}};return t&&r?(0,p.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,p.jsxs)(D.Zb,{className:"w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[(0,p.jsxs)(D.Ol,{className:"flex flex-row items-center justify-between space-y-0 pb-4",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(D.ll,{className:"text-xl",children:"Rispondi alla Richiesta di Servizio"}),(0,p.jsx)(D.SZ,{children:(null===(s=r.merchant.esercenti)||void 0===s?void 0:s.business_name)||r.merchant.full_name})]}),(0,p.jsx)(N.z,{variant:"ghost",size:"sm",onClick:a,children:(0,p.jsx)(w.Z,{className:"h-4 w-4"})})]}),(0,p.jsxs)(D.aY,{children:[(0,p.jsxs)("div",{className:"bg-gray-50 p-4 rounded-lg mb-6 space-y-3",children:[(0,p.jsx)("h4",{className:"font-medium text-gray-900",children:"Dettagli della Richiesta"}),(0,p.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(S.Z,{className:"h-4 w-4 text-gray-500"}),(0,p.jsx)("span",{children:new Date(r.requested_date).toLocaleDateString("it-IT",{weekday:"long",year:"numeric",month:"long",day:"numeric"})})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(I.Z,{className:"h-4 w-4 text-gray-500"}),(0,p.jsxs)("span",{children:[r.start_time.substring(0,5)," - ",r.duration_hours,"h di servizio"]})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(G.Z,{className:"h-4 w-4 text-gray-500"}),(0,p.jsx)("span",{className:"truncate",title:r.merchant_address,children:r.merchant_address})]}),(0,p.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,p.jsx)(P.Z,{className:"h-4 w-4 text-gray-500"}),(0,p.jsxs)("span",{children:["€",(r.duration_hours*(i||15)).toFixed(2)," ","(stimato)"]})]})]}),r.description&&(0,p.jsx)("div",{className:"mt-3 p-3 bg-white rounded border-l-4 border-blue-500",children:(0,p.jsxs)("div",{className:"flex items-start space-x-2",children:[(0,p.jsx)(U.Z,{className:"h-4 w-4 text-blue-500 mt-0.5 flex-shrink-0"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-sm font-medium text-blue-900 mb-1",children:"Istruzioni del merchant:"}),(0,p.jsx)("p",{className:"text-sm text-blue-700",children:r.description})]})]})})]}),(0,p.jsxs)("form",{onSubmit:h,className:"space-y-6",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)(A._,{className:"text-base font-medium",children:"La tua risposta *"}),(0,p.jsxs)("div",{className:"grid grid-cols-2 gap-4 mt-3",children:[(0,p.jsxs)(N.z,{type:"button",variant:"accepted"===d?"default":"outline",className:"h-16 flex-col space-y-2 ".concat("accepted"===d?"bg-green-600 hover:bg-green-700":"hover:bg-green-50 hover:border-green-300"),onClick:()=>m("accepted"),children:[(0,p.jsx)(C.Z,{className:"h-6 w-6"}),(0,p.jsx)("span",{children:"Accetta"})]}),(0,p.jsxs)(N.z,{type:"button",variant:"rejected"===d?"default":"outline",className:"h-16 flex-col space-y-2 ".concat("rejected"===d?"bg-red-600 hover:bg-red-700":"hover:bg-red-50 hover:border-red-300"),onClick:()=>m("rejected"),children:[(0,p.jsx)(w.Z,{className:"h-6 w-6"}),(0,p.jsx)("span",{children:"Rifiuta"})]})]})]}),(0,p.jsxs)("div",{children:[(0,p.jsxs)(A._,{htmlFor:"response_message",children:["Messaggio opzionale","rejected"===d&&(0,p.jsx)("span",{className:"text-red-500 ml-1",children:"*"})]}),(0,p.jsx)(es.g,{id:"response_message",value:x,onChange:e=>u(e.target.value),placeholder:"accepted"===d?"Aggiungi eventuali note o conferme...":"Spiega il motivo del rifiuto...",className:"mt-1",rows:3,required:"rejected"===d}),(0,p.jsx)("p",{className:"text-xs text-gray-500 mt-1",children:"rejected"===d?"Campo obbligatorio per i rifiuti":"Campo opzionale per aggiungere dettagli"})]}),(0,p.jsxs)("div",{className:"flex space-x-3 pt-4",children:[(0,p.jsx)(N.z,{type:"button",variant:"outline",onClick:a,className:"flex-1",disabled:n,children:"Annulla"}),(0,p.jsx)(N.z,{type:"submit",className:"flex-1 ".concat("accepted"===d?"bg-green-600 hover:bg-green-700":"rejected"===d?"bg-red-600 hover:bg-red-700":"bg-gray-600 hover:bg-gray-700"),disabled:n||!d||"rejected"===d&&!x.trim(),children:n?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Invio..."]}):"accepted"===d?"Accetta Richiesta":"rejected"===d?"Rifiuta Richiesta":"Seleziona risposta"})]})]})]})]})}):null}var er=t(6087),ei=t(8205),el=t(8728),eo=t(4630),en=t(5005);let ec={bici:{icon:"\uD83D\uDEB2",label:"Bicicletta"},e_bike:{icon:"\uD83D\uDEB4‍♂️",label:"E-Bike"},scooter:{icon:"\uD83D\uDEF5",label:"Scooter"},auto:{icon:"\uD83D\uDE97",label:"Auto"}};function ed(e){var s,t,a,r,i,l,o,n,c,d;let{profile:m,portfolioData:x,onProfileUpdate:u,onPortfolioSave:h,onPortfolioEdit:f,onboardingState:j,requiredState:v}=e,[b,y]=(0,g.useState)(!1),[w,_]=(0,g.useState)(!1),[E,A]=(0,g.useState)(!1),C=()=>{var e,s;return{images:(null==x?void 0:null===(e=x.portfolioImages)||void 0===e?void 0:e.length)||0,certifications:(null==x?void 0:null===(s=x.certifications)||void 0===s?void 0:s.length)||0,portfolioUrl:(null==x?void 0:x.portfolioUrl)?1:0}};return j>=v?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)(D.Zb,{children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-5 w-5"})," Profilo & Disponibilit\xe0"]}),(0,p.jsx)(D.SZ,{children:"Gestisci il tuo profilo, tariffa, calendario e portfolio"})]}),(0,p.jsxs)(D.aY,{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"border-b pb-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-4 w-4"})," Profilo Rider"]}),(0,p.jsxs)("div",{className:"flex flex-col md:flex-row gap-6",children:[(0,p.jsxs)("div",{className:"flex flex-col items-center text-center",children:[(null===(n=m.riders_details)||void 0===n?void 0:n.profile_picture_url)?(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)(H.default,{src:m.riders_details.profile_picture_url,alt:"Foto profilo",width:128,height:128,className:"w-32 h-32 rounded-full object-cover border-4 border-white shadow-xl",onError:e=>{e.currentTarget.style.display="none"}}),(0,p.jsx)("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:(0,p.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]}):(0,p.jsxs)("div",{className:"relative",children:[(0,p.jsx)("div",{className:"w-32 h-32 rounded-full flex items-center justify-center shadow-xl border-4 border-white",style:{background:"linear-gradient(to bottom right, #333366, #4a4a7a)"},children:(0,p.jsx)("span",{className:"text-3xl font-bold text-white",children:m.full_name?m.full_name.charAt(0).toUpperCase():(null===(d=m.rider_tax_details)||void 0===d?void 0:null===(c=d.first_name)||void 0===c?void 0:c.charAt(0).toUpperCase())||"R"})}),(0,p.jsx)("div",{className:"absolute bottom-2 right-2 w-6 h-6 bg-green-500 border-3 border-white rounded-full flex items-center justify-center",children:(0,p.jsx)("div",{className:"w-2 h-2 bg-white rounded-full"})})]}),(0,p.jsxs)("div",{className:"mt-4 space-y-2",children:[(0,p.jsx)("h4",{className:"text-xl font-bold text-gray-900",children:(null===(s=m.rider_tax_details)||void 0===s?void 0:s.first_name)&&(null===(t=m.rider_tax_details)||void 0===t?void 0:t.last_name)?"".concat(m.rider_tax_details.first_name," ").concat(m.rider_tax_details.last_name):m.full_name||"Nome non impostato"}),(0,p.jsxs)("div",{className:"flex items-center justify-center gap-1 mb-2",children:[[1,2,3,4,5].map(e=>(0,p.jsx)("svg",{className:"w-4 h-4 text-yellow-400 fill-current",viewBox:"0 0 20 20",children:(0,p.jsx)("path",{d:"M10 1l2.5 6.5h6.5l-5.25 4 2 6.5-5.75-4.25-5.75 4.25 2-6.5-5.25-4h6.5z"})},e)),(0,p.jsx)("span",{className:"text-sm text-gray-600 ml-1",children:"5.0 • Nuovo rider"})]}),(0,p.jsx)("div",{className:"flex items-center justify-center gap-2",children:(e=>{let s=ec[e];return s?(0,p.jsxs)("span",{className:"text-sm font-medium text-gray-700 capitalize",children:[s.icon," ",s.label]}):(0,p.jsx)("span",{className:"text-sm font-medium text-gray-700",children:"Veicolo non specificato"})})(null===(a=m.riders_details)||void 0===a?void 0:a.vehicle_type)})]})]}),(0,p.jsxs)("div",{className:"flex-1 space-y-4",children:[(null===(r=m.riders_details)||void 0===r?void 0:r.bio)&&(0,p.jsx)("div",{children:(0,p.jsxs)("p",{className:"text-gray-700 italic text-center md:text-left",children:['"',m.riders_details.bio,'"']})}),(0,p.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,p.jsxs)("div",{className:"text-center p-4 bg-gray-50 rounded-lg",children:[(0,p.jsxs)("div",{className:"text-2xl font-bold text-gray-900",children:["€",(null===(i=m.riders_details)||void 0===i?void 0:i.hourly_rate)||0]}),(0,p.jsx)("div",{className:"text-sm text-gray-600",children:"per ora"})]}),(0,p.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg",children:[(0,p.jsx)("div",{className:"text-lg font-bold text-green-600",children:"Disponibile"}),(0,p.jsx)("div",{className:"text-xs text-gray-600",children:"Aggiornato oggi"})]})]}),(0,p.jsxs)("div",{className:"flex gap-2",children:[(0,p.jsxs)(N.z,{variant:"outline",size:"sm",onClick:()=>A(!0),className:"flex-1",children:[(0,p.jsx)(eo.Z,{className:"w-4 h-4 mr-2"}),"Modifica Profilo"]}),(0,p.jsxs)(N.z,{variant:"outline",size:"sm",onClick:()=>_(!0),className:"flex-1",children:[(0,p.jsx)(P.Z,{className:"w-4 h-4 mr-2"}),"Tariffa"]})]})]})]})]}),(0,p.jsxs)("div",{className:"border-b pb-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(S.Z,{className:"h-4 w-4"})," Disponibilit\xe0"]}),(0,p.jsx)("div",{className:"text-center",children:(0,p.jsxs)(N.z,{variant:"outline",onClick:()=>y(!0),className:"w-full md:w-auto",children:[(0,p.jsx)(S.Z,{className:"w-4 h-4 mr-2"}),"Gestisci Calendario Disponibilit\xe0"]})})]}),(0,p.jsxs)("div",{children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(en.Z,{className:"h-4 w-4"})," Portfolio"]}),x?(0,p.jsxs)("div",{className:"space-y-4",children:[(()=>{let e=C();return(0,p.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-center",children:[(0,p.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:e.images}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Immagini"})]}),(0,p.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:e.certifications}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Certificazioni"})]}),(0,p.jsxs)("div",{className:"p-2 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:e.portfolioUrl}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Portfolio Web"})]})]})})(),(null===(l=x.portfolioImages)||void 0===l?void 0:l.length)>0&&(0,p.jsxs)("div",{className:"flex justify-center gap-2",children:[x.portfolioImages.slice(0,3).map((e,s)=>(0,p.jsx)("div",{className:"w-16 h-16 rounded-lg overflow-hidden border",children:(0,p.jsx)(H.default,{src:e,alt:"Portfolio ".concat(s+1),width:64,height:64,className:"w-full h-full object-cover"})},s)),x.portfolioImages.length>3&&(0,p.jsx)("div",{className:"w-16 h-16 rounded-lg bg-gray-100 border flex items-center justify-center",children:(0,p.jsxs)("span",{className:"text-xs text-gray-500",children:["+",x.portfolioImages.length-3]})})]}),(0,p.jsxs)(N.z,{variant:"outline",onClick:f,className:"w-full",children:[(0,p.jsx)(eo.Z,{className:"w-4 h-4 mr-2"}),"Modifica Portfolio"]})]}):(0,p.jsxs)("div",{className:"text-center py-8",children:[(0,p.jsx)(en.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,p.jsx)("p",{className:"text-gray-500 mb-2",children:"Portfolio non configurato"}),(0,p.jsx)("p",{className:"text-sm text-gray-400 mb-4",children:"Crea il tuo portfolio per attrarre pi\xf9 clienti"}),(0,p.jsx)(N.z,{onClick:f,style:{backgroundColor:"#333366"},children:"Crea Portfolio"})]})]})]})]}),b&&m&&(0,p.jsx)(O,{riderId:m.id,onClose:()=>y(!1)}),w&&m&&(0,p.jsx)(F,{riderId:m.id,currentRate:(null===(o=m.riders_details)||void 0===o?void 0:o.hourly_rate)||null,onClose:()=>_(!1)}),E&&m&&(0,p.jsx)(ee,{isOpen:E,onClose:()=>A(!1),riderId:m.id,onProfileUpdate:u})]}):(0,p.jsx)(D.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,p.jsxs)(D.aY,{className:"relative px-6 pt-6 pb-6",children:[(0,p.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,p.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[(0,p.jsx)(el.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),(0,p.jsx)("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(M.Z,{className:"h-5 w-5"})," Profilo & Disponibilit\xe0"]}),(0,p.jsx)(D.SZ,{children:"Gestisci il tuo profilo, tariffa, calendario e portfolio"})]})]})})}var em=t(5557),ex=t(9345),eu=t(3639);function eh(e){let{serviceRequests:s,profile:t,onOpenRespondModal:a,onboardingState:r,requiredState:i}=e,l=e=>{switch(e){case"pending":return"bg-yellow-100 text-yellow-800";case"accepted":return"bg-green-100 text-green-800";case"rejected":return"bg-red-100 text-red-800";case"completed":return"bg-blue-100 text-blue-800";default:return"bg-gray-100 text-gray-800"}},o=e=>{switch(e){case"pending":return"In Attesa";case"accepted":return"Accettata";case"rejected":return"Rifiutata";case"completed":return"Completata";case"cancelled":return"Annullata";default:return e}},n=e=>{var s;return((null===(s=t.riders_details)||void 0===s?void 0:s.hourly_rate)||0)*e.duration_hours};return r>=i?(0,p.jsxs)(D.Zb,{children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(em.Z,{className:"h-5 w-5"})," Gestione Lavoro"]}),(0,p.jsx)(D.SZ,{children:"Gestisci richieste di servizio e prenotazioni attive"})]}),(0,p.jsxs)(D.aY,{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"grid grid-cols-3 gap-4",children:[(0,p.jsxs)("div",{className:"text-center p-4 bg-yellow-50 rounded-lg border border-yellow-200",children:[(0,p.jsx)("p",{className:"text-2xl font-bold text-yellow-600",children:s.filter(e=>"pending"===e.status).length}),(0,p.jsx)("p",{className:"text-sm text-yellow-700 font-medium",children:"In Attesa"}),(0,p.jsx)("p",{className:"text-xs text-yellow-600 mt-1",children:"Richieste nuove"})]}),(0,p.jsxs)("div",{className:"text-center p-4 bg-green-50 rounded-lg border border-green-200",children:[(0,p.jsx)("p",{className:"text-2xl font-bold text-green-600",children:s.filter(e=>"accepted"===e.status).length}),(0,p.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"Accettate"}),(0,p.jsx)("p",{className:"text-xs text-green-600 mt-1",children:"Lavoro confermato"})]}),(0,p.jsxs)("div",{className:"text-center p-4 bg-blue-50 rounded-lg border border-blue-200",children:[(0,p.jsx)("p",{className:"text-2xl font-bold text-blue-600",children:s.filter(e=>["in_progress","booked"].includes(e.status)).length}),(0,p.jsx)("p",{className:"text-sm text-blue-700 font-medium",children:"Attive"}),(0,p.jsx)("p",{className:"text-xs text-blue-600 mt-1",children:"In corso"})]})]}),(0,p.jsxs)("div",{className:"space-y-4",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,p.jsx)(ex.Z,{className:"h-4 w-4"})," Richieste Recenti"]}),0===s.length?(0,p.jsxs)("div",{className:"text-center py-12",children:[(0,p.jsx)(ex.Z,{className:"h-16 w-16 text-gray-400 mx-auto mb-4"}),(0,p.jsx)("p",{className:"text-gray-500 mb-2 text-lg",children:"Nessuna richiesta ricevuta"}),(0,p.jsx)("p",{className:"text-sm text-gray-400 max-w-md mx-auto",children:"Le nuove richieste di servizio appariranno qui automaticamente. Tieni aggiornato il tuo profilo per ricevere pi\xf9 richieste!"})]}):(0,p.jsx)("div",{className:"space-y-3 max-h-96 overflow-y-auto",children:s.slice(0,5).map(e=>{var s,t,r;return(0,p.jsx)("div",{className:"border rounded-lg p-4 hover:shadow-md transition-shadow",children:(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row sm:items-center justify-between gap-4",children:[(0,p.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,p.jsxs)("div",{className:"flex items-start justify-between mb-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"font-semibold text-gray-900 truncate",children:(null===(s=e.merchant.esercenti)||void 0===s?void 0:s.business_name)||e.merchant.full_name}),(0,p.jsxs)("p",{className:"text-sm text-gray-600 truncate",children:[null===(t=e.merchant.esercenti)||void 0===t?void 0:t.address,","," ",null===(r=e.merchant.esercenti)||void 0===r?void 0:r.city]})]}),(0,p.jsx)("span",{className:"px-2 py-1 text-xs rounded-full whitespace-nowrap ".concat(l(e.status)),children:o(e.status)})]}),(0,p.jsxs)("div",{className:"flex flex-wrap items-center gap-4 text-sm text-gray-500 mb-2",children:[(0,p.jsxs)("div",{className:"flex items-center gap-1",children:[(0,p.jsx)(S.Z,{className:"w-4 h-4"}),new Date(e.requested_date).toLocaleDateString("it-IT")]}),(0,p.jsxs)("div",{className:"flex items-center gap-1",children:[(0,p.jsx)(I.Z,{className:"w-4 h-4"}),e.start_time.substring(0,5)," •"," ",e.duration_hours,"h"]}),(0,p.jsxs)("div",{className:"flex items-center gap-1",children:[(0,p.jsx)(P.Z,{className:"w-4 h-4"}),"€",n(e)]})]}),e.description&&(0,p.jsx)("p",{className:"text-sm text-gray-700 line-clamp-2",children:e.description})]}),(0,p.jsx)("div",{className:"flex flex-col sm:flex-row gap-2 sm:min-w-fit",children:"pending"===e.status?(0,p.jsx)(N.z,{size:"sm",onClick:()=>a(e),className:"bg-blue-600 hover:bg-blue-700 w-full sm:w-auto",children:"Rispondi"}):(0,p.jsxs)("div",{className:"text-xs text-gray-500 text-center",children:["accepted"===e.status&&(0,p.jsxs)("div",{className:"flex items-center gap-1 justify-center",children:[(0,p.jsx)(C.Z,{className:"w-3 h-3 text-green-500"}),"Confermata"]}),"rejected"===e.status&&(0,p.jsxs)("div",{className:"flex items-center gap-1 justify-center",children:[(0,p.jsx)(eu.Z,{className:"w-3 h-3 text-red-500"}),"Rifiutata"]})]})})]})},e.id)})}),s.length>5&&(0,p.jsx)("div",{className:"text-center pt-4 border-t",children:(0,p.jsxs)(N.z,{variant:"outline",className:"w-full",children:["Visualizza Tutte le Richieste (",s.length,")"]})})]}),(0,p.jsxs)("div",{className:"border-t pt-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(S.Z,{className:"h-4 w-4"})," Prenotazioni Attive"]}),(0,p.jsxs)("div",{className:"text-center py-8",children:[(0,p.jsx)(S.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-4"}),(0,p.jsx)("p",{className:"text-gray-500 mb-2",children:"Nessuna prenotazione attiva"}),(0,p.jsx)("p",{className:"text-sm text-gray-400",children:"Le prenotazioni confermate appariranno qui"})]})]})]})]}):(0,p.jsx)(D.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,p.jsxs)(D.aY,{className:"relative px-6 pt-6 pb-6",children:[(0,p.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,p.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[(0,p.jsx)(I.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),(0,p.jsx)("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(em.Z,{className:"h-5 w-5"})," Gestione Lavoro"]}),(0,p.jsx)(D.SZ,{children:"Gestisci richieste di servizio e prenotazioni attive"})]})]})})}var ep=t(8226),eg=t(3681),ef=t(5187),ej=t(525),ev=t(1621);function eb(e){var s,t,a;let{profile:r,onStripeOnboarding:i,onManagePayments:l,onboardingState:o,requiredState:n,loading:c}=e,[d,m]=(0,g.useState)(!1),x=async()=>{m(!0);try{await new Promise(e=>setTimeout(e,1e3))}catch(e){console.error("Error checking onboarding status:",e)}finally{m(!1)}};return o>=n?(0,p.jsxs)(D.Zb,{children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(ep.Z,{className:"h-5 w-5"})," Pagamenti & Guadagni"]}),(0,p.jsx)(D.SZ,{children:"Gestisci pagamenti Stripe e monitora i tuoi guadagni"})]}),(0,p.jsxs)(D.aY,{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"border-b pb-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(eg.Z,{className:"h-4 w-4"})," Account Pagamenti"]}),(null===(s=r.riders_details)||void 0===s?void 0:s.stripe_onboarding_complete)?(0,p.jsx)("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:(0,p.jsxs)("div",{className:"flex items-center justify-between",children:[(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(C.Z,{className:"h-8 w-8 text-green-600"}),(0,p.jsxs)("div",{children:[(0,p.jsx)("h4",{className:"font-semibold text-green-800",children:"Account Stripe Attivo"}),(0,p.jsx)("p",{className:"text-sm text-green-600",children:"Puoi ricevere pagamenti dai clienti"})]})]}),(0,p.jsx)(N.z,{variant:"outline",onClick:l,disabled:c,className:"border-green-300 text-green-700 hover:bg-green-100",children:c?"Caricamento...":"Gestisci Account"})]})}):(0,p.jsx)("div",{className:"bg-yellow-50 border border-yellow-200 rounded-lg p-4",children:(0,p.jsxs)("div",{className:"flex items-start gap-3",children:[(0,p.jsx)(eu.Z,{className:"h-8 w-8 text-yellow-600 mt-0.5"}),(0,p.jsxs)("div",{className:"flex-1",children:[(0,p.jsx)("h4",{className:"font-semibold text-yellow-800 mb-2",children:"Configurazione Account Stripe Richiesta"}),(0,p.jsx)("p",{className:"text-sm text-yellow-700 mb-4",children:"Completa l'onboarding Stripe per attivare i pagamenti e ricevere compensi per i tuoi servizi. Il processo richiede pochi minuti."}),(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,p.jsx)(N.z,{onClick:i,disabled:c,className:"bg-green-600 hover:bg-green-700 flex-1",children:c?"Caricamento...":"Attiva Pagamenti"}),(null===(t=r.riders_details)||void 0===t?void 0:t.stripe_account_id)&&(0,p.jsx)(N.z,{variant:"outline",onClick:x,disabled:d,className:"border-yellow-300 text-yellow-700 hover:bg-yellow-100",children:d?"Verificando...":"Verifica Stato"})]})]})]})})]}),(0,p.jsxs)("div",{children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(ef.Z,{className:"h-4 w-4"})," Guadagni e Statistiche"]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 mb-6",children:[(0,p.jsxs)("div",{className:"bg-gradient-to-r from-blue-50 to-blue-100 border border-blue-200 rounded-lg p-4",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-sm text-blue-700 font-medium",children:"Guadagni Totali"}),(0,p.jsx)("p",{className:"text-2xl font-bold text-blue-900",children:"€0.00"})]}),(0,p.jsx)(ej.Z,{className:"h-8 w-8 text-blue-600"})]}),(0,p.jsx)("p",{className:"text-xs text-blue-600",children:"Da quando hai iniziato"})]}),(0,p.jsxs)("div",{className:"bg-gradient-to-r from-green-50 to-green-100 border border-green-200 rounded-lg p-4",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,p.jsxs)("div",{children:[(0,p.jsx)("p",{className:"text-sm text-green-700 font-medium",children:"Questo Mese"}),(0,p.jsx)("p",{className:"text-2xl font-bold text-green-900",children:"€0.00"})]}),(0,p.jsx)(S.Z,{className:"h-8 w-8 text-green-600"})]}),(0,p.jsx)("p",{className:"text-xs text-green-600",children:"In crescita del 0%"})]})]}),(0,p.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4 mb-6",children:[(0,p.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"0"}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Lavori Completati"})]}),(0,p.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"0h"}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Ore Lavorate"})]}),(0,p.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"€0"}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Media per Lavoro"})]}),(0,p.jsxs)("div",{className:"text-center p-3 bg-gray-50 rounded-lg",children:[(0,p.jsx)("p",{className:"text-lg font-bold text-gray-900",children:"0"}),(0,p.jsx)("p",{className:"text-xs text-gray-600",children:"Valutazioni"})]})]}),(0,p.jsxs)("div",{className:"flex flex-col sm:flex-row gap-2",children:[(0,p.jsxs)(N.z,{variant:"outline",className:"flex-1",children:[(0,p.jsx)(ev.Z,{className:"w-4 h-4 mr-2"}),"Visualizza Storico Pagamenti"]}),(0,p.jsxs)(N.z,{variant:"outline",className:"flex-1",children:[(0,p.jsx)(ej.Z,{className:"w-4 h-4 mr-2"}),"Report Dettagliati"]})]}),!(null===(a=r.riders_details)||void 0===a?void 0:a.stripe_onboarding_complete)&&(0,p.jsx)("div",{className:"mt-4 p-3 bg-orange-50 border border-orange-200 rounded-lg",children:(0,p.jsxs)("p",{className:"text-sm text-orange-700",children:["\uD83D\uDCA1 ",(0,p.jsx)("strong",{children:"Nota:"})," I guadagni verranno visualizzati automaticamente dopo l'attivazione dell'account Stripe e il completamento dei primi lavori."]})})]})]})]}):(0,p.jsx)(D.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,p.jsxs)(D.aY,{className:"relative px-6 pt-6 pb-6",children:[(0,p.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,p.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[(0,p.jsx)(ep.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),(0,p.jsx)("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(ep.Z,{className:"h-5 w-5"})," Pagamenti & Guadagni"]}),(0,p.jsx)(D.SZ,{children:"Gestisci pagamenti Stripe e monitora i tuoi guadagni"})]})]})})}var eN=t(4766),ey=t(8906),ew=t(112),e_=t(6337);function eD(e){var s,t,a,r,i;let{profile:l,onUpdateRate:o,onFiscalData:n,onDeleteAccount:c,onboardingState:d,requiredState:m}=e;return d>=m?(0,p.jsxs)(D.Zb,{children:[(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(el.Z,{className:"h-5 w-5"})," Impostazioni"]}),(0,p.jsx)(D.SZ,{children:"Gestisci impostazioni account, preferenze e dati fiscali"})]}),(0,p.jsxs)(D.aY,{className:"space-y-6",children:[(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold flex items-center gap-2",children:[(0,p.jsx)(el.Z,{className:"h-4 w-4"})," Azioni Rapide"]}),(0,p.jsxs)("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3",children:[(0,p.jsx)(N.z,{variant:"outline",className:"h-auto p-4 justify-start",onClick:o,disabled:!(null===(s=l.riders_details)||void 0===s?void 0:s.stripe_onboarding_complete),children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(P.Z,{className:"h-5 w-5 text-blue-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Aggiorna Tariffa"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Modifica prezzo orario"})]})]})}),(0,p.jsx)(N.z,{variant:"outline",className:"h-auto p-4 justify-start",onClick:n,disabled:!(null===(t=l.riders_details)||void 0===t?void 0:t.stripe_onboarding_complete),children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(T.Z,{className:"h-5 w-5 text-green-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Dati Fiscali"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Gestisci informazioni fiscali"})]})]})}),(0,p.jsx)(N.z,{variant:"outline",className:"h-auto p-4 justify-start",disabled:!(null===(a=l.riders_details)||void 0===a?void 0:a.stripe_onboarding_complete),children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(I.Z,{className:"h-5 w-5 text-purple-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Cronologia"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Visualizza storico attivit\xe0"})]})]})}),(0,p.jsx)(N.z,{variant:"outline",className:"h-auto p-4 justify-start",disabled:!(null===(r=l.riders_details)||void 0===r?void 0:r.stripe_onboarding_complete),children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(eN.Z,{className:"h-5 w-5 text-orange-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Notifiche"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Impostazioni notifiche"})]})]})})]}),!(null===(i=l.riders_details)||void 0===i?void 0:i.stripe_onboarding_complete)&&(0,p.jsx)("div",{className:"bg-orange-50 border border-orange-200 rounded-lg p-3",children:(0,p.jsx)("p",{className:"text-sm text-orange-700 text-center",children:"Completa l'onboarding Stripe per abilitare queste funzioni"})})]}),(0,p.jsxs)("div",{className:"border-t pt-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(ey.Z,{className:"h-4 w-4"})," Sicurezza e Privacy"]}),(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsx)(N.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(M.Z,{className:"h-5 w-5 text-indigo-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Profilo e Sicurezza"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Gestisci password e sicurezza account"})]})]})}),(0,p.jsx)(N.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(ey.Z,{className:"h-5 w-5 text-indigo-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Privacy e Dati"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Controlla le tue impostazioni privacy"})]})]})})]})]}),(0,p.jsxs)("div",{className:"border-t pt-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[(0,p.jsx)(ew.Z,{className:"h-4 w-4"})," Supporto"]}),(0,p.jsxs)("div",{className:"space-y-3",children:[(0,p.jsx)(N.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(ew.Z,{className:"h-5 w-5 text-teal-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Centro Assistenza"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Guide, FAQ e supporto"})]})]})}),(0,p.jsx)(N.z,{variant:"outline",className:"w-full justify-start h-auto p-4",children:(0,p.jsxs)("div",{className:"flex items-center gap-3",children:[(0,p.jsx)(eN.Z,{className:"h-5 w-5 text-teal-600"}),(0,p.jsxs)("div",{className:"text-left",children:[(0,p.jsx)("div",{className:"font-medium",children:"Contatta Supporto"}),(0,p.jsx)("div",{className:"text-xs text-gray-500",children:"Hai bisogno di aiuto?"})]})]})})]})]}),(0,p.jsxs)("div",{className:"border-t pt-6",children:[(0,p.jsxs)("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2 text-red-600",children:[(0,p.jsx)(eu.Z,{className:"h-4 w-4"})," Zona Pericolo"]}),(0,p.jsx)("div",{className:"bg-red-50 border border-red-200 rounded-lg p-4",children:(0,p.jsxs)("div",{className:"flex items-start gap-3",children:[(0,p.jsx)(eu.Z,{className:"h-6 w-6 text-red-600 mt-0.5"}),(0,p.jsxs)("div",{className:"flex-1",children:[(0,p.jsx)("h4",{className:"font-medium text-red-800 mb-2",children:"Eliminazione Account"}),(0,p.jsx)("p",{className:"text-sm text-red-700 mb-3",children:"Questa azione \xe8 irreversibile. Tutti i tuoi dati, inclusi profilo, portfolio e cronologia dei lavori verranno eliminati definitivamente."}),(0,p.jsxs)(N.z,{variant:"outline",size:"sm",onClick:c,className:"border-red-300 text-red-700 hover:bg-red-100",children:[(0,p.jsx)(e_.Z,{className:"w-4 h-4 mr-2"}),"Elimina Account"]})]})]})})]})]})]}):(0,p.jsx)(D.Zb,{className:"relative overflow-hidden opacity-60 pointer-events-none",children:(0,p.jsxs)(D.aY,{className:"relative px-6 pt-6 pb-6",children:[(0,p.jsx)("div",{className:"absolute inset-0 bg-white bg-opacity-90 flex items-center justify-center rounded-lg border-2 border-dashed border-gray-300",children:(0,p.jsxs)("div",{className:"text-center p-6 max-w-xs",children:[(0,p.jsx)(el.Z,{className:"h-12 w-12 text-gray-400 mx-auto mb-3"}),(0,p.jsx)("h3",{className:"text-lg font-semibold text-gray-900 mb-2",children:"Funzione Bloccata"}),(0,p.jsx)("p",{className:"text-sm text-gray-600",children:"Completa i passaggi precedenti per sbloccare questa sezione"})]})}),(0,p.jsxs)(D.Ol,{children:[(0,p.jsxs)(D.ll,{className:"flex items-center gap-2",children:[(0,p.jsx)(el.Z,{className:"h-5 w-5"})," Impostazioni"]}),(0,p.jsx)(D.SZ,{children:"Gestisci impostazioni account e preferenze"})]})]})})}(n=h||(h={}))[n.STRIPE_ONLY=0]="STRIPE_ONLY",n[n.BASIC_PROFILE=1]="BASIC_PROFILE",n[n.AVAILABILITY=2]="AVAILABILITY",n[n.FULL_FEATURES=3]="FULL_FEATURES";let eE=[{key:"stripe",label:"Stripe",description:"Attiva pagamenti"},{key:"profile",label:"Profilo",description:"Completa profilo"},{key:"availability",label:"Disponibilit\xe0",description:"Imposta orari"},{key:"portfolio",label:"Portfolio",description:"Crea portfolio"}],eA=e=>(null==e?void 0:e.stripe_onboarding_complete)?(null==e?void 0:e.hourly_rate)&&(null==e?void 0:e.bio)?(null==e?void 0:e.availabilityConfigured)?3:2:1:0,eS=e=>{let{currentState:s}=e;return s>=3?null:(0,p.jsxs)("div",{className:"mb-4 p-3 bg-gray-50 rounded-lg border border-gray-200",children:[(0,p.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,p.jsxs)("span",{className:"text-sm font-medium text-gray-700",children:["Onboarding: ",s+1," di ",eE.length," completati"]}),(0,p.jsxs)("span",{className:"text-xs text-gray-500",children:[Math.round((s+1)/eE.length*100),"%"]})]}),(0,p.jsx)("div",{className:"w-full bg-gray-200 rounded-full h-1.5",children:(0,p.jsx)("div",{className:"bg-blue-500 h-1.5 rounded-full transition-all duration-500",style:{width:"".concat((s+1)/eE.length*100,"%")}})})]})},eC=()=>{let[e,s]=(0,g.useState)(null),[t,a]=(0,g.useState)(!1),[r,i]=(0,g.useState)(!1),[l,o]=(0,g.useState)(!1),[n,c]=(0,g.useState)(!1),[d,m]=(0,g.useState)(!0),[x,u]=(0,g.useState)(null),[h,p]=(0,g.useState)(null),[f,j]=(0,g.useState)(!1),[v,b]=(0,g.useState)(!1),[N,y]=(0,g.useState)(!1),[w,_]=(0,g.useState)([]),[D,E]=(0,g.useState)(!1),[A,S]=(0,g.useState)(null),[C,z]=(0,g.useState)(!1),[I,R]=(0,g.useState)(null);return{profile:e,setProfile:s,showAvailabilityCalendar:t,setShowAvailabilityCalendar:a,showUpdateRateModal:r,setShowUpdateRateModal:i,showFiscalDataModal:l,setShowFiscalDataModal:o,showEditProfileModal:n,setShowEditProfileModal:c,loading:d,setLoading:m,error:x,setError:u,onboardingUrl:h,setOnboardingUrl:p,checkingOnboarding:f,setCheckingOnboarding:j,loggingOut:v,setLoggingOut:b,showDeleteModal:N,setShowDeleteModal:y,serviceRequests:w,setServiceRequests:_,showRespondModal:D,setShowRespondModal:E,selectedRequest:A,setSelectedRequest:S,showPortfolioEditor:C,setShowPortfolioEditor:z,portfolioData:I,setPortfolioData:R}};function ez(){var e,s,t,a,r,i;let l=eC(),o=(0,f.useRouter)(),n=(0,f.useSearchParams)(),c=(0,g.useRef)(!1),d=(0,g.useRef)(!1),m=(0,g.useRef)(!1),x=(0,g.useMemo)(()=>{var e;return null===(e=l.profile)||void 0===e?void 0:e.id},[null===(e=l.profile)||void 0===e?void 0:e.id]),u=(0,g.useMemo)(()=>n.get("onboarding_complete"),[n]),[h,N]=(0,g.useState)(!1),[y,w]=(0,g.useState)(!1),{isOpen:D,toggle:E}=function(){let[e,s]=(0,g.useState)(!1);return{isOpen:e,toggle:()=>s(!e),open:()=>s(!0),close:()=>s(!1)}}(),A=[{id:"profilo",label:"Profilo & Disponibilit\xe0",icon:(0,p.jsx)(M.Z,{className:"h-5 w-5"})},{id:"lavoro",label:"Gestione Lavoro",icon:(0,p.jsx)(en.Z,{className:"h-5 w-5"})},{id:"pagamenti",label:"Pagamenti",icon:(0,p.jsx)(ep.Z,{className:"h-5 w-5"})},{id:"impostazioni",label:"Impostazioni",icon:(0,p.jsx)(el.Z,{className:"h-5 w-5"})}],S=(0,g.useCallback)(async()=>{if(c.current){console.log("\uD83D\uDEAB FETCH PROFILE already running, skipping");return}if(m.current&&!u){console.log("\uD83D\uDEAB PROFILE already fetched, skipping");return}c.current=!0,console.log("\uD83D\uDD04 FETCH PROFILE started");try{let{data:{user:s},error:t}=await j.O.auth.getUser();if(t||!s){console.error("\uD83D\uDEAB No authenticated user, redirecting to login"),o.push("/auth/login");return}let{data:a,error:r}=await j.O.from("profiles").select("\n          id, full_name, avatar_url, role,\n          riders_details (\n            vehicle_type, profile_picture_url, bio, hourly_rate,\n            stripe_account_id, stripe_onboarding_complete\n          ),\n          rider_tax_details (\n            first_name, last_name, fiscal_code, birth_place,\n            birth_date, residence_address, residence_city\n          )\n        ").eq("id",s.id).single();if(r){if("PGRST116"===r.code){var e;if((null===(e=s.user_metadata)||void 0===e?void 0:e.role)==="rider"){let{error:e}=await j.O.from("profiles").insert({id:s.id,full_name:s.user_metadata.full_name||"New Rider",role:"rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()});if(!e){await j.O.from("riders_details").insert({profile_id:s.id,hourly_rate:15,bio:"New Rider",created_at:new Date().toISOString(),updated_at:new Date().toISOString()}),m.current=!1,c.current=!1,setTimeout(()=>S(),100);return}}else{o.push("/auth/register");return}}console.error("❌ Error fetching profile:",r),l.setError("Errore nel caricamento del profilo");return}if((null==a?void 0:a.role)!=="rider"){"merchant"===a.role?o.push("/dashboard/merchant"):o.push("/auth/login");return}let i=Array.isArray(a.riders_details)?a.riders_details[0]:a.riders_details;l.setProfile({id:a.id,full_name:a.full_name,avatar_url:a.avatar_url,riders_details:i||null,rider_tax_details:Array.isArray(a.rider_tax_details)?a.rider_tax_details[0]||null:a.rider_tax_details||null}),m.current=!0,console.log("✅ Profile loaded successfully")}catch(e){console.error("Error fetching profile:",e),l.setError("Errore nel caricamento del profilo")}finally{c.current=!1,l.setLoading(!1)}},[o,u,l]),C=async()=>{l.setLoading(!0),l.setError(null);try{let e=await fetch("/api/stripe/onboarding",{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"});if(!e.ok){let s=await e.json();throw Error(s.error||"Failed to start onboarding")}let s=await e.json();if(s.url)window.location.href=s.url;else throw Error("No URL returned from Stripe")}catch(e){console.error("Error starting Stripe onboarding:",e),l.setError(e.message||"\xc8 sorto un errore durante l'attivazione dei pagamenti")}finally{l.setLoading(!1)}},z=async()=>{var e,s;let{data:{user:t}}=await j.O.auth.getUser();if(!t){l.setError("Devi effettuare il login per utilizzare questa funzionalit\xe0");return}if(!(null===(s=l.profile)||void 0===s?void 0:null===(e=s.riders_details)||void 0===e?void 0:e.stripe_account_id)){l.setError("ID dell'account Stripe non trovato.");return}l.setLoading(!0),l.setError(null);try{let e=await fetch("/api/stripe/create-login-link",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({accountId:l.profile.riders_details.stripe_account_id})}),{url:s,error:t}=await e.json();if(t)throw Error(t);s&&window.open(s,"_blank")}catch(e){console.error("Error creating Stripe login link:",e),l.setError(e.message||"Failed to open Stripe Dashboard.")}finally{l.setLoading(!1)}},I=(0,g.useCallback)(async()=>{if(!x){console.log("\uD83D\uDEAB No profile ID, skipping service requests");return}if(d.current){console.log("\uD83D\uDEAB Already fetching service requests, skipping");return}d.current=!0,console.log("\uD83D\uDD04 Fetching service requests for:",x);try{let{data:e,error:s}=await j.O.from("service_requests").select("\n          id, requested_date, start_time, duration_hours,\n          merchant_address, description, status, rider_response,\n          created_at, updated_at,\n          merchant:profiles!merchant_id (\n            id, full_name,\n            esercenti (business_name, address, city)\n          )\n        ").eq("rider_id",x).order("created_at",{ascending:!1});if(s)throw s;let t=(e||[]).map(e=>{let s=Array.isArray(e.merchant)?e.merchant[0]:e.merchant;return{...e,merchant:{...s,esercenti:Array.isArray(null==s?void 0:s.esercenti)?s.esercenti[0]:null==s?void 0:s.esercenti}}}).filter(e=>e.merchant);l.setServiceRequests(t),console.log("✅ Service requests loaded:",t.length)}catch(e){console.error("❌ Error fetching service requests:",e),l.setError("Errore nel caricamento delle richieste di servizio")}finally{d.current=!1}},[x,l]);(0,g.useEffect)(()=>{"true"===u&&(console.log("✅ Onboarding completato, ricaricando profilo"),window.history.replaceState({},"","/dashboard/rider"),m.current=!1,c.current=!1,S())},[u]),(0,g.useEffect)(()=>{u||m.current||c.current||l.profile||(console.log("\uD83C\uDFC1 Caricamento profilo iniziale"),S())},[u,l.profile]),(0,g.useEffect)(()=>{x&&!l.loading&&m.current&&!d.current&&0===l.serviceRequests.length&&(console.log("\uD83D\uDC64 Profile ready, fetching service requests"),I())},[x,l.loading]);let R=(0,g.useCallback)(async()=>{var e;if(!(null===(e=l.profile)||void 0===e?void 0:e.id)){console.log("\uD83D\uDEAB NO PROFILE ID - skipping portfolio fetch");return}if(h){console.log("\uD83D\uDEAB ALREADY FETCHING - skipping portfolio fetch");return}if(y){console.log("\uD83D\uDEAB ALREADY FETCHED - skipping portfolio fetch");return}if(!window.location.pathname.includes("/dashboard/rider")){console.log("\uD83D\uDEAB NOT ON DASHBOARD - skipping portfolio fetch");return}console.log("\uD83D\uDD04 FETCHING PORTFOLIO DATA - ALL CHECKS PASSED"),N(!0);try{let e=await fetch("/api/riders/".concat(l.profile.id,"/portfolio"));if(e.ok){let s=await e.json();console.log("✅ PORTFOLIO DATA RECEIVED:",s),l.setPortfolioData(s),w(!0)}else console.error("❌ Portfolio API error:",e.status),l.setPortfolioData({portfolioImages:[],certifications:[],portfolioUrl:"",servicesDescription:""}),w(!0)}catch(e){console.error("❌ Portfolio fetch error:",e),l.setPortfolioData({portfolioImages:[],certifications:[],portfolioUrl:"",servicesDescription:""}),w(!0)}finally{N(!1)}},[h,y,l]),Z=async e=>{if(l.profile)try{if(!(await fetch("/api/riders/".concat(l.profile.id,"/portfolio"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify(e)})).ok)throw Error("Errore nel salvataggio del portfolio");l.setPortfolioData(e),w(!1),console.log("✅ Portfolio salvato con successo")}catch(e){throw console.error("Errore nel salvataggio del portfolio:",e),e}};(0,g.useEffect)(()=>{var e;null===(e=l.profile)||void 0===e||!e.id||l.loading||!m.current||h||y||l.portfolioData||(console.log("\uD83D\uDC64 Profile available, fetching portfolio data"),R())},[null===(s=l.profile)||void 0===s?void 0:s.id,l.loading,h,y,l.portfolioData,R]);let P=(0,g.useCallback)(async(e,s,t)=>{try{let a=await fetch("/api/service-requests/".concat(e,"/respond"),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({status:s,riderResponse:t,userId:x})});if(!a.ok)throw Error("HTTP error! status: ".concat(a.status));let r=await a.json();if(!r.success)throw Error(r.error||"Failed to respond to request");console.log("✅ Response sent successfully"),d.current=!1,I()}catch(e){throw console.error("❌ Error responding to request:",e),e}},[x,I]),k=(0,g.useCallback)(async()=>{try{l.setLoggingOut(!0),console.log("\uD83D\uDEAA Logging out rider..."),await j.O.auth.signOut(),console.log("✅ Logout successful, redirecting to home"),o.push("/")}catch(e){console.error("❌ Error during logout:",e),l.setError("Errore durante il logout"),l.setLoggingOut(!1)}},[o,l]);if(l.loading&&!l.profile)return(0,p.jsx)(ei.Iq,{});if(l.error)return(0,p.jsxs)("div",{children:["Error: ",l.error]});if(!l.profile)return(0,p.jsx)("div",{children:"Could not load profile."});let L=eA(l.profile.riders_details);return(0,p.jsxs)("div",{className:"min-h-screen bg-gray-50",children:[(0,p.jsx)(b.Z,{userRole:"rider",userName:(null===(t=l.profile)||void 0===t?void 0:t.full_name)||"Rider",onLogout:k,onDeleteAccount:()=>l.setShowDeleteModal(!0)}),(0,p.jsx)(_,{items:A,onItemClick:e=>{let s=document.getElementById(e);if(s){let e=s.offsetTop-80;window.scrollTo({top:e,behavior:"smooth"})}},isMobile:!1,isOpen:!0,onToggle:E}),(0,p.jsxs)("div",{className:"container mx-auto px-4 py-8 pt-20",children:[(0,p.jsxs)("div",{className:"mb-8",children:[(0,p.jsxs)("h1",{className:"text-3xl font-bold text-gray-900 mb-2",children:["Benvenuto, ",l.profile.full_name,"! \uD83D\uDEB4‍♂️"]}),(0,p.jsx)("p",{className:"text-gray-600",children:"Completa l'onboarding per sbloccare tutte le funzionalit\xe0"})]}),(0,p.jsx)(eS,{currentState:L}),l.error&&(0,p.jsx)("div",{className:"mb-6 p-4 bg-red-50 border border-red-200 rounded-lg text-red-700",children:l.error}),(0,p.jsxs)("div",{className:"flex flex-col space-y-4 md:space-y-6 lg:max-w-4xl lg:mx-auto",children:[(0,p.jsx)("div",{id:"pagamenti",children:(0,p.jsx)(eb,{profile:l.profile,onStripeOnboarding:C,onManagePayments:z,onboardingState:L,requiredState:0,loading:l.loading})}),(0,p.jsx)("div",{id:"profilo",children:(0,p.jsx)(ed,{profile:l.profile,portfolioData:l.portfolioData,onProfileUpdate:()=>{m.current=!1,S()},onPortfolioSave:Z,onPortfolioEdit:()=>l.setShowPortfolioEditor(!0),onboardingState:L,requiredState:1})}),(0,p.jsx)("div",{id:"lavoro",children:(0,p.jsx)(eh,{serviceRequests:l.serviceRequests,profile:l.profile,onOpenRespondModal:e=>{l.setSelectedRequest(e),l.setShowRespondModal(!0)},onboardingState:L,requiredState:2})}),(0,p.jsx)("div",{id:"impostazioni",children:(0,p.jsx)(eD,{profile:l.profile,onUpdateRate:()=>l.setShowUpdateRateModal(!0),onFiscalData:()=>l.setShowFiscalDataModal(!0),onDeleteAccount:()=>l.setShowDeleteModal(!0),onboardingState:L,requiredState:1})})]})]}),(0,p.jsx)(v.Z,{isOpen:l.showDeleteModal,onClose:()=>l.setShowDeleteModal(!1),userRole:"rider"}),l.showAvailabilityCalendar&&l.profile&&(0,p.jsx)(O,{riderId:l.profile.id,onClose:()=>l.setShowAvailabilityCalendar(!1)}),l.showUpdateRateModal&&l.profile&&(0,p.jsx)(F,{riderId:l.profile.id,currentRate:(null===(a=l.profile.riders_details)||void 0===a?void 0:a.hourly_rate)||null,onClose:()=>l.setShowUpdateRateModal(!1)}),l.showFiscalDataModal&&l.profile&&(0,p.jsx)(B,{isOpen:l.showFiscalDataModal,riderId:l.profile.id,onClose:()=>l.setShowFiscalDataModal(!1)}),l.showEditProfileModal&&l.profile&&(0,p.jsx)(ee,{isOpen:l.showEditProfileModal,onClose:()=>l.setShowEditProfileModal(!1),riderId:l.profile.id,onProfileUpdate:S}),(0,p.jsx)(ea,{isOpen:l.showRespondModal,onClose:()=>{l.setShowRespondModal(!1),l.setSelectedRequest(null)},request:l.selectedRequest,riderHourlyRate:(null===(i=l.profile)||void 0===i?void 0:null===(r=i.riders_details)||void 0===r?void 0:r.hourly_rate)||null,onRespond:P}),l.showPortfolioEditor&&l.portfolioData&&l.profile&&(0,p.jsx)(er.Z,{initialData:l.portfolioData,onSave:Z,onClose:()=>l.setShowPortfolioEditor(!1)})]})}function eI(){return(0,p.jsx)(g.Suspense,{fallback:(0,p.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,p.jsxs)("div",{className:"text-center",children:[(0,p.jsx)("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 mx-auto",style:{borderBottomColor:"#333366"}}),(0,p.jsx)("p",{className:"mt-4 text-gray-600",children:"Caricamento dashboard..."})]})}),children:(0,p.jsx)(ez,{})})}}},function(e){e.O(0,[214,569,818,276,97,996,219,971,117,744],function(){return e(e.s=6022)}),_N_E=e.O()}]);