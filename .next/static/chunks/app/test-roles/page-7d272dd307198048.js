(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[743],{359:function(e,r,s){Promise.resolve().then(s.bind(s,3217))},3217:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return o}});var t=s(7437),n=s(2265),a=s(9376),i=s(2141),l=s(2869),c=s(6070);function o(){var e,r,s;let[o,d]=(0,n.useState)(null),[u,h]=(0,n.useState)([]),[f,x]=(0,n.useState)(!1),m=(0,a.useRouter)();(0,n.useEffect)(()=>{(async()=>{let{data:{user:e}}=await i.O.auth.getUser();if(e){let{data:r}=await i.O.from("profiles").select("*").eq("id",e.id).single();d({user:e,profile:r})}})()},[]);let g=async e=>{x(!0);let r=[];try{let s=await fetch("/dashboard/".concat(e));if(r.push({test:"Direct access to /dashboard/".concat(e),status:s.ok?"✅ ACCESSIBLE":"❌ BLOCKED",details:"HTTP ".concat(s.status)}),null==o?void 0:o.profile){let s=o.profile.role===e;r.push({test:"Role verification for ".concat(e," dashboard"),status:s?"✅ CORRECT ROLE":"\uD83D\uDEAB WRONG ROLE",details:"User role: ".concat(o.profile.role,", Required: ").concat(e)})}}catch(s){r.push({test:"Access test for ".concat(e),status:"❌ ERROR",details:s instanceof Error?s.message:"Unknown error"})}h(e=>[...e,...r]),x(!1)},p=async()=>{h([]),await g("rider"),await g("merchant")},j=async e=>{if(null==o?void 0:o.user)try{let{error:r}=await i.O.from("profiles").update({role:e,updated_at:new Date().toISOString()}).eq("id",o.user.id);r?alert("Error updating role: "+r.message):(alert("Role updated to ".concat(e," successfully!")),window.location.reload())}catch(e){console.error("Error:",e)}};return(0,t.jsxs)("div",{className:"max-w-6xl mx-auto p-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold mb-8",children:"\uD83E\uDDEA Role Protection Test Suite"}),(0,t.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsx)(c.ll,{children:"\uD83D\uDC64 Current User Info"})}),(0,t.jsx)(c.aY,{children:o?(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Email:"})," ",o.user.email]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Role:"})," ",(0,t.jsx)("span",{className:"px-2 py-1 rounded ".concat((null===(e=o.profile)||void 0===e?void 0:e.role)==="merchant"?"bg-green-100 text-green-800":"bg-blue-100 text-blue-800"),children:(null===(r=o.profile)||void 0===r?void 0:r.role)||"No role"})]}),(0,t.jsxs)("p",{children:[(0,t.jsx)("strong",{children:"Name:"})," ",(null===(s=o.profile)||void 0===s?void 0:s.full_name)||"N/A"]})]}):(0,t.jsxs)("p",{children:["Not logged in."," ",(0,t.jsx)("a",{href:"/auth/login",className:"text-blue-600 underline",children:"Login"})]})})]}),(0,t.jsxs)(c.Zb,{children:[(0,t.jsx)(c.Ol,{children:(0,t.jsx)(c.ll,{children:"\uD83D\uDD27 Quick Actions"})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"space-y-2",children:[(0,t.jsx)(l.z,{onClick:p,disabled:f,className:"w-full",children:f?"Testing...":"Run All Protection Tests"}),o&&(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(l.z,{variant:"outline",onClick:()=>j("rider"),className:"w-full",children:"Switch to Rider Role"}),(0,t.jsx)(l.z,{variant:"outline",onClick:()=>j("merchant"),className:"w-full",children:"Switch to Merchant Role"})]})]})})]})]}),(0,t.jsxs)(c.Zb,{className:"mb-6",children:[(0,t.jsxs)(c.Ol,{children:[(0,t.jsx)(c.ll,{children:"\uD83C\uDFAF Manual Navigation Tests"}),(0,t.jsx)(c.SZ,{children:"Test navigation to different dashboards"})]}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[(0,t.jsx)(l.z,{onClick:()=>m.push("/dashboard/rider"),children:"Go to Rider Dashboard"}),(0,t.jsx)(l.z,{onClick:()=>m.push("/dashboard/merchant"),children:"Go to Merchant Dashboard"}),(0,t.jsx)(l.z,{variant:"outline",onClick:()=>m.push("/auth/login"),children:"Test Login"}),(0,t.jsx)(l.z,{variant:"outline",onClick:()=>m.push("/debug-user"),children:"Debug User Info"})]})})]}),u.length>0&&(0,t.jsxs)(c.Zb,{children:[(0,t.jsxs)(c.Ol,{children:[(0,t.jsx)(c.ll,{children:"\uD83D\uDCCB Test Results"}),(0,t.jsx)(c.SZ,{children:"Results from automated protection tests"})]}),(0,t.jsx)(c.aY,{children:(0,t.jsx)("div",{className:"space-y-3",children:u.map((e,r)=>(0,t.jsxs)("div",{className:"p-3 border rounded-lg",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-1",children:[(0,t.jsx)("span",{className:"font-medium",children:e.test}),(0,t.jsx)("span",{className:"text-sm",children:e.status})]}),(0,t.jsx)("p",{className:"text-sm text-gray-600",children:e.details})]},r))})})]}),(0,t.jsxs)(c.Zb,{className:"mt-6",children:[(0,t.jsx)(c.Ol,{children:(0,t.jsx)(c.ll,{children:"\uD83D\uDCD6 Expected Behavior"})}),(0,t.jsx)(c.aY,{children:(0,t.jsxs)("div",{className:"text-sm space-y-2",children:[(0,t.jsx)("p",{children:(0,t.jsx)("strong",{children:"✅ Correct behavior:"})}),(0,t.jsxs)("ul",{className:"list-disc ml-6 space-y-1",children:[(0,t.jsx)("li",{children:"Riders can ONLY access /dashboard/rider"}),(0,t.jsx)("li",{children:"Merchants can ONLY access /dashboard/merchant"}),(0,t.jsx)("li",{children:"Accessing wrong dashboard → automatic redirect to correct one"}),(0,t.jsx)("li",{children:"Not logged in → redirect to /auth/login"}),(0,t.jsx)("li",{children:"Login → automatic redirect based on user role"})]}),(0,t.jsx)("p",{className:"mt-4",children:(0,t.jsx)("strong",{children:"\uD83D\uDEAB Security violations:"})}),(0,t.jsxs)("ul",{className:"list-disc ml-6 space-y-1",children:[(0,t.jsx)("li",{children:"Rider accessing merchant dashboard"}),(0,t.jsx)("li",{children:"Merchant accessing rider dashboard"}),(0,t.jsx)("li",{children:"Unauthenticated access to any dashboard"})]})]})})]})]})}},2869:function(e,r,s){"use strict";s.d(r,{z:function(){return o}});var t=s(7437),n=s(2265),a=s(7053),i=s(535),l=s(4508);let c=(0,i.j)("inline-flex items-center justify-center whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),o=n.forwardRef((e,r)=>{let{className:s,variant:n,size:i,asChild:o=!1,...d}=e,u=o?a.g7:"button";return(0,t.jsx)(u,{className:(0,l.cn)(c({variant:n,size:i,className:s})),ref:r,...d})});o.displayName="Button"},6070:function(e,r,s){"use strict";s.d(r,{Ol:function(){return l},SZ:function(){return o},Zb:function(){return i},aY:function(){return d},ll:function(){return c}});var t=s(7437),n=s(2265),a=s(4508);let i=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("rounded-lg border bg-card text-card-foreground shadow-sm",s),...n})});i.displayName="Card";let l=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("flex flex-col space-y-1.5 p-6",s),...n})});l.displayName="CardHeader";let c=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("h3",{ref:r,className:(0,a.cn)("text-2xl font-semibold leading-none tracking-tight",s),...n})});c.displayName="CardTitle";let o=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("p",{ref:r,className:(0,a.cn)("text-sm text-muted-foreground",s),...n})});o.displayName="CardDescription";let d=n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("p-6 pt-0",s),...n})});d.displayName="CardContent",n.forwardRef((e,r)=>{let{className:s,...n}=e;return(0,t.jsx)("div",{ref:r,className:(0,a.cn)("flex items-center p-6 pt-0",s),...n})}).displayName="CardFooter"},2141:function(e,r,s){"use strict";s.d(r,{O:function(){return t}});let t=(0,s(5214).createBrowserClient)("https://uolpvxgcobjefivqnscj.supabase.co","sb_publishable_XfZivZLXatSeakd_ccimng_ZiTnn0dN")},4508:function(e,r,s){"use strict";s.d(r,{cn:function(){return a}});var t=s(1994),n=s(3335);function a(){for(var e=arguments.length,r=Array(e),s=0;s<e;s++)r[s]=arguments[s];return(0,n.m6)((0,t.W)(r))}},9376:function(e,r,s){"use strict";var t=s(5475);s.o(t,"useParams")&&s.d(r,{useParams:function(){return t.useParams}}),s.o(t,"useRouter")&&s.d(r,{useRouter:function(){return t.useRouter}}),s.o(t,"useSearchParams")&&s.d(r,{useSearchParams:function(){return t.useSearchParams}})}},function(e){e.O(0,[214,569,971,117,744],function(){return e(e.s=359)}),_N_E=e.O()}]);